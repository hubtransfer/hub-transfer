<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Parceria - Empire Marques Hotel & HUB Transfer</title>
    
    <!-- Google Maps API -->
    <script>
        function initMap() {
            console.log('Google Maps carregado com sucesso!');
            if (typeof initializeAutocomplete === 'function') {
                initializeAutocomplete();
            }
        }
        
        window.gm_authFailure = function() {
            console.error('Erro de autenticação do Google Maps');
            console.log('Usando sistema de sugestões local');
        };
    </script>
    
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBe4UwnVYRP5KAUOtHg3diD6kPTif3VN30&libraries=places&callback=initMap"
        onerror="console.warn('Erro ao carregar Google Maps - continuando sem autocomplete')">
    </script>
    
    <!-- Telefone internacional -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/intlTelInput.min.js"
            onerror="console.warn('Biblioteca de telefone não carregou - usando input simples')"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/css/intlTelInput.css" 
          onerror="console.warn('CSS do telefone não carregou')">
    
    <style>
/* ===== RESET E FUNDAÇÕES ===== */
:root {
    /* Design System - Cores Primárias */
    --primary-50: #eff6ff;
    --primary-100: #dbeafe;
    --primary-200: #bfdbfe;
    --primary-300: #93c5fd;
    --primary-400: #60a5fa;
    --primary-500: #3b82f6;
    --primary-600: #2563eb;
    --primary-700: #1d4ed8;
    --primary-800: #1e40af;
    --primary-900: #1e3a8a;
    
    /* Design System - Cores Secundárias */
    --secondary-50: #f8fafc;
    --secondary-100: #f1f5f9;
    --secondary-200: #e2e8f0;
    --secondary-300: #cbd5e1;
    --secondary-400: #94a3b8;
    --secondary-500: #64748b;
    --secondary-600: #475569;
    --secondary-700: #334155;
    --secondary-800: #1e293b;
    --secondary-900: #0f172a;
    
    /* Design System - Cores de Estado */
    --success-50: #f0fdf4;
    --success-100: #dcfce7;
    --success-500: #22c55e;
    --success-600: #16a34a;
    --success-700: #15803d;
    
    --warning-50: #fffbeb;
    --warning-100: #fef3c7;
    --warning-500: #f59e0b;
    --warning-600: #d97706;
    --warning-700: #b45309;
    
    --danger-50: #fef2f2;
    --danger-100: #fee2e2;
    --danger-500: #ef4444;
    --danger-600: #dc2626;
    --danger-700: #b91c1c;
    
    /* Design System - Espaciamento */
    --space-1: 0.25rem;
    --space-2: 0.5rem;
    --space-3: 0.75rem;
    --space-4: 1rem;
    --space-5: 1.25rem;
    --space-6: 1.5rem;
    --space-8: 2rem;
    --space-10: 2.5rem;
    --space-12: 3rem;
    --space-16: 4rem;
    --space-20: 5rem;
    --space-24: 6rem;
    
    /* Design System - Tipografia */
    --text-xs: 0.75rem;
    --text-sm: 0.875rem;
    --text-base: 1rem;
    --text-lg: 1.125rem;
    --text-xl: 1.25rem;
    --text-2xl: 1.5rem;
    --text-3xl: 1.875rem;
    --text-4xl: 2.25rem;
    --text-5xl: 3rem;
    
    /* Design System - Sombras */
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-base: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    
    /* Design System - Raios de Borda */
    --radius-sm: 0.375rem;
    --radius-base: 0.5rem;
    --radius-md: 0.75rem;
    --radius-lg: 1rem;
    --radius-xl: 1.5rem;
    --radius-2xl: 2rem;
    --radius-full: 9999px;
    
    /* Design System - Transições */
    --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-slow: 300ms cubic-bezier(0.4, 0, 0.2, 1);
    
    /* Design System - Z-Index */
    --z-dropdown: 1000;
    --z-sticky: 1020;
    --z-fixed: 1030;
    --z-modal: 1040;
    --z-popover: 1050;
    --z-tooltip: 1060;
}

/* Reset Global */
*,
*::before,
*::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* Configurações de Foco Acessível */
*:focus {
    outline: 2px solid var(--primary-500);
    outline-offset: 2px;
}

/* Base do Documento */
html {
    scroll-behavior: smooth;
    text-size-adjust: 100%;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

body {
    font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: var(--space-5);
    line-height: 1.6;
    color: var(--secondary-900);
    font-size: var(--text-base);
}

/* ===== LAYOUT PRINCIPAL ===== */
.container {
    max-width: 1400px;
    margin: 0 auto;
    background: white;
    border-radius: var(--radius-2xl);
    box-shadow: var(--shadow-2xl);
    overflow: hidden;
    backdrop-filter: blur(10px);
}

/* ===== CABEÇALHO PRINCIPAL ===== */
.header {
    background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);
    color: white;
    padding: var(--space-12);
    text-align: center;
    position: relative;
    overflow: hidden;
}

.header::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    animation: headerShine 8s ease-in-out infinite;
}

@keyframes headerShine {
    0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
    50% { transform: translate(-50%, -50%) rotate(180deg); }
}

.header::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 6px;
    background: linear-gradient(90deg, 
        var(--primary-500) 0%, 
        var(--success-500) 25%, 
        var(--warning-500) 50%, 
        var(--danger-500) 75%, 
        var(--primary-500) 100%
    );
    background-size: 200% 100%;
    animation: gradientShift 4s ease-in-out infinite;
}

@keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

.header h1 {
    font-size: var(--text-5xl);
    margin-bottom: var(--space-4);
    font-weight: 800;
    letter-spacing: -0.025em;
    position: relative;
    z-index: 1;
    text-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

.header p {
    font-size: var(--text-xl);
    opacity: 0.95;
    font-weight: 500;
    position: relative;
    z-index: 1;
    margin-bottom: var(--space-8);
}

.company-logos {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: var(--space-10);
    position: relative;
    z-index: 1;
}

.company-logo {
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(20px);
    padding: var(--space-5) var(--space-8);
    border-radius: var(--radius-xl);
    font-size: var(--text-xl);
    font-weight: 700;
    border: 2px solid rgba(255,255,255,0.2);
    transition: var(--transition-base);
    position: relative;
    overflow: hidden;
}

.company-logo::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
    transition: var(--transition-slow);
    transform: translateX(-100%);
}

.company-logo:hover {
    background: rgba(255,255,255,0.25);
    transform: translateY(-4px);
    box-shadow: var(--shadow-xl);
    border-color: rgba(255,255,255,0.4);
}

.company-logo:hover::before {
    transform: translateX(100%);
}

/* ===== INDICADORES DE STATUS ===== */
.sync-indicator {
    position: fixed;
    top: var(--space-6);
    right: var(--space-6);
    background: linear-gradient(135deg, var(--success-500) 0%, var(--success-600) 100%);
    color: white;
    padding: var(--space-3) var(--space-5);
    border-radius: var(--radius-full);
    font-size: var(--text-sm);
    font-weight: 600;
    display: none;
    z-index: var(--z-fixed);
    box-shadow: var(--shadow-lg);
    border: 2px solid rgba(255,255,255,0.2);
    backdrop-filter: blur(10px);
    animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideInRight {
    from { 
        opacity: 0; 
        transform: translateX(100%) scale(0.8); 
    }
    to { 
        opacity: 1; 
        transform: translateX(0) scale(1); 
    }
}

/* ===== SEÇÕES DE CONFIGURAÇÃO MELHORADAS ===== */
.config-section, .clear-data-section {
    margin: var(--space-6);
    padding: var(--space-8);
    border-radius: var(--radius-xl);
    display: none;
    box-shadow: var(--shadow-md);
    border: 2px solid transparent;
    backdrop-filter: blur(10px);
    position: relative;
    overflow: hidden;
}

.config-section {
    background: linear-gradient(135deg, var(--warning-50) 0%, #fef3cd 100%);
    border-color: var(--warning-500);
}

.config-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--warning-500), var(--warning-600), var(--warning-500));
}

.clear-data-section {
    background: linear-gradient(135deg, var(--danger-50) 0%, #fee2e2 100%);
    border-color: var(--danger-500);
}

.clear-data-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--danger-500), var(--danger-600), var(--danger-500));
}

.config-section.show, .clear-data-section.show {
    display: block;
    animation: slideDown 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideDown {
    from { 
        opacity: 0; 
        transform: translateY(-20px) scale(0.95); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
    }
}

.config-title, .clear-data-title {
    font-weight: 800;
    margin-bottom: var(--space-6);
    font-size: var(--text-2xl);
    text-align: center;
    position: relative;
    padding-bottom: var(--space-4);
}

.config-title {
    color: var(--warning-700);
}

.config-title::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 3px;
    background: var(--warning-500);
    border-radius: var(--radius-full);
}

.clear-data-title {
    color: var(--danger-700);
}

.clear-data-title::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 3px;
    background: var(--danger-500);
    border-radius: var(--radius-full);
}

.config-form {
    display: grid;
    grid-template-columns: 1fr auto auto;
    gap: var(--space-5);
    align-items: end;
}

.config-input {
    display: flex;
    flex-direction: column;
}

.config-input label {
    font-weight: 700;
    margin-bottom: var(--space-3);
    color: var(--warning-700);
    font-size: var(--text-base);
    display: flex;
    align-items: center;
    gap: var(--space-2);
}

.config-input input {
    padding: var(--space-4) var(--space-5);
    border: 2px solid var(--warning-300);
    border-radius: var(--radius-lg);
    font-size: var(--text-base);
    transition: var(--transition-base);
    background: white;
    box-shadow: var(--shadow-sm);
}

.config-input input:focus {
    border-color: var(--warning-500);
    box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1), var(--shadow-md);
    transform: translateY(-1px);
}

.clear-data-warning {
    background: white;
    border: 3px solid var(--danger-400);
    padding: var(--space-6);
    border-radius: var(--radius-lg);
    margin-bottom: var(--space-6);
    color: var(--danger-700);
    font-weight: 600;
    text-align: center;
    box-shadow: var(--shadow-base);
    position: relative;
}

.clear-data-warning::before {
    content: '⚠️';
    font-size: var(--text-2xl);
    display: block;
    margin-bottom: var(--space-3);
}

.clear-data-actions, .config-form .btn-group {
    display: flex;
    gap: var(--space-4);
    justify-content: center;
    flex-wrap: wrap;
}

/* ===== SISTEMA DE MENSAGENS MELHORADO ===== */
.status-message {
    padding: var(--space-4) var(--space-6);
    border-radius: var(--radius-lg);
    margin: var(--space-5) 0;
    font-weight: 600;
    text-align: center;
    display: none;
    border: 2px solid;
    position: relative;
    backdrop-filter: blur(10px);
    animation: statusSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes statusSlide {
    from { 
        opacity: 0; 
        transform: translateY(-10px) scale(0.95); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
    }
}

.status-success {
    background: linear-gradient(135deg, var(--success-50) 0%, #dcfce7 100%);
    color: var(--success-700);
    border-color: var(--success-500);
}

.status-success::before {
    content: '✅';
    margin-right: var(--space-2);
}

.status-error {
    background: linear-gradient(135deg, var(--danger-50) 0%, #fee2e2 100%);
    color: var(--danger-700);
    border-color: var(--danger-500);
}

.status-error::before {
    content: '❌';
    margin-right: var(--space-2);
}

.status-warning {
    background: linear-gradient(135deg, var(--warning-50) 0%, #fef3c7 100%);
    color: var(--warning-700);
    border-color: var(--warning-500);
}

.status-warning::before {
    content: '⚠️';
    margin-right: var(--space-2);
}

/* ===== SEÇÃO DO FORMULÁRIO PRINCIPAL ===== */
.quick-add {
    background: linear-gradient(135deg, var(--secondary-50) 0%, #f8fafc 100%);
    padding: var(--space-12);
    border-bottom: 6px solid var(--primary-500);
    position: relative;
}

.quick-add::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--primary-300), transparent);
}

.quick-add h2 {
    color: var(--secondary-800);
    margin-bottom: var(--space-8);
    text-align: center;
    font-size: var(--text-4xl);
    font-weight: 800;
    letter-spacing: -0.025em;
    position: relative;
    padding-bottom: var(--space-4);
}

.quick-add h2::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 80px;
    height: 4px;
    background: linear-gradient(90deg, var(--primary-500), var(--primary-600));
    border-radius: var(--radius-full);
}

/* ===== SISTEMA DE GRID DO FORMULÁRIO ===== */
.form-container {
    display: grid;
    gap: var(--space-8);
}

.form-section {
    background: white;
    padding: var(--space-8);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-base);
    border: 2px solid var(--secondary-100);
    position: relative;
    transition: var(--transition-base);
}

.form-section:hover {
    box-shadow: var(--shadow-lg);
    border-color: var(--secondary-200);
    transform: translateY(-2px);
}

.form-section-title {
    font-size: var(--text-xl);
    font-weight: 700;
    color: var(--secondary-800);
    margin-bottom: var(--space-6);
    padding-bottom: var(--space-4);
    border-bottom: 3px solid var(--secondary-100);
    position: relative;
}

.form-section-title::before {
    content: '';
    position: absolute;
    bottom: -3px;
    left: 0;
    width: 40px;
    height: 3px;
    background: var(--primary-500);
    border-radius: var(--radius-full);
}

.form-row-compact {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--space-6);
    margin-bottom: var(--space-6);
}

.form-row-compact.single {
    grid-template-columns: 1fr;
}

.form-row-compact .full-width {
    grid-column: 1 / -1;
}

.form-group {
    display: flex;
    flex-direction: column;
    position: relative;
}

.form-group label {
    font-weight: 700;
    color: var(--secondary-800);
    margin-bottom: var(--space-3);
    font-size: var(--text-base);
    display: flex;
    align-items: center;
    gap: var(--space-2);
}

.form-group input,
.form-group select,
.form-group textarea {
    padding: var(--space-4) var(--space-5);
    border: 2px solid var(--secondary-200);
    border-radius: var(--radius-lg);
    font-size: var(--text-base);
    transition: var(--transition-base);
    background: white;
    box-shadow: var(--shadow-sm);
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    border-color: var(--primary-500);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1), var(--shadow-md);
    transform: translateY(-1px);
}

.form-group input:disabled,
.form-group select:disabled,
.form-group textarea:disabled {
    background: var(--secondary-50);
    border-color: var(--secondary-200);
    color: var(--secondary-500);
    cursor: not-allowed;
}

/* Campos com tamanhos específicos */
.date-field input {
    max-width: 200px;
}

.time-field input {
    max-width: 180px;
}

/* ===== SISTEMA DE BOTÕES REDESENHADO ===== */
.btn {
    padding: var(--space-4) var(--space-6);
    border: none;
    border-radius: var(--radius-lg);
    font-size: var(--text-base);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-base);
    text-transform: none;
    letter-spacing: 0.025em;
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    min-height: 48px;
    text-decoration: none;
    box-shadow: var(--shadow-sm);
    overflow: hidden;
}

.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: var(--transition-slow);
}

.btn:hover::before {
    left: 100%;
}

.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
}

.btn:disabled::before {
    display: none;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
    color: white;
}

.btn-primary:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
}

.btn-success {
    background: linear-gradient(135deg, var(--success-500) 0%, var(--success-600) 100%);
    color: white;
}

.btn-success:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    background: linear-gradient(135deg, var(--success-600) 0%, var(--success-700) 100%);
}

.btn-warning {
    background: linear-gradient(135deg, var(--warning-500) 0%, var(--warning-600) 100%);
    color: white;
}

.btn-warning:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    background: linear-gradient(135deg, var(--warning-600) 0%, var(--warning-700) 100%);
}

.btn-danger {
    background: linear-gradient(135deg, var(--danger-500) 0%, var(--danger-600) 100%);
    color: white;
}

.btn-danger:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    background: linear-gradient(135deg, var(--danger-600) 0%, var(--danger-700) 100%);
}

.btn-clear {
    background: linear-gradient(135deg, var(--secondary-500) 0%, var(--secondary-600) 100%);
    color: white;
}

.btn-clear:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    background: linear-gradient(135deg, var(--secondary-600) 0%, var(--secondary-700) 100%);
}

.btn-export {
    background: linear-gradient(135deg, #6366f1 0%, #7c3aed 100%);
    color: white;
}

.btn-export:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 100%);
}

.btn-config {
    background: linear-gradient(135deg, var(--warning-500) 0%, var(--warning-600) 100%);
    color: white;
    font-size: var(--text-sm);
    padding: var(--space-3) var(--space-5);
}

.btn.loading {
    pointer-events: none;
}

.btn.loading::after {
    content: '';
    position: absolute;
    width: 18px;
    height: 18px;
    border: 2px solid transparent;
    border-top-color: currentColor;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* ===== BOTÕES DE SELEÇÃO RÁPIDA MELHORADOS ===== */
.service-buttons {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-4);
    margin-bottom: var(--space-5);
}

.btn-service {
    padding: var(--space-5) var(--space-6);
    border: 3px solid var(--secondary-200);
    border-radius: var(--radius-lg);
    background: white;
    color: var(--secondary-700);
    font-size: var(--text-base);
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition-base);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-3);
    min-height: 64px;
    box-shadow: var(--shadow-sm);
    position: relative;
    overflow: hidden;
}

.btn-service::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
    transition: var(--transition-slow);
}

.btn-service:hover {
    border-color: var(--primary-500);
    background: var(--primary-50);
    transform: translateY(-3px);
    box-shadow: var(--shadow-lg);
    color: var(--primary-700);
}

.btn-service:hover::before {
    left: 100%;
}

.btn-service.active {
    background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
    color: white;
    border-color: var(--primary-600);
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
}

.btn-service.active::before {
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
}

/* Botões de pessoas e bagagens em grid melhorado */
.people-buttons, .baggage-buttons {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--space-3);
    margin-bottom: var(--space-4);
    max-width: 320px;
}

.btn-people, .btn-baggage {
    aspect-ratio: 1;
    min-width: 56px;
    height: 56px;
    font-size: var(--text-xl);
    font-weight: 800;
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition-base);
    border: 3px solid;
    background: white;
    box-shadow: var(--shadow-sm);
    position: relative;
    overflow: hidden;
}

.btn-people {
    border-color: #9333ea;
    color: #9333ea;
}

.btn-people::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(147, 51, 234, 0.1), transparent);
    transition: var(--transition-slow);
}

.btn-people:hover, .btn-people.active {
    background: #9333ea;
    color: white;
    transform: scale(1.08);
    box-shadow: var(--shadow-lg);
}

.btn-people:hover::before, .btn-people.active::before {
    left: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
}

.btn-baggage {
    border-color: #ea580c;
    color: #ea580c;
}

.btn-baggage::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(234, 88, 12, 0.1), transparent);
    transition: var(--transition-slow);
}

.btn-baggage:hover, .btn-baggage.active {
    background: #ea580c;
    color: white;
    transform: scale(1.08);
    box-shadow: var(--shadow-lg);
}

.btn-baggage:hover::before, .btn-baggage.active::before {
    left: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
}

/* Botões de data melhorados */
.date-buttons {
    display: flex;
    gap: var(--space-3);
    margin-bottom: var(--space-4);
    flex-wrap: wrap;
}

.btn-date {
    padding: var(--space-3) var(--space-5);
    border: 2px solid var(--secondary-200);
    border-radius: var(--radius-lg);
    background: white;
    color: var(--secondary-700);
    font-size: var(--text-sm);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-base);
    box-shadow: var(--shadow-sm);
}

.btn-date:hover, .btn-date.active {
    background: var(--primary-500);
    color: white;
    border-color: var(--primary-600);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

/* Botões de horário em grid responsivo melhorado */
.time-buttons {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: var(--space-2);
    margin-bottom: var(--space-4);
}

.btn-time {
    padding: var(--space-3);
    border: 2px solid var(--secondary-200);
    border-radius: var(--radius-base);
    background: white;
    color: var(--secondary-700);
    font-size: var(--text-sm);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-base);
    min-height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-sm);
}

.btn-time:hover, .btn-time.active {
    background: var(--primary-500);
    color: white;
    border-color: var(--primary-600);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

/* Botões de local com emojis melhorados */
.location-buttons {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-4);
    margin-bottom: var(--space-4);
}

.btn-location {
    padding: var(--space-4) var(--space-5);
    border: 3px solid var(--secondary-200);
    border-radius: var(--radius-lg);
    background: white;
    color: var(--secondary-700);
    font-size: var(--text-sm);
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition-base);
    text-align: center;
    min-height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    box-shadow: var(--shadow-sm);
    position: relative;
    overflow: hidden;
}

.btn-location::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
    transition: var(--transition-slow);
}

.btn-location:hover, .btn-location.active {
    background: var(--primary-500);
    color: white;
    border-color: var(--primary-600);
    transform: translateY(-3px);
    box-shadow: var(--shadow-lg);
}

.btn-location:hover::before, .btn-location.active::before {
    left: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
}

.origem-btn {
    border-left: 6px solid var(--danger-500);
}

.destino-btn {
    border-left: 6px solid var(--success-500);
}

/* Botões de preço em grid melhorado */
.price-buttons {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-3);
    margin-bottom: var(--space-4);
    max-width: 400px;
}

.btn-price {
    padding: var(--space-4) var(--space-5);
    border: 3px solid var(--success-500);
    border-radius: var(--radius-lg);
    background: white;
    color: var(--success-600);
    font-size: var(--text-lg);
    font-weight: 800;
    cursor: pointer;
    transition: var(--transition-base);
    min-height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-sm);
    position: relative;
    overflow: hidden;
}

.btn-price::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(34, 197, 94, 0.1), transparent);
    transition: var(--transition-slow);
}

.btn-price:hover, .btn-price.active {
    background: var(--success-500);
    color: white;
    transform: translateY(-3px);
    box-shadow: var(--shadow-lg);
}

.btn-price:hover::before, .btn-price.active::before {
    left: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
}

/* Botões de pagamento melhorados */
.payment-buttons, .payment-to-buttons {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: var(--space-4);
    margin-bottom: var(--space-4);
    max-width: 500px;
}

.btn-payment, .btn-payment-to {
    padding: var(--space-4) var(--space-5);
    border: 3px solid var(--secondary-200);
    border-radius: var(--radius-lg);
    background: white;
    color: var(--secondary-700);
    font-size: var(--text-base);
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition-base);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    min-height: 56px;
    box-shadow: var(--shadow-sm);
    position: relative;
    overflow: hidden;
}

.btn-payment::before, .btn-payment-to::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
    transition: var(--transition-slow);
}

.btn-payment:hover, .btn-payment.active,
.btn-payment-to:hover, .btn-payment-to.active {
    background: var(--primary-500);
    color: white;
    border-color: var(--primary-600);
    transform: translateY(-3px);
    box-shadow: var(--shadow-lg);
}

.btn-payment:hover::before, .btn-payment.active::before,
.btn-payment-to:hover::before, .btn-payment-to.active::before {
    left: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
}

/* Botões de observações melhorados */
.obs-buttons {
    display: flex;
    gap: var(--space-3);
    margin-bottom: var(--space-5);
    flex-wrap: wrap;
}

.btn-obs {
    padding: var(--space-2) var(--space-4);
    border: 2px solid var(--secondary-200);
    border-radius: var(--radius-lg);
    background: var(--secondary-50);
    color: var(--secondary-700);
    font-size: var(--text-sm);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-base);
    box-shadow: var(--shadow-sm);
}

.btn-obs:hover, .btn-obs.active {
    background: var(--primary-500);
    color: white;
    border-color: var(--primary-600);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

/* ===== CÁLCULO DE PREÇOS MELHORADO ===== */
.price-calculation-box {
    background: linear-gradient(135deg, var(--primary-50) 0%, #dbeafe 100%);
    border: 3px solid var(--primary-500);
    border-radius: var(--radius-xl);
    padding: var(--space-8);
    margin: var(--space-8) 0;
    display: none;
    box-shadow: var(--shadow-lg);
    position: relative;
    overflow: hidden;
}

.price-calculation-box::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 6px;
    background: linear-gradient(90deg, var(--primary-500), var(--primary-600), var(--primary-500));
}

.price-calculation-box.show {
    display: block;
    animation: priceBoxSlide 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes priceBoxSlide {
    from { 
        opacity: 0; 
        transform: translateY(-20px) scale(0.95); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
    }
}

.calculation-header {
    color: var(--secondary-800);
    font-weight: 800;
    font-size: var(--text-2xl);
    margin-bottom: var(--space-6);
    text-align: center;
    position: relative;
    padding-bottom: var(--space-4);
}

.calculation-header::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 3px;
    background: var(--primary-500);
    border-radius: var(--radius-full);
}

.calculation-details {
    background: white;
    padding: var(--space-6);
    border-radius: var(--radius-lg);
    margin-bottom: var(--space-6);
    box-shadow: var(--shadow-base);
    border: 2px solid var(--primary-100);
}

.calculation-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-3) 0;
    border-bottom: 2px solid var(--secondary-100);
}

.calculation-row:last-child {
    border-bottom: none;
}

.calculation-label {
    color: var(--secondary-600);
    font-weight: 600;
    font-size: var(--text-base);
}

.calculation-value {
    color: var(--secondary-800);
    font-weight: 800;
    font-size: var(--text-lg);
}

.calculation-total {
    background: linear-gradient(135deg, var(--success-500) 0%, var(--success-600) 100%);
    color: white;
    padding: var(--space-6);
    border-radius: var(--radius-lg);
    text-align: center;
    font-size: var(--text-3xl);
    font-weight: 800;
    box-shadow: var(--shadow-lg);
    border: 3px solid var(--success-600);
}

.admin-fields {
    display: none;
    background: linear-gradient(135deg, var(--warning-50) 0%, #fef3c7 100%);
    padding: var(--space-6);
    border-radius: var(--radius-lg);
    margin-top: var(--space-5);
    border: 2px solid var(--warning-500);
    box-shadow: var(--shadow-base);
}

.admin-fields.show {
    display: block;
    animation: adminSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes adminSlide {
    from { 
        opacity: 0; 
        transform: translateY(-10px); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0); 
    }
}

.admin-toggle {
    position: fixed;
    bottom: var(--space-6);
    right: var(--space-6);
    background: linear-gradient(135deg, var(--secondary-700) 0%, var(--secondary-800) 100%);
    color: white;
    padding: var(--space-4) var(--space-6);
    border-radius: var(--radius-full);
    cursor: pointer;
    z-index: var(--z-fixed);
    font-size: var(--text-sm);
    font-weight: 700;
    box-shadow: var(--shadow-xl);
    transition: var(--transition-base);
    border: 3px solid rgba(255,255,255,0.2);
    backdrop-filter: blur(10px);
}

.admin-toggle:hover {
    background: linear-gradient(135deg, var(--secondary-800) 0%, var(--secondary-900) 100%);
    transform: translateY(-3px) scale(1.05);
    box-shadow: var(--shadow-2xl);
}

/* ===== AÇÕES DO FORMULÁRIO ===== */
.form-actions {
    display: flex;
    gap: var(--space-5);
    justify-content: center;
    margin-top: var(--space-10);
    flex-wrap: wrap;
    padding-top: var(--space-8);
    border-top: 3px solid var(--secondary-100);
    position: relative;
}

.form-actions::before {
    content: '';
    position: absolute;
    top: -3px;
    left: 50%;
    transform: translateX(-50%);
    width: 80px;
    height: 3px;
    background: var(--primary-500);
    border-radius: var(--radius-full);
}

/* ===== RESPONSIVIDADE MELHORADA ===== */
@media (max-width: 1024px) {
    .form-row-compact {
        grid-template-columns: 1fr;
    }
    
    .config-form {
        grid-template-columns: 1fr;
        gap: var(--space-4);
    }
    
    .company-logos {
        flex-direction: column;
        gap: var(--space-6);
    }
}

@media (max-width: 768px) {
    body {
        padding: var(--space-3);
    }
    
    .container {
        border-radius: var(--radius-xl);
    }
    
    .header {
        padding: var(--space-8);
    }
    
    .header h1 {
        font-size: var(--text-4xl);
    }
    
    .quick-add {
        padding: var(--space-8);
    }
    
    .form-section {
        padding: var(--space-6);
    }
    
    .time-buttons {
        grid-template-columns: repeat(3, 1fr);
    }
    
    .people-buttons, .baggage-buttons {
        grid-template-columns: repeat(4, 1fr);
        max-width: 100%;
    }
    
    .service-buttons {
        grid-template-columns: 1fr;
    }
    
    .payment-buttons, .payment-to-buttons {
        grid-template-columns: 1fr;
    }
    
    .location-buttons {
        grid-template-columns: 1fr;
    }
    
    .price-buttons {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .form-actions {
        flex-direction: column;
        align-items: center;
    }
    
    .admin-toggle {
        bottom: var(--space-4);
        right: var(--space-4);
        padding: var(--space-3) var(--space-5);
    }
}

@media (max-width: 480px) {
    .header h1 {
        font-size: var(--text-3xl);
    }
    
    .header p {
        font-size: var(--text-lg);
    }
    
    .price-buttons {
        grid-template-columns: 1fr;
    }
    
    .people-buttons, .baggage-buttons {
        grid-template-columns: repeat(3, 1fr);
    }
}

/* ===== ANIMAÇÕES E MICRO-INTERAÇÕES ===== */
@keyframes pulse {
    0%, 100% { 
        transform: scale(1); 
    }
    50% { 
        transform: scale(1.05); 
    }
}

.btn-danger.pulse {
    animation: pulse 2s infinite;
}

@keyframes fadeIn {
    from { 
        opacity: 0; 
        transform: translateY(15px); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0); 
    }
}

.form-section {
    animation: fadeIn 0.6s ease-out;
}

/* ===== ESTADOS DE CARREGAMENTO ===== */
.loading-skeleton {
    background: linear-gradient(90deg, var(--secondary-100) 25%, var(--secondary-50) 50%, var(--secondary-100) 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
    border-radius: var(--radius-base);
}

@keyframes loading {
    0% {
        background-position: 200% 0;
    }
    100% {
        background-position: -200% 0;
    }
}

/* ===== MELHORIAS NO SISTEMA DE TELEFONE ===== */
.phone-container {
    position: relative;
}

.iti {
    width: 100%;
}

.iti__country-list {
    z-index: var(--z-dropdown);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-xl);
    border: 2px solid var(--secondary-200);
}

.iti__selected-flag {
    padding: var(--space-4) var(--space-3);
    border-radius: var(--radius-lg) 0 0 var(--radius-lg);
    background: var(--secondary-50);
    border-right: 2px solid var(--secondary-200);
}

.iti__flag-container {
    padding: 0;
}

#contacto {
    padding-left: 70px;
}

/* ===== UTILIDADES ===== */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

.text-center {
    text-align: center;
}

.text-left {
    text-align: left;
}

.text-right {
    text-align: right;
}

.hidden {
    display: none !important;
}

.visible {
    display: block !important;
}

/* ===== MELHORIAS PARA ACESSIBILIDADE ===== */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* ===== DARK MODE SUPPORT (FUTURO) ===== */
@media (prefers-color-scheme: dark) {
    :root {
        --bg-primary: var(--secondary-900);
        --text-primary: var(--secondary-100);
    }
}

/* ===== SEÇÃO DE RESUMO MELHORADA ===== */
.summary-section {
    padding: var(--space-12);
    background: linear-gradient(135deg, var(--secondary-50) 0%, #f8fafc 100%);
    position: relative;
}

.summary-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--primary-300), transparent);
}

.summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--space-6);
    margin-bottom: var(--space-10);
}

.summary-card {
    background: white;
    padding: var(--space-8);
    border-radius: var(--radius-xl);
    text-align: center;
    box-shadow: var(--shadow-base);
    border: 2px solid var(--secondary-100);
    transition: var(--transition-base);
    position: relative;
    overflow: hidden;
}

.summary-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 6px;
    background: linear-gradient(90deg, var(--primary-500), var(--success-500));
}

.summary-card:hover {
    transform: translateY(-6px);
    box-shadow: var(--shadow-xl);
    border-color: var(--primary-200);
}

.summary-number {
    font-size: var(--text-5xl);
    font-weight: 800;
    color: var(--secondary-800);
    margin-bottom: var(--space-3);
    line-height: 1;
}

.summary-label {
    color: var(--secondary-600);
    font-size: var(--text-base);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 700;
}

.financial-summary {
    background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
    color: white;
    padding: var(--space-12);
    border-radius: var(--radius-2xl);
    margin-bottom: var(--space-10);
    box-shadow: var(--shadow-2xl);
    position: relative;
    overflow: hidden;
}

.financial-summary::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 100%;
    height: 100%;
    background: rgba(255,255,255,0.1);
    border-radius: 50%;
    transform: rotate(45deg);
}

.financial-summary h3 {
    text-align: center;
    margin-bottom: var(--space-10);
    font-size: var(--text-4xl);
    font-weight: 800;
    position: relative;
    z-index: 1;
}

.financial-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: var(--space-8);
    position: relative;
    z-index: 1;
}

.financial-item {
    text-align: center;
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(20px);
    padding: var(--space-8);
    border-radius: var(--radius-xl);
    border: 2px solid rgba(255,255,255,0.2);
    transition: var(--transition-base);
}

.financial-item:hover {
    background: rgba(255,255,255,0.25);
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
}

.financial-value {
    font-size: var(--text-4xl);
    font-weight: 800;
    margin-bottom: var(--space-3);
    line-height: 1;
}

.financial-label {
    font-size: var(--text-lg);
    opacity: 0.95;
    font-weight: 600;
}

/* ===== SEÇÃO DE SERVIÇOS E FILTROS MELHORADA ===== */
.services-section {
    padding: var(--space-12);
    background: white;
}

.services-header {
    margin-bottom: var(--space-10);
}

.services-title {
    color: var(--secondary-800);
    font-size: var(--text-4xl);
    font-weight: 800;
    letter-spacing: -0.025em;
    margin-bottom: var(--space-8);
    text-align: center;
    position: relative;
    padding-bottom: var(--space-4);
}

.services-title::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 4px;
    background: linear-gradient(90deg, var(--primary-500), var(--primary-600));
    border-radius: var(--radius-full);
}

.filters-container {
    background: white;
    padding: var(--space-8);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-lg);
    border: 2px solid var(--secondary-100);
}

.filters-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-5);
    margin-bottom: var(--space-6);
}

.filter-group {
    display: flex;
    flex-direction: column;
}

.filter-group label {
    font-size: var(--text-sm);
    font-weight: 700;
    margin-bottom: var(--space-2);
    color: var(--secondary-700);
}

.filter-group input,
.filter-group select {
    padding: var(--space-3) var(--space-4);
    font-size: var(--text-sm);
    border: 2px solid var(--secondary-200);
    border-radius: var(--radius-lg);
    transition: var(--transition-base);
    background: white;
    box-shadow: var(--shadow-sm);
}

.filter-group input:focus,
.filter-group select:focus {
    border-color: var(--primary-500);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1), var(--shadow-md);
    transform: translateY(-1px);
}

.filter-indicator {
    background: var(--primary-500);
    color: white;
    padding: var(--space-3) var(--space-6);
    border-radius: var(--radius-full);
    font-size: var(--text-sm);
    font-weight: 600;
    margin: var(--space-4) 0;
    text-align: center;
    display: none;
    box-shadow: var(--shadow-base);
}

.filter-actions {
    display: flex;
    gap: var(--space-4);
    align-items: center;
    flex-wrap: wrap;
    justify-content: center;
    padding-top: var(--space-6);
    border-top: 2px solid var(--secondary-100);
}

.sync-info {
    font-size: var(--text-xs);
    color: var(--secondary-500);
    font-weight: 600;
    margin-left: auto;
}

/* ===== TABELA RESPONSIVA MELHORADA ===== */
.services-table-container {
    background: white;
    border-radius: var(--radius-xl);
    overflow: hidden;
    box-shadow: var(--shadow-2xl);
    border: 2px solid var(--secondary-100);
    margin-top: var(--space-8);
    position: relative;
}

.table-responsive {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
    scrollbar-color: var(--primary-500) var(--secondary-100);
}

.table-responsive::-webkit-scrollbar {
    height: 8px;
}

.table-responsive::-webkit-scrollbar-track {
    background: var(--secondary-100);
    border-radius: var(--radius-full);
}

.table-responsive::-webkit-scrollbar-thumb {
    background: var(--primary-500);
    border-radius: var(--radius-full);
}

.table-responsive::-webkit-scrollbar-thumb:hover {
    background: var(--primary-600);
}

.services-table {
    width: 100%;
    min-width: 1400px;
    border-collapse: collapse;
    font-size: var(--text-sm);
}

.services-table th {
    background: linear-gradient(135deg, var(--secondary-800) 0%, var(--secondary-900) 100%);
    color: white;
    padding: var(--space-6) var(--space-4);
    text-align: left;
    font-weight: 700;
    font-size: var(--text-xs);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    position: sticky;
    top: 0;
    z-index: 10;
    white-space: nowrap;
}

.services-table td {
    padding: var(--space-5) var(--space-4);
    border-bottom: 1px solid var(--secondary-100);
    vertical-align: middle;
    white-space: nowrap;
}

.services-table tr:hover {
    background: var(--secondary-50);
}

.services-table tr:last-child td {
    border-bottom: none;
}

/* Larguras específicas das colunas */
.th-id { min-width: 80px; }
.th-cliente { min-width: 200px; }
.th-tipo { min-width: 100px; }
.th-pessoas { min-width: 90px; }
.th-bagagens { min-width: 100px; }
.th-data { min-width: 120px; }
.th-hora { min-width: 100px; }
.th-contacto { min-width: 150px; }
.th-voo { min-width: 100px; }
.th-rota { min-width: 250px; }
.th-valor { min-width: 120px; }
.th-hotel { min-width: 120px; }
.th-hub { min-width: 120px; }
.th-comissao { min-width: 140px; }
.th-pagamento { min-width: 130px; }
.th-pago-para { min-width: 120px; }
.th-status { min-width: 120px; }
.th-acoes { min-width: 150px; }

/* ===== ESTADOS E BADGES MELHORADOS ===== */
.status {
    padding: var(--space-2) var(--space-4);
    border-radius: var(--radius-full);
    font-size: var(--text-xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    display: inline-block;
    border: 2px solid;
}

.status-solicitado {
    background: var(--warning-50);
    color: var(--warning-700);
    border-color: var(--warning-500);
}

.status-confirmado {
    background: var(--success-50);
    color: var(--success-700);
    border-color: var(--success-500);
}

.status-finalizado {
    background: var(--primary-50);
    color: var(--primary-700);
    border-color: var(--primary-500);
}

.status-cancelado {
    background: var(--danger-50);
    color: var(--danger-700);
    border-color: var(--danger-500);
}

.payment-method {
    font-weight: 700;
    padding: var(--space-1) var(--space-4);
    border-radius: var(--radius-full);
    font-size: var(--text-xs);
    display: inline-block;
    border: 2px solid;
}

.payment-cash {
    background: var(--success-50);
    color: var(--success-700);
    border-color: var(--success-500);
}

.payment-card {
    background: var(--primary-50);
    color: var(--primary-700);
    border-color: var(--primary-500);
}

.payment-transfer {
    background: var(--warning-50);
    color: var(--warning-700);
    border-color: var(--warning-500);
}

.pago-para {
    font-weight: 700;
    padding: var(--space-1) var(--space-4);
    border-radius: var(--radius-full);
    font-size: var(--text-xs);
    display: inline-block;
    border: 2px solid;
}

.pago-recepcao {
    background: var(--primary-50);
    color: var(--primary-700);
    border-color: var(--primary-500);
}

.pago-motorista {
    background: var(--success-50);
    color: var(--success-700);
    border-color: var(--success-500);
}

/* ===== BOTÕES DE AÇÃO NA TABELA ===== */
.action-buttons {
    display: flex;
    gap: var(--space-1);
    flex-wrap: wrap;
    justify-content: center;
}

.btn-small {
    padding: var(--space-2) var(--space-3);
    font-size: var(--text-xs);
    border-radius: var(--radius-base);
    min-width: 40px;
    height: 40px;
    text-align: center;
    transition: var(--transition-base);
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-sm);
    font-weight: 700;
}

.btn-small:hover {
    transform: translateY(-2px) scale(1.05);
    box-shadow: var(--shadow-md);
}

.client-info {
    font-weight: 700;
    color: var(--secondary-800);
    line-height: 1.4;
}

.value-highlight {
    font-weight: 800;
    color: var(--success-600);
    font-size: var(--text-lg);
}

/* ===== ESTADO VAZIO MELHORADO ===== */
.empty-state {
    text-align: center;
    padding: var(--space-20) var(--space-6);
    color: var(--secondary-500);
}

.empty-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-4);
}

.empty-icon {
    font-size: var(--text-5xl);
    margin-bottom: var(--space-4);
}

.empty-state h3 {
    font-size: var(--text-2xl);
    margin-bottom: var(--space-3);
    color: var(--secondary-700);
    font-weight: 700;
}

.empty-state p {
    font-size: var(--text-base);
    margin-bottom: var(--space-6);
    max-width: 400px;
}

/* ===== INDICADOR DE SCROLL PARA MOBILE ===== */
.table-scroll-hint {
    display: none;
    background: var(--primary-50);
    padding: var(--space-3);
    text-align: center;
    border-top: 2px solid var(--primary-200);
}

.scroll-indicator {
    font-size: var(--text-sm);
    color: var(--primary-700);
    font-weight: 600;
    animation: scrollHint 2s ease-in-out infinite;
}

@keyframes scrollHint {
    0%, 100% { opacity: 0.7; }
    50% { opacity: 1; }
}

/* ===== LINHAS ESPECIAIS DA TABELA ===== */
.tour-row {
    background: linear-gradient(135deg, #fff8e1 0%, #fff3c4 100%) !important;
    border-left: 6px solid var(--warning-500);
}

.tour-row:hover {
    background: linear-gradient(135deg, #fff3c4 0%, #ffecb3 100%) !important;
}

.airport-to-hotel-row {
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%) !important;
    border-left: 6px solid var(--primary-500);
}

.airport-to-hotel-row:hover {
    background: linear-gradient(135deg, #bbdefb 0%, #90caf9 100%) !important;
}

/* ===== RESPONSIVIDADE ESPECÍFICA ===== */
@media (max-width: 1024px) {
    .filters-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .filter-actions {
        flex-direction: column;
        align-items: stretch;
    }
    
    .sync-info {
        margin-left: 0;
        text-align: center;
    }
}

@media (max-width: 768px) {
    .summary-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-4);
    }
    
    .financial-grid {
        grid-template-columns: 1fr;
    }
    
    .filters-grid {
        grid-template-columns: 1fr;
    }
    
    .services-table {
        min-width: 1200px;
    }
    
    .table-scroll-hint {
        display: block;
    }
    
    .services-section {
        padding: var(--space-6);
    }
}

@media (max-width: 480px) {
    .summary-grid {
        grid-template-columns: 1fr;
    }
    
    .services-table {
        min-width: 1000px;
    }
    
    .btn-small {
        padding: var(--space-1) var(--space-2);
        min-width: 36px;
        height: 36px;
        font-size: var(--text-xs);
    }
}
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Sistema de Parceria</h1>
            <p>Gestão de Transfers - Colaboração Empresarial</p>
            <div class="company-logos">
                <div class="company-logo">Empire Marques Hotel</div>
                <div class="company-logo">HUB Transfer</div>
            </div>
        </div>

        <!-- Indicador de Sincronização -->
        <div class="sync-indicator" id="syncIndicator">
            <span>🔄</span> Sincronizando...
        </div>

        <!-- Seção de Configuração -->
        <div class="config-section" id="configSection">
            <div class="config-title">⚙️ Configuração do Google Sheets</div>
            <div class="config-form">
                <div class="config-input">
                    <label for="webappUrl">
                        🔗 URL do Google Apps Script:
                    </label>
                    <input type="url" id="webappUrl" 
                           value="https://script.google.com/macros/s/AKfycbzv-02u9UuWaSP7yhgPgNMETSJ1kjyzEPRivmhXen_LzX6efxPEyQXRMo2bNSZ7ndQJwA/exec" 
                           placeholder="https://script.google.com/macros/s/...">
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-success" onclick="testConnection()" id="testBtn">
                        ✅ Testar Conexão
                    </button>
                    <button type="button" class="btn btn-export" onclick="toggleConfig()">
                        ✖️ Fechar
                    </button>
                </div>
            </div>
            <div id="connectionStatus" class="status-message"></div>
        </div>

        <!-- Seção de Limpeza de Dados -->
        <div class="clear-data-section" id="clearDataSection">
            <div class="clear-data-title">🗑️ Limpeza de Dados</div>
            <div class="clear-data-warning">
                Esta operação irá remover PERMANENTEMENTE todos os registros de transfers do sistema!
                <br><strong>Esta ação não pode ser desfeita.</strong>
            </div>
            <div class="clear-data-actions">
                <button type="button" class="btn btn-danger" onclick="clearAllData()" id="clearDataBtn">
                    🗑️ Limpar Todos os Dados
                </button>
                <button type="button" class="btn btn-warning" onclick="clearTestData()" id="clearTestBtn">
                    🧪 Limpar Apenas Testes
                </button>
                <button type="button" class="btn btn-clear" onclick="toggleClearData()">
                    ✖️ Fechar
                </button>
            </div>
        </div>

        <div class="quick-add">
            <h2>🚗 Solicitar Novo Transfer</h2>
            
            <form id="transferForm">
                <div class="form-container">
                    <!-- Linha 1: Nome do Cliente -->
                    <div class="form-section">
                        <div class="form-section-title">👤 Informações do Cliente</div>
                        <div class="form-row-compact single">
                            <div class="form-group full-width">
                                <label for="nomeCliente">
                                    👤 Nome do Cliente *
                                </label>
                                <input type="text" id="nomeCliente" required placeholder="Ex: João Silva">
                            </div>
                        </div>
                    </div>

                    <!-- Linha 2: Tipo de Serviço -->
                    <div class="form-section">
                        <div class="form-section-title">🚗 Tipo de Serviço</div>
                        <div class="form-row-compact">
                            <div class="form-group">
                                <label>Selecione o Tipo de Serviço</label>
                                <div class="service-buttons">
                                    <button type="button" class="btn-service active" onclick="setServiceType('transfer')">
                                        🚗 Transfer
                                    </button>
                                    <button type="button" class="btn-service" onclick="setServiceType('tour')">
                                        🎯 Tour Regular
                                    </button>
                                    <button type="button" class="btn-service" onclick="setServiceType('private')">
                                        👑 Private Tour
                                    </button>
                                </div>
                            </div>
                            
<div class="form-group tour-selector" id="tourSelector">
                                <label for="tourSelecionado">🎪 Selecione o Tour</label>
                                <select id="tourSelecionado" onchange="updateTourPrice()">
                                    <option value="">Escolha o tour...</option>
                                    <optgroup label="Tours Regulares (Por Pessoa)">
                                        <option value="tour-sintra-cascais" data-price="67" data-type="regular">
                                            Sintra e Cascais (8h) - €67/pessoa
                                        </option>
                                        <option value="tour-fatima-obidos" data-price="83" data-type="regular">
                                            Fátima e Óbidos (8h) - €83/pessoa
                                        </option>
                                        <option value="tour-combo-2dias" data-price="138" data-type="regular">
                                            Combo 2 Dias (16h) - €138/pessoa
                                        </option>
                                    </optgroup>
                                    <optgroup label="Private Tours (Por Grupo)">
                                        <option value="private-sintra-palaces" data-price-small="347" data-price-large="492" data-type="private">
                                            Palaces of Sintra - €347 (1-3) / €492 (4-8)
                                        </option>
                                        <option value="private-evora" data-price-small="347" data-price-large="492" data-type="private">
                                            Évora City - €347 (1-3) / €492 (4-8)
                                        </option>
                                        <option value="private-templars" data-price-small="347" data-price-large="492" data-type="private">
                                            Templars - €347 (1-3) / €492 (4-8)
                                        </option>
                                        <option value="private-arrabida" data-price-small="347" data-price-large="492" data-type="private">
                                            Arrábida - €347 (1-3) / €492 (4-8)
                                        </option>
                                    </optgroup>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Linha 3: Pessoas e Bagagens -->
                    <div class="form-section">
                        <div class="form-section-title">👥 Capacidade e Bagagens</div>
                        <div class="form-row-compact">
                            <div class="form-group">
                                <label for="numeroPessoas">👥 Número de Pessoas *</label>
                                <div class="people-buttons">
                                    <button type="button" class="btn-people" onclick="setPeople(1)">1</button>
                                    <button type="button" class="btn-people" onclick="setPeople(2)">2</button>
                                    <button type="button" class="btn-people" onclick="setPeople(3)">3</button>
                                    <button type="button" class="btn-people" onclick="setPeople(4)">4</button>
                                    <button type="button" class="btn-people" onclick="setPeople(5)">5</button>
                                    <button type="button" class="btn-people" onclick="setPeople(6)">6</button>
                                    <button type="button" class="btn-people" onclick="setPeople(7)">7</button>
                                    <button type="button" class="btn-people" onclick="setPeople(8)">8+</button>
                                </div>
                                <input type="number" id="numeroPessoas" min="1" max="20" required style="display: none;" onchange="updateCalculation()">
                            </div>
                            
                            <div class="form-group">
                                <label for="numeroBagagens">🧳 Número de Bagagens</label>
                                <div class="baggage-buttons">
                                    <button type="button" class="btn-baggage" onclick="setBaggage(0)">0</button>
                                    <button type="button" class="btn-baggage" onclick="setBaggage(1)">1</button>
                                    <button type="button" class="btn-baggage" onclick="setBaggage(2)">2</button>
                                    <button type="button" class="btn-baggage" onclick="setBaggage(3)">3</button>
                                    <button type="button" class="btn-baggage" onclick="setBaggage(4)">4</button>
                                    <button type="button" class="btn-baggage" onclick="setBaggage(5)">5</button>
                                    <button type="button" class="btn-baggage" onclick="setBaggage(6)">6+</button>
                                </div>
                                <input type="number" id="numeroBagagens" min="0" max="20" value="0" style="display: none;">
                            </div>
                        </div>
                    </div>

                    <!-- Linha 4: Data e Hora -->
                    <div class="form-section">
                        <div class="form-section-title">📅 Agendamento</div>
                        <div class="form-row-compact">
                            <div class="form-group date-field">
                                <label for="data">📅 Data do Transfer *</label>
                                <div class="date-buttons">
                                    <button type="button" class="btn-date" onclick="setDate('today')">Hoje</button>
                                    <button type="button" class="btn-date" onclick="setDate('tomorrow')">Amanhã</button>
                                </div>
                                <input type="date" id="data" required>
                            </div>
                            
                            <div class="form-group time-field">
                                <label for="horaPickup">🕐 Hora de Pick-up *</label>
                                <div class="time-picker-container">
                                    <input type="time" id="horaPickup" required class="time-picker-input">
                                    <div class="time-buttons">
                                        <button type="button" class="btn-time" onclick="setTime('06:00')">06:00</button>
                                        <button type="button" class="btn-time" onclick="setTime('07:00')">07:00</button>
                                        <button type="button" class="btn-time" onclick="setTime('08:00')">08:00</button>
                                        <button type="button" class="btn-time" onclick="setTime('09:00')">09:00</button>
                                        <button type="button" class="btn-time" onclick="setTime('10:00')">10:00</button>
                                        <button type="button" class="btn-time" onclick="setTime('11:00')">11:00</button>
                                        <button type="button" class="btn-time" onclick="setTime('12:00')">12:00</button>
                                        <button type="button" class="btn-time" onclick="setTime('13:00')">13:00</button>
                                        <button type="button" class="btn-time" onclick="setTime('14:00')">14:00</button>
                                        <button type="button" class="btn-time" onclick="setTime('15:00')">15:00</button>
                                        <button type="button" class="btn-time" onclick="setTime('16:00')">16:00</button>
                                        <button type="button" class="btn-time" onclick="setTime('17:00')">17:00</button>
                                        <button type="button" class="btn-time" onclick="setTime('18:00')">18:00</button>
                                        <button type="button" class="btn-time" onclick="setTime('19:00')">19:00</button>
                                        <button type="button" class="btn-time" onclick="setTime('20:00')">20:00</button>
                                        <button type="button" class="btn-time" onclick="setTime('21:00')">21:00</button>
                                        <button type="button" class="btn-time" onclick="setTime('22:00')">22:00</button>
                                        <button type="button" class="btn-time" onclick="setTime('23:00')">23:00</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Linha 5: Contacto e Voo -->
                    <div class="form-section">
                        <div class="form-section-title">📞 Contacto e Voo</div>
                        <div class="form-row-compact">
                            <div class="form-group">
                                <label for="contacto">📞 Contacto do Cliente *</label>
                                <div class="phone-container">
                                    <input type="tel" id="contacto" required placeholder="Digite o número...">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="numeroVoo">✈️ Número do Voo</label>
                                <input type="text" id="numeroVoo" placeholder="Ex: TP1234" onblur="createFlightLink()">
                                <div id="flightLink" class="flight-link-container"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Linha 6: Origem e Destino -->
                    <div class="form-section">
                        <div class="form-section-title">📍 Localizações</div>
                        <div class="form-row-compact">
                            <div class="form-group">
                                <label for="origem">📍 Local de Origem *</label>
                                <div class="location-buttons">
                                    <button type="button" class="btn-location origem-btn" onclick="setOrigin('Aeroporto de Lisboa')">
                                        ✈️ Aeroporto de Lisboa
                                    </button>
                                    <button type="button" class="btn-location origem-btn" onclick="setOrigin('Empire Marques Hotel')">
                                        🏨 Empire Marques Hotel
                                    </button>
                                </div>
                                <input type="text" id="origem" required placeholder="Digite ou escolha o endereço...">
                            </div>
                            
                            <div class="form-group">
                                <label for="destino">🎯 Local de Destino *</label>
                                <div class="location-buttons">
                                    <button type="button" class="btn-location destino-btn" onclick="setDestination('Empire Marques Hotel')">
                                        🏨 Empire Marques Hotel
                                    </button>
                                    <button type="button" class="btn-location destino-btn" onclick="setDestination('Aeroporto de Lisboa')">
                                        ✈️ Aeroporto de Lisboa
                                    </button>
                                </div>
                                <input type="text" id="destino" required placeholder="Digite ou escolha o endereço...">
                            </div>
                        </div>
                    </div>

                    <!-- Linha 7: Valor do Serviço -->
                    <div class="form-section">
                        <div class="form-section-title">💰 Valor do Serviço</div>
                        <div class="form-row-compact single">
                            <div class="form-group">
                                <label for="valorTotal">💰 Valor do Serviço (€) *</label>
                                <div class="price-buttons">
                                    <button type="button" class="btn-price" onclick="setPrice(25)">€25</button>
                                    <button type="button" class="btn-price" onclick="setPrice(35)">€35</button>
                                    <button type="button" class="btn-price" onclick="setPrice(45)">€45</button>
                                    <button type="button" class="btn-price" onclick="setPrice(60)">€60</button>
                                    <button type="button" class="btn-price" onclick="setPrice(75)">€75</button>
                                    <button type="button" class="btn-price" onclick="setPrice(100)">€100</button>
                                </div>
                                <input type="number" id="valorTotal" step="0.01" required placeholder="Ou digite valor...">
                            </div>
                        </div>
                    </div>

                    <!-- Linha 8: Forma de Pagamento -->
                    <div class="form-section">
                        <div class="form-section-title">💳 Pagamento</div>
                        <div class="form-row-compact">
                            <div class="form-group">
                                <label for="modoPagamento">💳 Forma de Pagamento *</label>
                                <div class="payment-buttons">
                                    <button type="button" class="btn-payment" onclick="setPayment('Dinheiro')">
                                        💵 Dinheiro
                                    </button>
                                    <button type="button" class="btn-payment" onclick="setPayment('Cartão')">
                                        💳 Cartão
                                    </button>
                                    <button type="button" class="btn-payment" onclick="setPayment('Transferência')">
                                        🏦 Transferência
                                    </button>
                                </div>
                                <select id="modoPagamento" required style="display: none;">
                                    <option value="">Selecionar...</option>
                                    <option value="Dinheiro">Dinheiro</option>
                                    <option value="Cartão">Cartão</option>
                                    <option value="Transferência">Transferência Bancária</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="pagoParaQuem">👤 Pago Para *</label>
                                <div class="payment-to-buttons">
                                    <button type="button" class="btn-payment-to" onclick="setPaymentTo('Recepção')">
                                        🏨 Recepção
                                    </button>
                                    <button type="button" class="btn-payment-to" onclick="setPaymentTo('Motorista')">
                                        👨‍✈️ Motorista
                                    </button>
                                </div>
                                <select id="pagoParaQuem" required style="display: none;">
                                    <option value="">Selecionar...</option>
                                    <option value="Recepção">Recepção</option>
                                    <option value="Motorista">Motorista</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Linha 9: Observações -->
                    <div class="form-section">
                        <div class="form-section-title">📝 Observações</div>
                        <div class="form-row-compact single">
                            <div class="form-group full-width">
                                <label for="observacoes">📝 Observações Adicionais</label>
                                <div class="obs-buttons">
                                    <button type="button" class="btn-obs" onclick="addObservation('Bagagem extra')">Bagagem Extra</button>
                                    <button type="button" class="btn-obs" onclick="addObservation('Transfer urgente')">Urgente</button>
                                    <button type="button" class="btn-obs" onclick="addObservation('Cliente VIP')">VIP</button>
                                    <button type="button" class="btn-obs" onclick="addObservation('Com criança')">Com Criança</button>
                                </div>
                                <textarea id="observacoes" rows="3" placeholder="Informações adicionais sobre o transfer..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Box de Cálculo de Preço -->
                <div class="price-calculation-box" id="priceCalculationBox">
                    <div class="calculation-header">💰 Cálculo Detalhado do Valor</div>
                    <div class="calculation-details">
                        <div class="calculation-row">
                            <span class="calculation-label">Tipo de Serviço:</span>
                            <span class="calculation-value" id="calcTipoServico">-</span>
                        </div>
                        <div class="calculation-row">
                            <span class="calculation-label">Preço Unitário:</span>
                            <span class="calculation-value" id="calcPrecoUnitario">€0</span>
                        </div>
                        <div class="calculation-row">
                            <span class="calculation-label">Quantidade de Pessoas:</span>
                            <span class="calculation-value" id="calcPessoas">0</span>
                        </div>
                    </div>
                    <div class="calculation-total">
                        VALOR TOTAL: €<span id="calcTotal">0</span>
                    </div>
                    
                    <!-- Campos Admin -->
                    <div class="admin-fields" id="adminFields">
                        <div class="calculation-row">
                            <span class="calculation-label">Valor Empire Marques Hotel (30%):</span>
                            <span class="calculation-value" id="calcHotel">€0</span>
                        </div>
                        <div class="calculation-row">
                            <span class="calculation-label">Valor HUB Transfer:</span>
                            <span class="calculation-value" id="calcHUB">€0</span>
                        </div>
                        <div class="calculation-row">
                            <span class="calculation-label">Comissão Recepção:</span>
                            <span class="calculation-value" id="calcRecepcao">€0</span>
                        </div>
                    </div>
                </div>

                <!-- Botões de Ação -->
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        🚗 Solicitar Transfer
                    </button>
                    <button type="button" class="btn btn-clear" onclick="clearForm()">
                        🧹 Limpar Formulário
                    </button>
                    <button type="button" class="btn btn-export" onclick="exportToCSV()">
                        📊 Exportar CSV
                    </button>
                    <button type="button" class="btn btn-success" onclick="syncWithServer()" id="syncBtn">
                        🔄 Atualizar Dados
                    </button>
                    <button type="button" class="btn btn-config" onclick="toggleConfig()">
                        ⚙️ Configurar
                    </button>
                    <button type="button" class="btn btn-danger" onclick="toggleClearData()">
                        🗑️ Limpar Dados
                    </button>
                </div>
            </form>
        </div>

<!-- Seção de Resumo -->
        <div class="summary-section">
            <!-- Indicador de Filtros -->
            <div class="filter-indicator" id="filterIndicator"></div>

            <div class="summary-grid">
                <div class="summary-card">
                    <div class="summary-number" id="totalServices">0</div>
                    <div class="summary-label">Total de Serviços</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" id="pendingServices">0</div>
                    <div class="summary-label">Solicitados</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" id="confirmedServices">0</div>
                    <div class="summary-label">Confirmados</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" id="completedServices">0</div>
                    <div class="summary-label">Finalizados</div>
                </div>
            </div>

            <div class="financial-summary">
                <h3>Resumo Financeiro</h3>
                <div class="financial-grid">
                    <div class="financial-item">
                        <div class="financial-value" id="totalRevenue">€0.00</div>
                        <div class="financial-label">Receita Total</div>
                    </div>
                    <div class="financial-item">
                        <div class="financial-value" id="pendingRevenue">€0.00</div>
                        <div class="financial-label">Valor Pendente</div>
                    </div>
                    <div class="financial-item">
                        <div class="financial-value" id="confirmedRevenue">€0.00</div>
                        <div class="financial-label">Valor Confirmado</div>
                    </div>
                    <div class="financial-item">
                        <div class="financial-value" id="completedRevenue">€0.00</div>
                        <div class="financial-label">Valor Finalizado</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Seção de Serviços e Filtros -->
        <div class="services-section">
            <div class="services-header">
                <h2 class="services-title">Serviços de Transfer</h2>
                
                <!-- Sistema de Filtros Melhorado -->
                <div class="filters-container">
                    <div class="filters-grid">
                        <div class="filter-group">
                            <label for="filterDateStart">Data Início:</label>
                            <input type="date" id="filterDateStart" onchange="updateDateFilter()">
                        </div>
                        <div class="filter-group">
                            <label for="filterDateEnd">Data Fim:</label>
                            <input type="date" id="filterDateEnd" onchange="updateDateFilter()">
                        </div>
                        <div class="filter-group">
                            <label for="quickPeriodSelect">Períodos Rápidos:</label>
                            <select id="quickPeriodSelect" onchange="applyQuickPeriod()">
                                <option value="">Personalizado</option>
                                <option value="today">Hoje</option>
                                <option value="yesterday">Ontem</option>
                                <option value="thisWeek">Esta Semana</option>
                                <option value="lastWeek">Semana Passada</option>
                                <option value="thisMonth">Este Mês</option>
                                <option value="lastMonth">Mês Passado</option>
                                <option value="last7days">Últimos 7 Dias</option>
                                <option value="last30days">Últimos 30 Dias</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="filterStatus">Status:</label>
                            <select id="filterStatus" onchange="updateStatusFilter()">
                                <option value="">Todos</option>
                                <option value="Solicitado">Solicitado</option>
                                <option value="Confirmado">Confirmado</option>
                                <option value="Finalizado">Finalizado</option>
                                <option value="Cancelado">Cancelado</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="searchClient">Cliente:</label>
                            <input type="text" id="searchClient" placeholder="Buscar..." onkeyup="updateClientFilter()">
                        </div>
                        <div class="filter-group">
                            <label for="filterTipoServico">Tipo Serviço:</label>
                            <select id="filterTipoServico" onchange="updateServiceTypeFilter()">
                                <option value="">Todos</option>
                                <option value="Transfer">Transfer</option>
                                <option value="Tour Regular">Tour Regular</option>
                                <option value="Private Tour">Private Tour</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="filter-actions">
                        <button type="button" class="btn btn-primary" onclick="applyAllFilters()">
                            Aplicar Filtros
                        </button>
                        <button type="button" class="btn btn-clear" onclick="clearAllFilters()">
                            Limpar Filtros
                        </button>
                        <button type="button" class="btn btn-success" onclick="loadTransfersFromSheets()">
                            Carregar Transfers
                        </button>
                        <button type="button" class="btn btn-warning" onclick="testBasicConnectivity()">
                            Testar Conexão
                        </button>
                        <div class="sync-info">
                            <span id="lastSyncDisplay"></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tabela Responsiva Melhorada -->
            <div class="services-table-container">
                <div class="table-responsive">
                    <table id="servicesTable" class="services-table">
                        <thead>
                            <tr>
                                <th class="th-id">ID</th>
                                <th class="th-cliente">Cliente</th>
                                <th class="th-tipo">Tipo</th>
                                <th class="th-pessoas">Pessoas</th>
                                <th class="th-bagagens">Bagagens</th>
                                <th class="th-data">Data</th>
                                <th class="th-hora">Hora Pick-up</th>
                                <th class="th-contacto">Contacto</th>
                                <th class="th-voo">Voo</th>
                                <th class="th-rota">Rota</th>
                                <th class="th-valor">Valor Total</th>
                                <th class="th-hotel admin-column" style="display: none;">Valor Hotel</th>
                                <th class="th-hub admin-column" style="display: none;">Valor HUB</th>
                                <th class="th-comissao admin-column" style="display: none;">Comissão Recepção</th>
                                <th class="th-pagamento">Pagamento</th>
                                <th class="th-pago-para">Pago Para</th>
                                <th class="th-status">Status</th>
                                <th class="th-acoes">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="servicesTableBody">
                            <tr>
                                <td colspan="18" class="empty-state">
                                    <div class="empty-content">
                                        <div class="empty-icon">📋</div>
                                        <h3>Nenhum serviço cadastrado</h3>
                                        <p>Use o botão "Carregar Transfers" para sincronizar com o Google Sheets</p>
                                        <button class="btn btn-success" onclick="loadTransfersFromSheets()">
                                            Carregar Transfers
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Controles de Scroll Horizontal para Mobile -->
                <div class="table-scroll-hint">
                    <span class="scroll-indicator">← Deslize para ver mais colunas →</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Botão Admin -->
    <div class="admin-toggle" onclick="toggleAdminMode()">
        🔐 Admin
    </div>

    <script>
        // =====================================================
        // VARIÁVEIS GLOBAIS
        // =====================================================
        let services = [];
        let editingId = null;
        let phoneInput = null;
        let isConnected = false;
        let isAdminMode = false;
        let currentServiceType = 'transfer';
        let precoUnitarioAtual = 0;
        let syncInProgress = false;
        let lastSyncTime = null;
        let serverData = [];
        let nextAvailableId = 1;
        
        let activeFilters = {
            dateStart: null,
            dateEnd: null,
            status: '',
            cliente: '',
            quickPeriod: '',
            tipoServico: ''
        };
        
        let filteredData = [];
        let isFiltering = false;

// Variáveis de paginação
let currentPage = 1;
let itemsPerPage = 10;
let totalPages = 1;

function updatePagination() {
    const totalItems = services.length;
    totalPages = Math.ceil(totalItems / itemsPerPage);
    
    // Criar controles de paginação se não existirem
    let paginationContainer = document.getElementById('paginationContainer');
    if (!paginationContainer) {
        paginationContainer = document.createElement('div');
        paginationContainer.id = 'paginationContainer';
        paginationContainer.className = 'pagination-container';
        
        const servicesTable = document.querySelector('.services-table');
        servicesTable.parentNode.insertBefore(paginationContainer, servicesTable.nextSibling);
    }
    
    paginationContainer.innerHTML = `
        <div class="pagination-info">
            Mostrando ${Math.min(((currentPage - 1) * itemsPerPage) + 1, totalItems)} a ${Math.min(currentPage * itemsPerPage, totalItems)} de ${totalItems} transfers
        </div>
        <div class="pagination-controls">
            <button class="btn-pagination" onclick="changePage(1)" ${currentPage === 1 ? 'disabled' : ''}>
                ««
            </button>
            <button class="btn-pagination" onclick="changePage(currentPage - 1)" ${currentPage === 1 ? 'disabled' : ''}>
                ‹ Anterior
            </button>
            <span style="margin: 0 15px; font-weight: 600;">
                Página ${currentPage} de ${totalPages}
            </span>
            <button class="btn-pagination" onclick="changePage(currentPage + 1)" ${currentPage === totalPages ? 'disabled' : ''}>
                Próxima ›
            </button>
            <button class="btn-pagination" onclick="changePage(totalPages)" ${currentPage === totalPages ? 'disabled' : ''}>
                »»
            </button>
        </div>
        <select class="page-size-selector" onchange="changePageSize(this.value)">
            <option value="10" ${itemsPerPage === 10 ? 'selected' : ''}>10 por página</option>
            <option value="25" ${itemsPerPage === 25 ? 'selected' : ''}>25 por página</option>
            <option value="50" ${itemsPerPage === 50 ? 'selected' : ''}>50 por página</option>
        </select>
    `;
}

function changePage(page) {
    if (page < 1 || page > totalPages) return;
    currentPage = page;
    renderTable();
}

function changePageSize(size) {
    itemsPerPage = parseInt(size);
    currentPage = 1;
    renderTable();
}

function getPaginatedServices() {
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    return services.slice(startIndex, endIndex);
}

        // CONFIGURAÇÕES
        const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbzv-02u9UuWaSP7yhgPgNMETSJ1kjyzEPRivmhXen_LzX6efxPEyQXRMo2bNSZ7ndQJwA/exec';
        const TEST_EMAIL = 'juniorgutierezbega@gmail.com';
        const SPREADSHEET_ID = '1ZfG_IXBWMbGQzCmn7nWNzFqUBbGkXCXWSnY7JYziHxI';
        
        // TOURS E PREÇOS
        const TOURS_DATA = {
            'tour-sintra-cascais': { name: 'Sintra e Cascais (8h)', price: 67, type: 'regular' },
            'tour-fatima-obidos': { name: 'Fátima e Óbidos (8h)', price: 83, type: 'regular' },
            'tour-combo-2dias': { name: 'Combo 2 Dias (16h)', price: 138, type: 'regular' },
            'private-sintra-palaces': { name: 'Private Palaces of Sintra', priceSmall: 347, priceLarge: 492, type: 'private' },
            'private-evora': { name: 'Private Évora City', priceSmall: 347, priceLarge: 492, type: 'private' },
            'private-templars': { name: 'Private Templars', priceSmall: 347, priceLarge: 492, type: 'private' },
            'private-arrabida': { name: 'Private Arrábida', priceSmall: 347, priceLarge: 492, type: 'private' }
        };

        // =====================================================
        // FUNÇÕES DE CONFIGURAÇÃO E STATUS
        // =====================================================
        function toggleConfig() {
    const configSection = document.getElementById('configSection');
    if (configSection) {
        configSection.classList.toggle('show');
    }
    console.log('toggleConfig executada');
}

        function toggleClearData() {
            const clearSection = document.getElementById('clearDataSection');
            if (clearSection) {
                clearSection.classList.toggle('show');
            }
        }

        function showStatus(message, type = 'success') {
            const statusDiv = document.getElementById('connectionStatus');
            if (!statusDiv) {
                console.warn('Elemento connectionStatus não encontrado');
                return;
            }
            
            statusDiv.className = `status-message status-${type}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
            
            console.log(`Status: ${type} - ${message}`);
            
            setTimeout(() => {
                if (statusDiv) {
                    statusDiv.style.display = 'none';
                }
            }, 5000);
        }

        function setButtonLoading(buttonId, loading = true) {
            const button = document.getElementById(buttonId);
            if (!button) return;
            
            if (loading) {
                button.disabled = true;
                button.classList.add('loading');
                const originalText = button.textContent;
                button.setAttribute('data-original-text', originalText);
                button.textContent = '';
            } else {
                button.disabled = false;
                button.classList.remove('loading');
                const originalText = button.getAttribute('data-original-text');
                if (originalText) {
                    button.textContent = originalText;
                } else {
                    // Textos padrão se não houver original
                    if (buttonId === 'testBtn') button.textContent = 'Testar Conexão';
                    else if (buttonId === 'submitBtn') button.textContent = 'Solicitar Transfer';
                    else if (buttonId === 'syncBtn') button.textContent = 'Atualizar Dados';
                    else if (buttonId === 'clearDataBtn') button.textContent = 'Limpar Todos os Dados';
                    else if (buttonId === 'clearTestBtn') button.textContent = 'Limpar Apenas Testes';
                }
            }
        }

// =====================================================
        // FUNÇÕES DE CONEXÃO E TESTE
        // =====================================================
        async function testConnection() {
            const url = document.getElementById('webappUrl').value.trim() || WEBAPP_URL;
            
            if (!url) {
                showStatus('Por favor, insira a URL do Google Apps Script!', 'error');
                return;
            }
            
            setButtonLoading('testBtn', true);
            
            try {
                const response = await fetch(url + '?action=test', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    isConnected = true;
                    showStatus('Conexão funcionando perfeitamente!', 'success');
                    saveWebappUrl();
                    document.getElementById('syncBtn').style.display = 'inline-block';
                } else {
                    throw new Error('Resposta não OK');
                }
                
            } catch (error) {
                try {
                    await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'text/plain',
                        },
                        body: JSON.stringify({ action: 'test' }),
                        mode: 'no-cors'
                    });
                    
                    isConnected = true;
                    showStatus('Conexão estabelecida (modo limitado)', 'success');
                    saveWebappUrl();
                    document.getElementById('syncBtn').style.display = 'inline-block';
                    
                } catch (fallbackError) {
                    showStatus('Erro ao conectar. Verifique a URL e o deploy', 'error');
                    isConnected = false;
                }
            } finally {
                setButtonLoading('testBtn', false);
            }
        }

        function saveWebappUrl() {
            const url = document.getElementById('webappUrl').value.trim() || WEBAPP_URL;
            if (url) {
                localStorage.setItem('webappUrl', url);
                document.getElementById('syncBtn').style.display = 'inline-block';
                isConnected = true;
            }
        }

        function getWebAppUrl() {
            const inputUrl = document.getElementById('webappUrl');
            if (inputUrl && inputUrl.value && inputUrl.value.trim() !== '') {
                return inputUrl.value.trim();
            }
            
            const savedUrl = localStorage.getItem('webappUrl');
            if (savedUrl && savedUrl.trim() !== '') {
                return savedUrl.trim();
            }
            
            return WEBAPP_URL;
        }

        async function testBasicConnectivity() {
            console.log('Testando conectividade básica...');
            
            const webappUrl = getWebAppUrl();
            
            try {
                const pingResponse = await fetch(webappUrl + '?ping=true', {
                    method: 'GET',
                    mode: 'no-cors'
                });
                
                console.log('Ping enviado');
                showStatus('Teste de conectividade enviado', 'success');
                
                const testData = {
                    action: 'test',
                    message: 'Sistema Empire Marques funcionando',
                    timestamp: new Date().toISOString()
                };
                
                await fetch(webappUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify(testData),
                    mode: 'no-cors'
                });
                
                console.log('Teste de conectividade completo');
                showStatus('Conectividade OK - Sistema funcionando', 'success');
                
            } catch (error) {
                console.error('Erro no teste de conectividade:', error);
                showStatus('Erro de conectividade: ' + error.message, 'error');
            }
        }

        // =====================================================
        // FUNÇÃO PRINCIPAL PARA CARREGAR TRANSFERS
        // =====================================================
            async function loadTransfersFromSheets() {
    console.log('Iniciando carregamento de transfers do Google Sheets...');
    
    const webappUrl = getWebAppUrl();
    console.log('URL configurada:', webappUrl);
    
    if (!webappUrl) {
        showStatus('URL do Google Apps Script não configurada', 'error');
        return false;
    }
    
    try {
        showStatus('Carregando transfers do Google Sheets...', 'warning');
        
        const dataUrl = `${webappUrl}?action=getAllData&_=${Date.now()}`;
        console.log('Fazendo requisição para:', dataUrl);
        
        const response = await fetch(dataUrl, {
            method: 'GET',
            mode: 'cors',
            cache: 'no-cache',
            headers: {
                'Accept': 'application/json'
            }
        });
        
        console.log('Status da resposta:', response.status, response.statusText);
        
        if (!response.ok) {
            throw new Error(`Erro HTTP ${response.status}: ${response.statusText}`);
        }
        
        const textResponse = await response.text();
        console.log('Resposta recebida - tamanho:', textResponse.length, 'caracteres');
        
        if (!textResponse || textResponse.trim() === '') {
            throw new Error('Resposta vazia do servidor');
        }
        
        let result;
        try {
            result = JSON.parse(textResponse);
        } catch (parseError) {
            console.error('Erro ao fazer parse do JSON:', parseError);
            console.log('Resposta bruta:', textResponse.substring(0, 500));
            throw new Error('Resposta do servidor não é um JSON válido');
        }
        
        console.log('Dados parseados:', result);
        
        // Verificar se a resposta indica sucesso
        if (!result) {
            throw new Error('Resposta nula do servidor');
        }
        
        if (result.success === false) {
            const errorMsg = result.error || result.message || 'Erro desconhecido no servidor';
            throw new Error(errorMsg);
        }
        
        // Se chegou até aqui, assumir sucesso
let dataArray = result.data || result || [];

// Garantir que dataArray é um array
if (!Array.isArray(dataArray)) {
    console.warn('Dados recebidos não são um array:', typeof dataArray);
    dataArray = [];
}

console.log(`${dataArray.length} registros recebidos do servidor`);

if (dataArray.length === 0) {
    showStatus('Nenhum transfer encontrado na planilha Google Sheets', 'warning');
    services = [];
    renderTable();
    updateSummary();
    return true;
}

// Converter dados do servidor com tratamento robusto de erros
const convertedServices = [];
let successCount = 0;
let errorCount = 0;

try {
    // Validar se dataArray é realmente um array
    if (!Array.isArray(dataArray)) {
        throw new Error('Dados recebidos não são um array válido');
    }
    
    // Processar cada item com controle detalhado
    for (let index = 0; index < dataArray.length; index++) {
        const serverItem = dataArray[index];
        
        // Validar item antes do processamento
        if (!serverItem || typeof serverItem !== 'object') {
            console.warn(`Item ${index} inválido:`, serverItem);
            errorCount++;
            continue;
        }
        
        try {
            const converted = convertServerDataToLocal(serverItem, index);
            
            if (converted && converted.nomeCliente && converted.nomeCliente !== 'Cliente não informado') {
                convertedServices.push(converted);
                successCount++;
            } else {
                console.warn(`Item ${index} convertido mas sem dados válidos:`, converted);
                errorCount++;
            }
            
        } catch (conversionError) {
            console.error(`Erro ao converter item ${index}:`, conversionError);
            console.error('Item problemático:', serverItem);
            errorCount++;
        }
    }
    
    // Log detalhado do resultado
    console.log(`Processamento concluído: ${successCount} sucessos, ${errorCount} erros`);
    console.log(`${convertedServices.length} transfers válidos convertidos`);
    
    // Verificar se obtivemos dados utilizáveis
    if (convertedServices.length === 0) {
        if (dataArray.length > 0) {
            showStatus(`${dataArray.length} registros recebidos mas nenhum pôde ser processado corretamente`, 'error');
            console.error('Dados originais do servidor:', dataArray.slice(0, 2)); // Log dos primeiros 2 para debug
        } else {
            showStatus('Nenhum transfer encontrado na planilha Google Sheets', 'warning');
        }
        return false;
    }
    
    // Validação adicional dos dados convertidos
    const validTransfers = convertedServices.filter(service => 
        service.id && 
        service.nomeCliente && 
        service.nomeCliente !== 'Cliente não informado' &&
        service.data
    );
    
    if (validTransfers.length < convertedServices.length) {
        console.warn(`${convertedServices.length - validTransfers.length} transfers com dados incompletos foram filtrados`);
    }
    
    if (validTransfers.length === 0) {
        showStatus('Transfers convertidos mas nenhum possui dados completos necessários', 'error');
        return false;
    }
    
    // Usar apenas os transfers válidos
    const finalServices = validTransfers;
    
} catch (processingError) {
    console.error('Erro durante o processamento dos dados:', processingError);
    showStatus(`Erro no processamento: ${processingError.message}`, 'error');
    return false;
}        
        // Substituir dados locais pelos do servidor
        services = convertedServices;
        
        // Salvar dados localmente e atualizar interface
        saveData();
        renderTable();
        updateSummary();
        
        // Atualizar indicadores de sincronização
        lastSyncTime = new Date();
        localStorage.setItem('lastSyncTime', lastSyncTime.toISOString());
        updateLastSyncDisplay();
        
        showStatus(`${services.length} transfers carregados com sucesso do Google Sheets!`, 'success');
        return true;
        
    } catch (error) {
        console.error('Erro ao carregar transfers:', error);
        
        // Mensagens de erro mais específicas
        let errorMessage = 'Erro desconhecido ao carregar transfers';
        
        if (error.message.includes('HTTP')) {
            errorMessage = 'Erro de conexão com o Google Sheets';
        } else if (error.message.includes('JSON')) {
            errorMessage = 'Erro no formato dos dados recebidos';
        } else if (error.message.includes('CORS')) {
            errorMessage = 'Erro de permissões de acesso';
        } else {
            errorMessage = error.message;
        }
        
        showStatus(`${errorMessage}`, 'error');
        return false;
    }
}

// Função para validar resposta do servidor
function isValidResponse(result) {
    // Se tem status success explícito
    if (result.status === 'success') return true;
    
    // Se tem mensagem de funcionamento
    if (result.message && result.message.includes('funcionando')) return true;
    
    // Se tem array de dados
    if (result.data && Array.isArray(result.data)) return true;
    
    // Se a resposta é diretamente um array
    if (Array.isArray(result)) return true;
    
    // Se tem propriedade success como true
    if (result.success === true) return true;
    
    return false;
}

function convertServerDataToLocal(serverItem, index) {
    if (!serverItem || typeof serverItem !== 'object') {
        console.warn('Item inválido do servidor:', serverItem);
        return null;
    }
    
    try {
        // Função auxiliar para obter valores - VERSÃO CORRIGIDA
        const getValue = (item, keys, defaultValue = '') => {
            for (const key of keys) {
                if (item[key] !== undefined && item[key] !== null && item[key] !== '') {
                    return item[key];
                }
            }
            return defaultValue;
        };
        
        // Função auxiliar para valores numéricos
        const getNumericValue = (item, keys, defaultValue = 0) => {
            const value = getValue(item, keys, defaultValue);
            const parsed = parseFloat(value);
            return isNaN(parsed) ? defaultValue : parsed;
        };
        
        // Função auxiliar para valores inteiros
        const getIntegerValue = (item, keys, defaultValue = 0) => {
            const value = getValue(item, keys, defaultValue);
            const parsed = parseInt(value);
            return isNaN(parsed) ? defaultValue : parsed;
        };
        
        // FUNÇÃO SIMPLIFICADA PARA HORÁRIO - VERSÃO FINAL
        const getHorarioValue = (item) => {
            const horario = getValue(item, [
                'Hora Pick-up', 'Hora_Pick-up', 'Hora_Pickup', 'HoraPickup'
            ], '00:00');
            
            // Se já é string simples HH:MM, retorna direto
            if (typeof horario === 'string' && /^\d{2}:\d{2}$/.test(horario)) {
                return horario;
            }
            
            // Para qualquer outro formato, extrair HH:MM
            const timeMatch = horario.toString().match(/(\d{1,2}):(\d{2})/);
            if (timeMatch) {
                return `${timeMatch[1].padStart(2, '0')}:${timeMatch[2]}`;
            }
            
            return '00:00';
        };
        
        // Mapear campos do Google Sheets
        const convertedData = {
            id: getIntegerValue(serverItem, ['ID', 'id', 'Id'], Date.now() + index),
            nomeCliente: getValue(serverItem, ['Cliente', 'Nome', 'Nome Cliente'], 'Cliente não informado'),
            tipoServico: getValue(serverItem, ['Tipo Serviço', 'Tipo_Servico', 'TipoServico'], 'Transfer'),
            tourSelecionado: getValue(serverItem, ['Tour', 'Tour Selecionado'], ''),
            numeroPessoas: getIntegerValue(serverItem, ['Pessoas', 'Num Pessoas'], 1),
            numeroBagagens: getIntegerValue(serverItem, ['Bagagens', 'Num Bagagens'], 0),
            data: formatDateFromServer(getValue(serverItem, ['Data', 'Data Transfer'])),
            contacto: getValue(serverItem, ['Contacto', 'Contato', 'Telefone'], 'Sem contacto'),
            numeroVoo: getValue(serverItem, ['Voo', 'Numero Voo'], ''),
            origem: getValue(serverItem, ['Origem', 'Local Origem'], 'Origem não informada'),
            destino: getValue(serverItem, ['Destino', 'Local Destino'], 'Destino não informado'),
            horaPickup: getHorarioValue(serverItem), // USAR FUNÇÃO ESPECÍFICA
            valorTotal: getNumericValue(serverItem, ['Valor Total', 'Preço Cliente (€)'], 0),
            valorHotel: getNumericValue(serverItem, ['Valor Hotel (30%)', 'Valor Empire Marques Hotel (€)'], 0),
            valorHUB: getNumericValue(serverItem, ['Valor HUB', 'Valor HUB Transfer (€)'], 0),
            comissaoRecepcao: getNumericValue(serverItem, ['Comissão Recepção', 'Comissão Recepção (€)'], 0),
            modoPagamento: getValue(serverItem, ['Pagamento', 'Forma Pagamento'], 'Não informado'),
            pagoParaQuem: getValue(serverItem, ['Pago Para', 'Paid To'], 'Não informado'),
            status: getValue(serverItem, ['Status', 'Estado'], 'Solicitado'),
            observacoes: getValue(serverItem, ['Observações', 'Obs'], ''),
            created: getValue(serverItem, ['Data Criação', 'Created'], new Date().toISOString())
        };
        
        console.log(`ID ${convertedData.id}: Horário convertido = "${convertedData.horaPickup}"`);
        
        return convertedData;
        
    } catch (error) {
        console.error('Erro ao converter dados do servidor:', error);
        return null;
    }
}

function formatDateFromServer(dateStr) {
    if (!dateStr) return '';
    
    try {
        // Se já está no formato YYYY-MM-DD
        if (/^\d{4}-\d{2}-\d{2}$/.test(dateStr)) {
            return dateStr;
        }
        
        // Se está no formato DD/MM/YYYY
        if (/^\d{2}\/\d{2}\/\d{4}$/.test(dateStr)) {
            const [day, month, year] = dateStr.split('/');
            return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
        }
        
        // Tentar converter como data
        const date = new Date(dateStr);
        if (!isNaN(date.getTime())) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        return dateStr;
        
    } catch (error) {
        console.error('Erro ao formatar data do servidor:', dateStr, error);
        return dateStr;
    }
}
        // =====================================================
        // SINCRONIZAÇÃO COM SERVIDOR
        // =====================================================
        async function syncWithServer(showLoading = true) {
            if (syncInProgress) {
                console.log('Sincronização já em andamento...');
                return false;
            }
            
            syncInProgress = true;
            
            if (showLoading) {
                showSyncLoading(true);
            }
            
            try {
                const result = await loadTransfersFromSheets();
                
                if (result) {
                    showSyncSuccess(services.length);
                    return true;
                } else {
                    showSyncError('Falha na sincronização com Google Sheets');
                    return false;
                }
                
            } catch (error) {
                console.error('Erro na sincronização:', error);
                showSyncError(error.message);
                return false;
                
            } finally {
                syncInProgress = false;
                if (showLoading) {
                    showSyncLoading(false);
                }
            }
        }

        function showSyncLoading(show) {
            const button = document.getElementById('syncBtn');
            if (button) {
                if (show) {
                    button.textContent = 'Sincronizando...';
                    button.disabled = true;
                    button.classList.add('loading');
                } else {
                    button.textContent = 'Atualizar Dados';
                    button.disabled = false;
                    button.classList.remove('loading');
                }
            }
            
            const indicator = document.getElementById('syncIndicator');
            if (indicator) {
                indicator.style.display = show ? 'block' : 'none';
            }
        }

        function showSyncSuccess(count) {
            showStatus(`${count} transfers sincronizados com sucesso!`, 'success');
            updateLastSyncDisplay();
        }

        function showSyncError(message) {
            showStatus(`Erro na sincronização: ${message}`, 'error');
        }

        function updateLastSyncDisplay() {
            const display = document.getElementById('lastSyncDisplay');
            if (display && lastSyncTime) {
                const timeStr = lastSyncTime.toLocaleString('pt-PT');
                display.textContent = `Última sincronização: ${timeStr}`;
            }
        }

        // =====================================================
        // ENVIO PARA GOOGLE SHEETS
        // =====================================================
        async function sendToSheets(serviceData) {
    const url = getWebAppUrl();
    
    if (!url) {
        console.log('URL não configurada');
        return false;
    }
    
    if (isConnected) {
        console.log('Tentando enviar para Google Sheets:', serviceData);
        try {
            const dataWithEmail = {
                ...serviceData,
                emailDestino: TEST_EMAIL,
                action: 'addTransfer'
            };
            
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain',
                },
                body: JSON.stringify(dataWithEmail),
                mode: 'no-cors'
            });
            
            console.log('Transfer enviado para Google Sheets com sucesso!');
            showStatus('Transfer enviado para Google Sheets e email enviado!', 'success');
            console.log('Requisição enviada para:', TEST_EMAIL);
            return true;
            
        } catch (error) {
            console.error('Erro ao enviar para Sheets:', error);
            showStatus('Erro no envio: ' + error.message, 'error');
            return false;
        }
    } else {
        showStatus('Não conectado ao Google Sheets. Transfer salvo apenas localmente.', 'warning');
        return false;
    }
}

        // =====================================================
        // GERENCIAMENTO DE DADOS LOCAL
        // =====================================================
        function loadData() {
            const savedData = localStorage.getItem('partnershipTransferData');
            const savedUrl = localStorage.getItem('webappUrl');
            
            if (savedData) {
                try {
                    services = JSON.parse(savedData);
                    console.log(`${services.length} transfers carregados do localStorage`);
                    renderTable();
                    updateSummary();
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                    services = [];
                }
            }
            
            if (savedUrl) {
                document.getElementById('webappUrl').value = savedUrl;
                document.getElementById('syncBtn').style.display = 'inline-block';
                isConnected = true;
            } else {
                document.getElementById('webappUrl').value = WEBAPP_URL;
                localStorage.setItem('webappUrl', WEBAPP_URL);
                document.getElementById('syncBtn').style.display = 'inline-block';
                isConnected = true;
            }
            
            // Carregar última sincronização
            const lastSync = localStorage.getItem('lastSyncTime');
            if (lastSync) {
                lastSyncTime = new Date(lastSync);
                updateLastSyncDisplay();
            }
        }

        function saveData() {
            try {
                localStorage.setItem('partnershipTransferData', JSON.stringify(services));
                console.log('Dados salvos no localStorage');
            } catch (error) {
                console.error('Erro ao salvar dados:', error);
                showStatus('Erro ao salvar dados localmente', 'error');
            }
        }

        // =====================================================
        // SISTEMA DE LIMPEZA DE DADOS
        // =====================================================
        async function clearAllData() {
            const confirmText = prompt('ATENÇÃO: Esta ação irá apagar TODOS os dados!\n\nDigite "CONFIRMAR" para continuar:');
            
            if (confirmText !== 'CONFIRMAR') {
                showStatus('Operação cancelada pelo usuário.', 'warning');
                return;
            }

            setButtonLoading('clearDataBtn', true);
            
            try {
                const url = getWebAppUrl();
                if (url) {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'clearAllData',
                            timestamp: new Date().toISOString()
                        }),
                        mode: 'cors'
                    });
                    
                    const result = await response.json();
                    if (result.status === 'success') {
                        showStatus('Dados limpos no Google Sheets com sucesso!', 'success');
                    } else {
                        showStatus('Erro ao limpar dados no Google Sheets: ' + result.message, 'warning');
                    }
                } else {
                    showStatus('URL não configurada - apenas dados locais serão limpos', 'warning');
                }
                
                services = [];
                localStorage.removeItem('partnershipTransferData');
                renderTable();
                updateSummary();
                
                showStatus('Todos os dados foram limpos com sucesso!', 'success');
                
                setTimeout(() => {
                    toggleClearData();
                }, 2000);
                
            } catch (error) {
                console.error('Erro ao limpar dados:', error);
                
                services = [];
                localStorage.removeItem('partnershipTransferData');
                renderTable();
                updateSummary();
                
                showStatus('Dados locais limpos. Erro ao conectar com Google Sheets.', 'warning');
            } finally {
                setButtonLoading('clearDataBtn', false);
            }
        }

        async function clearTestData() {
            const confirmText = prompt('Limpar apenas registros de teste?\n\nDigite "TESTE" para confirmar:');
            
            if (confirmText !== 'TESTE') {
                showStatus('Operação cancelada pelo usuário.', 'warning');
                return;
            }

            setButtonLoading('clearTestBtn', true);
            
            try {
                const url = getWebAppUrl();
                
                if (url) {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'clearTestData',
                            timestamp: new Date().toISOString()
                        }),
                        mode: 'cors'
                    });
                    
                    const result = await response.json();
                    if (result.status === 'success') {
                        showStatus('Dados de teste limpos no Google Sheets!', 'success');
                    } else {
                        showStatus('Erro ao limpar dados de teste no Google Sheets: ' + result.message, 'warning');
                    }
                }
                
                const originalLength = services.length;
                services = services.filter(service => 
                    !service.nomeCliente.toUpperCase().includes('TESTE') &&
                    !service.nomeCliente.toUpperCase().includes('TEST')
                );
                
                const removedCount = originalLength - services.length;
                
                if (removedCount > 0) {
                    saveData();
                    renderTable();
                    updateSummary();
                    showStatus(`${removedCount} registros de teste removidos!`, 'success');
                } else {
                    showStatus('Nenhum registro de teste encontrado.', 'warning');
                }
                
                setTimeout(() => {
                    toggleClearData();
                }, 2000);
                
            } catch (error) {
                console.error('Erro ao limpar dados de teste:', error);
                showStatus('Erro ao limpar dados de teste: ' + error.message, 'error');
            } finally {
                setButtonLoading('clearTestBtn', false);
            }
        }

        // =====================================================
        // FUNÇÕES DE SERVIÇO E CÁLCULO
        // =====================================================
        function setServiceType(type) {
            currentServiceType = type;
            
            document.querySelectorAll('.btn-service').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const tourSelector = document.getElementById('tourSelector');
            if (type === 'tour' || type === 'private') {
                tourSelector.classList.add('show');
            } else {
                tourSelector.classList.remove('show');
                document.getElementById('tourSelecionado').value = '';
            }
            
            updateCalculation();
        }

        function updateTourPrice() {
            const tourSelect = document.getElementById('tourSelecionado');
            const selectedOption = tourSelect.options[tourSelect.selectedIndex];
            
            if (!selectedOption || !selectedOption.value) {
                precoUnitarioAtual = 0;
                updateCalculation();
                return;
            }
            
            const tourData = TOURS_DATA[selectedOption.value];
            const pessoas = parseInt(document.getElementById('numeroPessoas').value) || 1;
            
            if (tourData.type === 'regular') {
                precoUnitarioAtual = tourData.price;
                const valorTotal = precoUnitarioAtual * pessoas;
                document.getElementById('valorTotal').value = valorTotal.toFixed(2);
            } else if (tourData.type === 'private') {
                precoUnitarioAtual = pessoas <= 3 ? tourData.priceSmall : tourData.priceLarge;
                document.getElementById('valorTotal').value = precoUnitarioAtual.toFixed(2);
            }
            
            updateCalculation();
        }

        function updateCalculation() {
            const pessoas = parseInt(document.getElementById('numeroPessoas').value) || 0;
            let valorTotal = 0;
            let valorHotel = 0;
            let valorHUB = 0;
            let comissaoRecepcao = 0;
            
            const calcBox = document.getElementById('priceCalculationBox');
            if (currentServiceType === 'tour' || currentServiceType === 'private') {
                calcBox.classList.add('show');
                
                document.getElementById('calcTipoServico').textContent = 
                    currentServiceType === 'tour' ? 'Tour Regular' : 'Private Tour';
                document.getElementById('calcPrecoUnitario').textContent = `€${precoUnitarioAtual}`;
                document.getElementById('calcPessoas').textContent = pessoas;
                
                if (currentServiceType === 'tour') {
                    valorTotal = precoUnitarioAtual * pessoas;
                    valorHotel = valorTotal * 0.30;
                    comissaoRecepcao = 5.00;
                } else if (currentServiceType === 'private') {
                    valorTotal = precoUnitarioAtual;
                    valorHotel = valorTotal * 0.30;
                    comissaoRecepcao = 5.00;
                }
            } else {
                calcBox.classList.remove('show');
                valorTotal = parseFloat(document.getElementById('valorTotal').value) || 0;
                valorHotel = valorTotal * 0.30;
                comissaoRecepcao = 2.00;
            }
            
            valorHUB = valorTotal - valorHotel - comissaoRecepcao;
            
            document.getElementById('calcTotal').textContent = valorTotal.toFixed(2);
            document.getElementById('calcHotel').textContent = `€${valorHotel.toFixed(2)}`;
            document.getElementById('calcHUB').textContent = `€${valorHUB.toFixed(2)}`;
            document.getElementById('calcRecepcao').textContent = `€${comissaoRecepcao.toFixed(2)}`;
            
            if (currentServiceType !== 'transfer') {
                document.getElementById('valorTotal').value = valorTotal.toFixed(2);
            }
        }

        function toggleAdminMode() {
            const senha = prompt('Digite a senha de administrador:');
            if (senha === 'admin2025') {
                isAdminMode = !isAdminMode;
                
                document.getElementById('adminFields').classList.toggle('show');
                
                document.querySelectorAll('.admin-column').forEach(col => {
                    col.style.display = isAdminMode ? 'table-cell' : 'none';
                });
                
                alert(isAdminMode ? 'Modo Admin Ativado' : 'Modo Admin Desativado');
            } else if (senha !== null) {
                alert('Senha incorreta!');
            }
        }

        // =====================================================
        // FUNÇÕES DOS BOTÕES RÁPIDOS
        // =====================================================
        function setPeople(number) {
            document.getElementById('numeroPessoas').value = number;
            document.querySelectorAll('.btn-people').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateCalculation();
            updatePriceFromTour();
        }

        function updatePriceFromTour() {
            const tourSelect = document.getElementById('tourSelecionado');
            const selectedOption = tourSelect.options[tourSelect.selectedIndex];
            const pessoas = parseInt(document.getElementById('numeroPessoas').value) || 0;
            
            if (currentServiceType === 'tour' && selectedOption && selectedOption.value) {
                const tourData = TOURS_DATA[selectedOption.value];
                if (tourData && tourData.type === 'regular' && pessoas > 0) {
                    const valorTotal = tourData.price * pessoas;
                    document.getElementById('valorTotal').value = valorTotal.toFixed(2);
                    document.querySelectorAll('.btn-price').forEach(btn => btn.classList.remove('active'));
                }
            } else if (currentServiceType === 'private' && selectedOption && selectedOption.value) {
                const tourData = TOURS_DATA[selectedOption.value];
                if (tourData && tourData.type === 'private' && pessoas > 0) {
                    const valorTotal = pessoas <= 3 ? tourData.priceSmall : tourData.priceLarge;
                    document.getElementById('valorTotal').value = valorTotal.toFixed(2);
                    document.querySelectorAll('.btn-price').forEach(btn => btn.classList.remove('active'));
                }
            }
        }

        function setBaggage(number) {
            document.getElementById('numeroBagagens').value = number;
            document.querySelectorAll('.btn-baggage').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function setDate(option) {
            const dateInput = document.getElementById('data');
            const today = new Date();
            
            document.querySelectorAll('.btn-date').forEach(btn => btn.classList.remove('active'));
            
            if (option === 'today') {
                dateInput.valueAsDate = today;
                event.target.classList.add('active');
            } else if (option === 'tomorrow') {
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                dateInput.valueAsDate = tomorrow;
                event.target.classList.add('active');
            }
        }

        function setTime(time) {
            document.getElementById('horaPickup').value = time;
            document.querySelectorAll('.btn-time').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function setOrigin(location) {
            document.getElementById('origem').value = location;
            document.querySelectorAll('.origem-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function setDestination(location) {
            document.getElementById('destino').value = location;
            document.querySelectorAll('.destino-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function setPrice(price) {
            document.getElementById('valorTotal').value = price;
            document.querySelectorAll('.btn-price').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateCalculation();
        }

        function setPayment(method) {
            document.getElementById('modoPagamento').value = method;
            document.querySelectorAll('.btn-payment').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function setPaymentTo(recipient) {
            document.getElementById('pagoParaQuem').value = recipient;
            document.querySelectorAll('.btn-payment-to').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function addObservation(text) {
            const obsInput = document.getElementById('observacoes');
            const currentText = obsInput.value;
            
            if (currentText === '') {
                obsInput.value = text;
            } else {
                obsInput.value = currentText + '; ' + text;
            }
            
            event.target.classList.add('active');
            setTimeout(() => {
                event.target.classList.remove('active');
            }, 1000);
        }

        // =====================================================
        // FUNÇÕES DO TELEFONE INTERNACIONAL
        // =====================================================
        function initializePhoneInput() {
            const phoneInputElement = document.getElementById('contacto');
            
            if (window.intlTelInput && phoneInputElement) {
                try {
                    phoneInput = window.intlTelInput(phoneInputElement, {
                        initialCountry: "pt",
                        preferredCountries: ["pt", "es", "fr", "de", "br", "us", "gb"],
                        separateDialCode: true,
                        autoHideDialCode: false,
                        nationalMode: false,
                        formatOnDisplay: true,
                        utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/utils.js"
                    });

phoneInputElement.addEventListener('input', function() {
                        const number = phoneInputElement.value;
                        if (number.startsWith('+')) {
                            const countryCode = detectCountryFromNumber(number);
                            if (countryCode) {
                                phoneInput.setCountry(countryCode);
                            }
                        }
                    });

                    phoneInputElement.addEventListener('blur', function() {
                        try {
                            if (phoneInput.isValidNumber()) {
                                phoneInputElement.value = phoneInput.getNumber();
                            }
                        } catch (e) {
                            console.warn('Erro na validação do telefone:', e);
                        }
                    });
                    
                    console.log('Campo de telefone internacional inicializado');
                } catch (error) {
                    console.warn('Erro ao inicializar telefone internacional:', error);
                    console.log('Usando campo de telefone simples');
                }
            } else {
                console.log('Biblioteca de telefone não disponível - usando input simples');
            }
        }

        function detectCountryFromNumber(number) {
            const countryCodesMap = {
                '+351': 'pt', '+34': 'es', '+33': 'fr', '+49': 'de', '+55': 'br',
                '+1': 'us', '+44': 'gb', '+39': 'it', '+31': 'nl', '+32': 'be',
                '+41': 'ch', '+43': 'at', '+45': 'dk', '+46': 'se', '+47': 'no'
            };

            for (let i = 4; i >= 2; i--) {
                const code = number.substring(0, i);
                if (countryCodesMap[code]) {
                    return countryCodesMap[code];
                }
            }
            return null;
        }

        function getFormattedPhoneNumber() {
            if (phoneInput && phoneInput.isValidNumber()) {
                return phoneInput.getNumber();
            }
            return document.getElementById('contacto').value;
        }

function formatPhoneDisplay(phone) {
  if (!phone) return 'Sem contacto';
  
  let cleanPhone = phone.toString().trim();
  
  // Remover espaços, parênteses, hífens mas manter o +
  cleanPhone = cleanPhone.replace(/[\s\-\(\)\.]/g, '');
  
  // Se já tem + no início, manter como está
  if (cleanPhone.startsWith('+')) {
    return cleanPhone;
  }
  
  // Se não tem +, adicionar baseado no comprimento e padrão
  if (/^\d+$/.test(cleanPhone)) {
    // Códigos de país mais comuns por comprimento
    if (cleanPhone.length >= 10) {
      // Números com 10+ dígitos provavelmente já incluem código do país
      
      // Brasil: 55 + 11 dígitos = 13 total
      if (cleanPhone.length === 13 && cleanPhone.startsWith('55')) {
        return '+' + cleanPhone;
      }
      
      // EUA/Canadá: 1 + 10 dígitos = 11 total
      if (cleanPhone.length === 11 && cleanPhone.startsWith('1')) {
        return '+' + cleanPhone;
      }
      
      // Portugal: 351 + 9 dígitos = 12 total
      if (cleanPhone.length === 12 && cleanPhone.startsWith('351')) {
        return '+' + cleanPhone;
      }
      
      // Espanha: 34 + 9 dígitos = 11 total
      if (cleanPhone.length === 11 && cleanPhone.startsWith('34')) {
        return '+' + cleanPhone;
      }
      
      // França: 33 + 10 dígitos = 12 total
      if (cleanPhone.length === 12 && cleanPhone.startsWith('33')) {
        return '+' + cleanPhone;
      }
      
      // Reino Unido: 44 + 10 dígitos = 12 total
      if (cleanPhone.length === 12 && cleanPhone.startsWith('44')) {
        return '+' + cleanPhone;
      }
      
      // Alemanha: 49 + 10/11 dígitos = 12/13 total
      if ((cleanPhone.length === 12 || cleanPhone.length === 13) && cleanPhone.startsWith('49')) {
        return '+' + cleanPhone;
      }
      
      // Para outros números longos, assumir que já tem código de país
      if (cleanPhone.length >= 10) {
        return '+' + cleanPhone;
      }
    }
    
    // Números nacionais sem código de país - assumir Portugal por padrão
    if (cleanPhone.length === 9 && /^[923]/.test(cleanPhone)) {
      return '+351' + cleanPhone;
    }
    
    // Para números de 7-8 dígitos, assumir Portugal
    if (cleanPhone.length >= 7 && cleanPhone.length <= 9) {
      return '+351' + cleanPhone;
    }
  }
  
  // Se chegou até aqui e não tem +, adicionar
  return cleanPhone.startsWith('+') ? cleanPhone : '+' + cleanPhone;
}

function formatPhoneForWhatsApp(phone) {
  const formatted = formatPhoneDisplay(phone);
  // Remove apenas o primeiro + para o WhatsApp
  return formatted.replace(/^\+/, '');
}

// Função auxiliar para detectar país pelo código
function detectCountryFromPhone(phone) {
  const clean = phone.replace(/[^\d]/g, '');
  
  const countryCodes = {
    '1': 'US/CA',
    '33': 'FR',
    '34': 'ES', 
    '44': 'UK',
    '49': 'DE',
    '55': 'BR',
    '351': 'PT',
    '352': 'LU',
    '353': 'IE'
  };
  
  for (const [code, country] of Object.entries(countryCodes)) {
    if (clean.startsWith(code)) {
      return { code: '+' + code, country: country };
    }
  }
  
  return { code: '+351', country: 'PT' }; // Padrão Portugal
}

        // =====================================================
        // RENDERIZAÇÃO DA TABELA
        // =====================================================
        function renderTable() {
    const tbody = document.getElementById('servicesTableBody');
    tbody.innerHTML = '';

    if (services.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="18" class="empty-state">
                    <h3>Nenhum serviço cadastrado</h3>
                    <p>Use o botão "Carregar Transfers" para sincronizar com o Google Sheets</p>
                </td>
            </tr>
        `;
        return;
    }

    // Usar dados paginados em vez de todos os serviços
    const paginatedServices = getPaginatedServices();

    paginatedServices.forEach(service => {
        const row = document.createElement('tr');
        
        // Determinar cor de fundo baseada no tipo e rota
        let rowBackgroundClass = '';
        if (service.tipoServico && (service.tipoServico.includes('Tour') || service.tipoServico === 'tour')) {
            rowBackgroundClass = 'tour-row';
        } else if (service.origem && service.origem.toLowerCase().includes('aeroporto') && 
                   service.destino && service.destino.toLowerCase().includes('empire')) {
            rowBackgroundClass = 'airport-to-hotel-row';
        }
        
        if (rowBackgroundClass) {
            row.classList.add(rowBackgroundClass);
        }
        
        const modoPagamento = service.modoPagamento || 'Não informado';
        const paymentClass = modoPagamento.toLowerCase().includes('dinheiro') ? 'payment-cash' :
                            modoPagamento.toLowerCase().includes('cartão') ? 'payment-card' : 'payment-transfer';
        
        const tipoServico = service.tipoServico || 'Transfer';
        const tipoLabel = tipoServico === 'Tour Regular' || tipoServico === 'tour' ? 'Tour' : 
                         tipoServico === 'Private Tour' || tipoServico === 'private' ? 'Private' : 
                         'Transfer';
        
        row.innerHTML = `
            <td><strong>#${service.id}</strong></td>
            <td>
                <div class="client-info">${service.nomeCliente}</div>
                <div style="font-size: 0.8rem; color: #7f8c8d;">${service.contacto}</div>
            </td>
            <td>${tipoLabel}</td>
            <td>
                <span style="background: #9b59b6; color: white; padding: 4px 8px; border-radius: 12px; font-weight: 600;">
                    ${service.numeroPessoas}
                </span>
            </td>
            <td>
                <span style="background: #e67e22; color: white; padding: 4px 8px; border-radius: 12px; font-weight: 600;">
                    ${service.numeroBagagens}
                </span>
            </td>
            <td><strong>${formatDate(service.data)}</strong></td>
            <td>
                <div style="font-weight: 600; color: #2c3e50; font-size: 1.1rem;">
                    ${service.horaPickup}
                </div>
            </td>
            <td>
  <a href="https://wa.me/${formatPhoneForWhatsApp(service.contacto)}" 
     target="_blank" 
     style="color: #25d366; text-decoration: none; font-weight: 600;">
    ${formatPhoneDisplay(service.contacto)}
  </a>
</td>
            <td>${service.numeroVoo || '-'}</td>
            <td>
                <div style="font-size: 0.9rem;">
                    <div><strong>De:</strong> ${service.origem}</div>
                    <div><strong>Para:</strong> ${service.destino}</div>
                </div>
            </td>
            <td><span class="value-highlight">€${service.valorTotal.toFixed(2)}</span></td>
            <td class="admin-column" style="display: ${isAdminMode ? 'table-cell' : 'none'};">
                €${(service.valorHotel || 0).toFixed(2)}
            </td>
            <td class="admin-column" style="display: ${isAdminMode ? 'table-cell' : 'none'};">
                €${(service.valorHUB || 0).toFixed(2)}
            </td>
            <td class="admin-column" style="display: ${isAdminMode ? 'table-cell' : 'none'};">
                €${(service.comissaoRecepcao || 0).toFixed(2)}
            </td>
            <td><span class="payment-method ${paymentClass}">${service.modoPagamento}</span></td>
            <td>
                <span class="pago-para ${service.pagoParaQuem === 'Recepção' ? 'pago-recepcao' : 'pago-motorista'}">
                    ${service.pagoParaQuem}
                </span>
            </td>
            <td><span class="status status-${service.status.toLowerCase()}">${service.status}</span></td>
            <td>
                <div class="action-buttons">
                    <button class="btn btn-small btn-primary" onclick="editService(${service.id})" title="Editar">✏️</button>
                    <button class="btn btn-small btn-success" onclick="changeStatus(${service.id})" title="Alterar Status">🔄</button>
                    <button class="btn btn-small btn-export" onclick="deleteService(${service.id})" title="Excluir">🗑️</button>
                </div>
            </td>
        `;
        tbody.appendChild(row);
    });

    updatePagination();
}

        function updateSummary() {
            const total = services.length;
            const pending = services.filter(s => s.status === 'Solicitado').length;
            const confirmed = services.filter(s => s.status === 'Confirmado').length;
            const completed = services.filter(s => s.status === 'Finalizado').length;

            const totalRevenue = services.reduce((sum, s) => sum + (s.valorTotal || 0), 0);
            const pendingRevenue = services.filter(s => s.status === 'Solicitado').reduce((sum, s) => sum + (s.valorTotal || 0), 0);
            const confirmedRevenue = services.filter(s => s.status === 'Confirmado').reduce((sum, s) => sum + (s.valorTotal || 0), 0);
            const completedRevenue = services.filter(s => s.status === 'Finalizado').reduce((sum, s) => sum + (s.valorTotal || 0), 0);

            document.getElementById('totalServices').textContent = total;
            document.getElementById('pendingServices').textContent = pending;
            document.getElementById('confirmedServices').textContent = confirmed;
            document.getElementById('completedServices').textContent = completed;

            document.getElementById('totalRevenue').textContent = `€${totalRevenue.toFixed(2)}`;
            document.getElementById('pendingRevenue').textContent = `€${pendingRevenue.toFixed(2)}`;
            document.getElementById('confirmedRevenue').textContent = `€${confirmedRevenue.toFixed(2)}`;
            document.getElementById('completedRevenue').textContent = `€${completedRevenue.toFixed(2)}`;
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-PT', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        // =====================================================
        // SISTEMA DE FILTROS AVANÇADOS
        // =====================================================
        function applyQuickPeriod() {
            const select = document.getElementById('quickPeriodSelect');
            const period = select.value;
            
            if (!period) return;
            
            const today = new Date();
            let startDate, endDate;
            
            switch (period) {
                case 'today':
                    startDate = endDate = today;
                    break;
                    
                case 'yesterday':
                    startDate = endDate = new Date(today.getTime() - 24 * 60 * 60 * 1000);
                    break;
                    
                case 'thisWeek':
                    const dayOfWeek = today.getDay();
                    const diff = today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1);
                    startDate = new Date(today.setDate(diff));
                    endDate = new Date();
                    break;
                    
                case 'lastWeek':
                    const lastWeekStart = new Date();
                    lastWeekStart.setDate(today.getDate() - today.getDay() - 6);
                    const lastWeekEnd = new Date();
                    lastWeekEnd.setDate(today.getDate() - today.getDay());
                    startDate = lastWeekStart;
                    endDate = lastWeekEnd;
                    break;
                    
                case 'thisMonth':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    endDate = new Date();
                    break;
                    
                case 'lastMonth':
                    const lastMonth = new Date();
                    lastMonth.setMonth(today.getMonth() - 1);
                    startDate = new Date(lastMonth.getFullYear(), lastMonth.getMonth(), 1);
                    endDate = new Date(today.getFullYear(), today.getMonth(), 0);
                    break;
                    
                case 'last7days':
                    startDate = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                    endDate = new Date();
                    break;
                    
                case 'last30days':
                    startDate = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
                    endDate = new Date();
                    break;
            }
            
            if (startDate && endDate) {
                document.getElementById('filterDateStart').value = formatDateForInput(startDate);
                document.getElementById('filterDateEnd').value = formatDateForInput(endDate);
                updateDateFilter();
            }
        }

        function updateDateFilter() {
            const startDate = document.getElementById('filterDateStart').value;
            const endDate = document.getElementById('filterDateEnd').value;
            
            activeFilters.dateStart = startDate;
            activeFilters.dateEnd = endDate;
            
            const quickSelect = document.getElementById('quickPeriodSelect');
            if (quickSelect && (startDate || endDate)) {
                quickSelect.value = '';
            }
            
            saveFilters();
            applyCurrentFilters();
        }

        function updateStatusFilter() {
            const statusFilter = document.getElementById('filterStatus');
            activeFilters.status = statusFilter ? statusFilter.value : '';
            
            saveFilters();
            applyCurrentFilters();
        }

        function updateClientFilter() {
            const clientFilter = document.getElementById('searchClient');
            activeFilters.cliente = clientFilter ? clientFilter.value : '';
            
            saveFilters();
            applyCurrentFilters();
        }

        function updateServiceTypeFilter() {
            const typeFilter = document.getElementById('filterTipoServico');
            activeFilters.tipoServico = typeFilter ? typeFilter.value : '';
            
            saveFilters();
            applyCurrentFilters();
        }

        function applyAllFilters() {
            console.log('Aplicando todos os filtros:', activeFilters);
            applyCurrentFilters();
        }

        function applyCurrentFilters() {
            if (isFiltering) return;
            
            isFiltering = true;
            
            try {
                let filtered = [...services];
                
                if (activeFilters.dateStart || activeFilters.dateEnd) {
                    filtered = filtered.filter(service => {
                        const serviceDate = parseServiceDate(service.data);
                        if (!serviceDate) return true;
                        
                        let include = true;
                        
                        if (activeFilters.dateStart) {
                            const startDate = new Date(activeFilters.dateStart);
                            include = include && serviceDate >= startDate;
                        }
                        
                        if (activeFilters.dateEnd) {
                            const endDate = new Date(activeFilters.dateEnd);
                            endDate.setHours(23, 59, 59, 999);
                            include = include && serviceDate <= endDate;
                        }
                        
                        return include;
                    });
                }
                
                if (activeFilters.status) {
                    filtered = filtered.filter(service => 
                        service.status === activeFilters.status
                    );
                }
                
                if (activeFilters.cliente) {
                    const searchTerm = activeFilters.cliente.toLowerCase();
                    filtered = filtered.filter(service =>
                        service.nomeCliente.toLowerCase().includes(searchTerm)
                    );
                }
                
                if (activeFilters.tipoServico) {
                    filtered = filtered.filter(service =>
                        service.tipoServico === activeFilters.tipoServico
                    );
                }
                
                filteredData = filtered;
                renderFilteredTable(filtered);
                updateFilteredSummary(filtered);
                
                console.log(`Filtros aplicados: ${filtered.length} de ${services.length} transfers`);
                
            } finally {
                isFiltering = false;
            }
        }

        function renderFilteredTable(filteredServices) {
            const sortedServices = filteredServices.sort((a, b) => b.id - a.id);
            
            const tbody = document.getElementById('servicesTableBody');
            tbody.innerHTML = '';

            if (sortedServices.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="18" class="empty-state">
                            <h3>Nenhum transfer encontrado</h3>
                            <p>Tente ajustar os filtros ou carregar dados do Google Sheets</p>
                            <button class="btn btn-primary" onclick="clearAllFilters()">Limpar Filtros</button>
                        </td>
                    </tr>
                `;
                return;
            }

            sortedServices.forEach(service => {
                const row = document.createElement('tr');
                
                const modoPagamento = service.modoPagamento || 'Não informado';
                const paymentClass = modoPagamento.toLowerCase().includes('dinheiro') ? 'payment-cash' :
                                    modoPagamento.toLowerCase().includes('cartão') ? 'payment-card' : 'payment-transfer';
                
                const tipoServico = service.tipoServico || 'Transfer';
                const tipoLabel = tipoServico === 'Tour Regular' || tipoServico === 'tour' ? 'Tour' : 
                                 tipoServico === 'Private Tour' || tipoServico === 'private' ? 'Private' : 
                                 'Transfer';
                
                const dataFormatada = service.data ? (service.data.includes('/') ? service.data : formatDate(service.data)) : 'Data não informada';
                
                row.innerHTML = `
                    <td><strong>#${service.id || 'N/A'}</strong></td>
                    <td>
                        <div class="client-info">${service.nomeCliente || 'Cliente não informado'}</div>
                        <div style="font-size: 0.8rem; color: #7f8c8d;">${service.contacto || 'Sem contacto'}</div>
                    </td>
                    <td>${tipoLabel}</td>
                    <td>
                        <span style="background: #9b59b6; color: white; padding: 4px 8px; border-radius: 12px; font-weight: 600;">
                            ${service.numeroPessoas || 0}
                        </span>
                    </td>
                    <td>
                        <span style="background: #e67e22; color: white; padding: 4px 8px; border-radius: 12px; font-weight: 600;">
                            ${service.numeroBagagens || 0}
                        </span>
                    </td>
                    <td><strong>${dataFormatada}</strong></td>
                    <td>
                        <div style="font-weight: 600; color: #2c3e50; font-size: 1.1rem;">
                            ${service.horaPickup || 'Hora não informada'}
                        </div>
                    </td>
                    <td>${service.contacto || 'Sem contacto'}</td>
                    <td>${service.numeroVoo || '-'}</td>
                    <td>
                        <div style="font-size: 0.9rem;">
                            <div><strong>De:</strong> ${service.origem || 'Origem não informada'}</div>
                            <div><strong>Para:</strong> ${service.destino || 'Destino não informado'}</div>
                        </div>
                    </td>
                    <td><span class="value-highlight">€${(service.valorTotal || 0).toFixed(2)}</span></td>
                    <td class="admin-column" style="display: ${isAdminMode ? 'table-cell' : 'none'};">
                        €${(service.valorHotel || 0).toFixed(2)}
                    </td>
                    <td class="admin-column" style="display: ${isAdminMode ? 'table-cell' : 'none'};">
                        €${(service.valorHUB || 0).toFixed(2)}
                    </td>
                    <td class="admin-column" style="display: ${isAdminMode ? 'table-cell' : 'none'};">
                        €${(service.comissaoRecepcao || 0).toFixed(2)}
                    </td>
                    <td><span class="payment-method ${paymentClass}">${modoPagamento}</span></td>
                    <td>
                        <span class="pago-para ${service.pagoParaQuem === 'Recepção' ? 'pago-recepcao' : 'pago-motorista'}">
                            ${service.pagoParaQuem || 'Não informado'}
                        </span>
                    </td>
                    <td><span class="status status-${(service.status || 'solicitado').toLowerCase()}">${service.status || 'Solicitado'}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small btn-primary" onclick="editService(${service.id})" title="Editar">✏️</button>
                            <button class="btn btn-small btn-success" onclick="changeStatus(${service.id})" title="Alterar Status">🔄</button>
                            <button class="btn btn-small btn-export" onclick="deleteService(${service.id})" title="Excluir">🗑️</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateFilteredSummary(filteredServices) {
            const total = filteredServices.length;
            const pending = filteredServices.filter(s => s.status === 'Solicitado').length;
            const confirmed = filteredServices.filter(s => s.status === 'Confirmado').length;
            const completed = filteredServices.filter(s => s.status === 'Finalizado').length;

            const totalRevenue = filteredServices.reduce((sum, s) => sum + (s.valorTotal || 0), 0);
            const pendingRevenue = filteredServices.filter(s => s.status === 'Solicitado').reduce((sum, s) => sum + (s.valorTotal || 0), 0);
            const confirmedRevenue = filteredServices.filter(s => s.status === 'Confirmado').reduce((sum, s) => sum + (s.valorTotal || 0), 0);
            const completedRevenue = filteredServices.filter(s => s.status === 'Finalizado').reduce((sum, s) => sum + (s.valorTotal || 0), 0);

            document.getElementById('totalServices').textContent = total;
            document.getElementById('pendingServices').textContent = pending;
            document.getElementById('confirmedServices').textContent = confirmed;
            document.getElementById('completedServices').textContent = completed;

            document.getElementById('totalRevenue').textContent = `€${totalRevenue.toFixed(2)}`;
            document.getElementById('pendingRevenue').textContent = `€${pendingRevenue.toFixed(2)}`;
            document.getElementById('confirmedRevenue').textContent = `€${confirmedRevenue.toFixed(2)}`;
            document.getElementById('completedRevenue').textContent = `€${completedRevenue.toFixed(2)}`;
            
            updateFilterIndicator(total, services.length);
        }

        function updateFilterIndicator(filteredCount, totalCount) {
            let indicator = document.getElementById('filterIndicator');
            
            if (filteredCount < totalCount) {
                indicator.textContent = `Mostrando ${filteredCount} de ${totalCount} transfers (filtros ativos)`;
                indicator.style.display = 'block';
            } else {
                indicator.style.display = 'none';
            }
        }

        function clearAllFilters() {
            document.getElementById('filterDateStart').value = '';
            document.getElementById('filterDateEnd').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('searchClient').value = '';
            document.getElementById('filterTipoServico').value = '';
            document.getElementById('quickPeriodSelect').value = '';
            
            activeFilters = {
                dateStart: null,
                dateEnd: null,
                status: '',
                cliente: '',
                quickPeriod: '',
                tipoServico: ''
            };
            saveFilters();
            renderTable();
            updateSummary();
            
            console.log('Todos os filtros foram limpos');
        }

        function parseServiceDate(dateStr) {
            if (!dateStr) return null;
            
            try {
                if (dateStr.includes('/')) {
                    const [day, month, year] = dateStr.split('/');
                    return new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
                } else if (dateStr.includes('-')) {
                    return new Date(dateStr);
                } else {
                    return new Date(dateStr);
                }
            } catch (error) {
                console.error('Erro ao processar data:', dateStr, error);
                return null;
            }
        }

        function formatDateForInput(date) {
            if (!(date instanceof Date)) return '';
            
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            
            return `${year}-${month}-${day}`;
        }

        function saveFilters() {
            try {
                localStorage.setItem('activeFilters', JSON.stringify(activeFilters));
            } catch (error) {
                console.error('Erro ao salvar filtros:', error);
            }
        }

        function loadSavedFilters() {
            try {
                const savedFilters = localStorage.getItem('activeFilters');
                if (savedFilters) {
                    activeFilters = { ...activeFilters, ...JSON.parse(savedFilters) };
                    
                    if (activeFilters.dateStart) {
                        const startField = document.getElementById('filterDateStart');
                        if (startField) startField.value = activeFilters.dateStart;
                    }
                    
                    if (activeFilters.dateEnd) {
                        const endField = document.getElementById('filterDateEnd');
                        if (endField) endField.value = activeFilters.dateEnd;
                    }
                    
                    if (activeFilters.status) {
                        const statusField = document.getElementById('filterStatus');
                        if (statusField) statusField.value = activeFilters.status;
                    }
                    
                    if (activeFilters.cliente) {
                        const clientField = document.getElementById('searchClient');
                        if (clientField) clientField.value = activeFilters.cliente;
                    }
                    
                    if (activeFilters.tipoServico) {
                        const typeField = document.getElementById('filterTipoServico');
                        if (typeField) typeField.value = activeFilters.tipoServico;
                    }
                }
            } catch (error) {
                console.error('Erro ao carregar filtros salvos:', error);
            }
        }

        // =====================================================
        // SUBMISSÃO E VALIDAÇÃO DO FORMULÁRIO
        // =====================================================
        document.getElementById('transferForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            if (!validateForm()) {
                return;
            }

            setButtonLoading('submitBtn', true);

            const pessoas = parseInt(document.getElementById('numeroPessoas').value);
            let valorTotal = parseFloat(document.getElementById('valorTotal').value);
            let valorHotel, valorHUB, comissaoRecepcao;
            
            if (currentServiceType === 'tour' || currentServiceType === 'private') {
                valorHotel = valorTotal * 0.30;
                comissaoRecepcao = 5.00;
            } else {
                valorHotel = valorTotal * 0.30;
                comissaoRecepcao = 2.00;
            }
            
            valorHUB = valorTotal - valorHotel - comissaoRecepcao;

            const formData = {
                nomeCliente: document.getElementById('nomeCliente').value.trim(),
                tipoServico: currentServiceType,
                tourSelecionado: document.getElementById('tourSelecionado').value,
                numeroPessoas: pessoas,
                numeroBagagens: parseInt(document.getElementById('numeroBagagens').value),
                data: document.getElementById('data').value,
                contacto: getFormattedPhoneNumber(),
                numeroVoo: document.getElementById('numeroVoo').value.trim(),
                origem: document.getElementById('origem').value.trim(),
                destino: document.getElementById('destino').value.trim(),
                horaPickup: document.getElementById('horaPickup').value,
                valorTotal: valorTotal,
                valorHotel: valorHotel,
                valorHUB: valorHUB,
                comissaoRecepcao: comissaoRecepcao,
                modoPagamento: document.getElementById('modoPagamento').value,
                pagoParaQuem: document.getElementById('pagoParaQuem').value,
                observacoes: document.getElementById('observacoes').value.trim(),
                status: 'Solicitado'
            };

            try {
                if (editingId) {
                    const index = services.findIndex(s => s.id === editingId);
                    if (index !== -1) {
                        services[index] = { ...services[index], ...formData };
                        
                        if (isConnected) {
                            await sendToSheets(services[index]);
                        }
                        
                        showStatus('Transfer atualizado com sucesso!', 'success');
                    }
                    editingId = null;
                } else {
                    const newId = getNextSyncedId();
                    const newService = {
                        id: newId,
                        ...formData,
                        created: new Date().toISOString()
                    };
                    
                    services.push(newService);
                    if (isConnected) {
                        const sheetSuccess = await sendToSheets(newService);
                        if (sheetSuccess) {
                            console.log('Transfer enviado para Google Sheets com sucesso!');
                            showStatus('Transfer adicionado com sucesso!', 'success');
                        } else {
                            showStatus('Transfer adicionado localmente. Erro ao enviar para Sheets.', 'warning');
                        }
                    } else {
                        showStatus('Transfer adicionado localmente. Configure o Google Sheets para sincronizar.', 'warning');
                    }
                }

                saveData();
                renderTable();
                updateSummary();
                clearForm();
                
                document.querySelector('.services-section').scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
                
            } catch (error) {
                console.error('Erro ao processar transfer:', error);
                showStatus('Erro ao processar transfer: ' + error.message, 'error');
            } finally {
                setButtonLoading('submitBtn', false);
            }
        });

        function validateForm() {
    const requiredFields = [
        'nomeCliente', 'numeroPessoas', 'data', 'contacto', 
        'origem', 'destino', 'horaPickup', 'valorTotal', 
        'modoPagamento', 'pagoParaQuem'
    ];

    for (let field of requiredFields) {
        const element = document.getElementById(field);
        console.log(`Campo ${field}:`, element.value, 'Visível:', element.style.display !== 'none');
        
        if (!element.value || element.value.trim() === '') {
            element.focus();
            showStatus(`Campo obrigatório não preenchido: ${getFieldLabel(field)}`, 'error');
            return false;
        }
    }

    const valor = parseFloat(document.getElementById('valorTotal').value);
    if (isNaN(valor) || valor <= 0) {
        document.getElementById('valorTotal').focus();
        showStatus('Valor deve ser um número positivo', 'error');
        return false;
    }

    const pessoas = parseInt(document.getElementById('numeroPessoas').value);
    if (isNaN(pessoas) || pessoas < 1) {
        showStatus('Número de pessoas deve ser pelo menos 1', 'error');
        return false;
    }

    return true;
}

function getFieldLabel(fieldId) {
            const labels = {
                'nomeCliente': 'Nome do Cliente',
                'numeroPessoas': 'Número de Pessoas',
                'data': 'Data do Transfer',
                'contacto': 'Contacto do Cliente',
                'origem': 'Local de Origem',
                'destino': 'Local de Destino',
                'horaPickup': 'Hora de Pick-up',
                'valorTotal': 'Valor do Serviço',
                'modoPagamento': 'Forma de Pagamento',
                'pagoParaQuem': 'Pago Para'
            };
            return labels[fieldId] || fieldId;
        }

        function clearForm() {
            try {
                document.getElementById('transferForm').reset();
                
                document.getElementById('numeroPessoas').value = '';
                document.getElementById('numeroBagagens').value = '0';
                document.getElementById('modoPagamento').value = '';
                document.getElementById('pagoParaQuem').value = '';
                document.getElementById('observacoes').value = '';
                document.getElementById('tourSelecionado').value = '';
                
                currentServiceType = 'transfer';
                precoUnitarioAtual = 0;
                
                document.querySelectorAll('.btn-people, .btn-baggage, .btn-date, .btn-time, .origem-btn, .destino-btn, .btn-price, .btn-payment, .btn-payment-to, .btn-obs, .btn-service').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                document.getElementById('tourSelector').classList.remove('show');
                document.getElementById('priceCalculationBox').classList.remove('show');
                
                document.querySelector('.btn-service').classList.add('active');
                
                editingId = null;
                document.getElementById('submitBtn').textContent = 'Solicitar Transfer';
                
                if (phoneInput) {
                    phoneInput.setNumber('');
                }
                
                document.getElementById('data').valueAsDate = new Date();
                
                console.log('Formulário limpo com sucesso');
                
            } catch (error) {
                console.error('Erro ao limpar formulário:', error);
                showStatus('Erro ao limpar formulário', 'error');
            }
        }

        function getNextSyncedId() {
            const localIds = services.map(s => parseInt(s.id)).filter(id => !isNaN(id));
            const maxLocalId = localIds.length > 0 ? Math.max(...localIds) : 0;
            
            const finalId = Math.max(nextAvailableId, maxLocalId + 1);
            nextAvailableId = finalId + 1;
            
            return finalId;
        }

        // =====================================================
        // EDIÇÃO E MANIPULAÇÃO DE SERVIÇOS
        // =====================================================
        function editService(id) {
            const service = services.find(s => s.id === id);
            if (!service) {
                showStatus('Serviço não encontrado', 'error');
                return;
            }

            try {
                document.getElementById('nomeCliente').value = service.nomeCliente;
                document.getElementById('numeroPessoas').value = service.numeroPessoas;
                document.getElementById('numeroBagagens').value = service.numeroBagagens;
                document.getElementById('data').value = service.data;
                document.getElementById('numeroVoo').value = service.numeroVoo || '';
                document.getElementById('origem').value = service.origem;
                document.getElementById('destino').value = service.destino;
                document.getElementById('horaPickup').value = service.horaPickup;
                document.getElementById('valorTotal').value = service.valorTotal;
                document.getElementById('modoPagamento').value = service.modoPagamento;
                document.getElementById('pagoParaQuem').value = service.pagoParaQuem;
                document.getElementById('observacoes').value = service.observacoes || '';
                
                if (service.tipoServico) {
                    currentServiceType = service.tipoServico;
                    document.querySelectorAll('.btn-service').forEach(btn => {
                        btn.classList.remove('active');
                        if (btn.onclick.toString().includes(service.tipoServico)) {
                            btn.classList.add('active');
                        }
                    });
                    
                    if (service.tourSelecionado) {
                        document.getElementById('tourSelector').classList.add('show');
                        document.getElementById('tourSelecionado').value = service.tourSelecionado;
                    }
                }
                
                if (phoneInput) {
                    phoneInput.setNumber(service.contacto);
                } else {
                    document.getElementById('contacto').value = service.contacto;
                }
                
                updateActiveButtons(service);
                updateCalculation();
                
                editingId = id;
                document.getElementById('submitBtn').textContent = 'Atualizar Transfer';
                
                document.querySelector('.quick-add').scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
                
                showStatus('Editando transfer #' + id, 'success');
                
            } catch (error) {
                console.error('Erro ao editar serviço:', error);
                showStatus('Erro ao carregar dados para edição', 'error');
            }
        }

        function updateActiveButtons(service) {
            document.querySelectorAll('.btn-people').forEach(btn => {
                if (btn.textContent.includes(service.numeroPessoas.toString())) {
                    btn.classList.add('active');
                }
            });
            
            document.querySelectorAll('.btn-baggage').forEach(btn => {
                if (btn.textContent.includes(service.numeroBagagens.toString())) {
                    btn.classList.add('active');
                }
            });
            
            document.querySelectorAll('.btn-price').forEach(btn => {
                if (btn.textContent.includes(service.valorTotal.toString())) {
                    btn.classList.add('active');
                }
            });
            
            document.querySelectorAll('.btn-payment').forEach(btn => {
                if (btn.textContent.toLowerCase().includes(service.modoPagamento.toLowerCase())) {
                    btn.classList.add('active');
                }
            });
            
            document.querySelectorAll('.btn-payment-to').forEach(btn => {
                if (btn.textContent.toLowerCase().includes(service.pagoParaQuem.toLowerCase())) {
                    btn.classList.add('active');
                }
            });
        }

        async function changeStatus(id) {
            const service = services.find(s => s.id === id);
            if (!service) {
                showStatus('Serviço não encontrado', 'error');
                return;
            }

            const statuses = ['Solicitado', 'Confirmado', 'Finalizado', 'Cancelado'];
            const currentIndex = statuses.indexOf(service.status);
            const nextIndex = (currentIndex + 1) % statuses.length;
            
            service.status = statuses[nextIndex];
            
            try {
                saveData();
                renderTable();
                updateSummary();
                
                if (isConnected) {
                    await sendToSheets(service);
                    showStatus(`Status alterado para: ${service.status}`, 'success');
                } else {
                    showStatus(`Status alterado para: ${service.status} (apenas local)`, 'warning');
                }
                
            } catch (error) {
                console.error('Erro ao alterar status:', error);
                showStatus('Erro ao alterar status', 'error');
            }
        }

        function deleteService(id) {
            if (!confirm('Tem certeza que deseja deletar este serviço?')) {
                return;
            }

            try {
                const originalLength = services.length;
                services = services.filter(s => s.id !== id);
                
                if (services.length < originalLength) {
                    saveData();
                    renderTable();
                    updateSummary();
                    showStatus('Transfer deletado com sucesso', 'success');
                } else {
                    showStatus('Transfer não encontrado', 'error');
                }
                
            } catch (error) {
                console.error('Erro ao deletar serviço:', error);
                showStatus('Erro ao deletar transfer', 'error');
            }
        }

        // =====================================================
        // EXPORTAÇÃO CSV
        // =====================================================
        function exportToCSV() {
            if (services.length === 0) {
                showStatus('Não há dados para exportar!', 'warning');
                return;
            }

            try {
                const headers = [
                    'ID', 'Cliente', 'Tipo Serviço', 'Tour Selecionado', 'Pessoas', 'Bagagens', 
                    'Data', 'Contacto', 'Voo', 'Origem', 'Destino', 'Hora Pick-up', 'Valor Total', 
                    'Valor Hotel', 'Valor HUB', 'Comissão Recepção', 'Pagamento', 'Pago Para', 
                    'Status', 'Observações', 'Data Criação'
                ];
                
                let csvContent = headers.join(',') + '\n';
                
                services.forEach(service => {
                    const row = [
                        service.id,
                        `"${service.nomeCliente}"`,
                        `"${service.tipoServico || 'Transfer'}"`,
                        `"${service.tourSelecionado || ''}"`,
                        service.numeroPessoas,
                        service.numeroBagagens,
                        service.data,
                        `"${service.contacto}"`,
                        `"${service.numeroVoo || ''}"`,
                        `"${service.origem}"`,
                        `"${service.destino}"`,
                        service.horaPickup,
                        service.valorTotal,
                        service.valorHotel || 0,
                        service.valorHUB || 0,
                        service.comissaoRecepcao || 0,
                        `"${service.modoPagamento}"`,
                        `"${service.pagoParaQuem}"`,
                        service.status,
                        `"${service.observacoes || ''}"`,
                        `"${service.created || ''}"`
                    ];
                    csvContent += row.join(',') + '\n';
                });

                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `transfers_Empire_marques_hub_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showStatus(`${services.length} transfers exportados com sucesso!`, 'success');
                
            } catch (error) {
                console.error('Erro ao exportar CSV:', error);
                showStatus('Erro ao exportar dados', 'error');
            }
        }

        // =====================================================
        // INICIALIZAÇÃO DO GOOGLE MAPS
        // =====================================================
        function initializeAutocomplete() {
            if (typeof google !== 'undefined' && google.maps && google.maps.places) {
                try {
                    const origemInput = document.getElementById('origem');
                    const destinoInput = document.getElementById('destino');
                    
                    if (origemInput && destinoInput) {
                        const origemAutocomplete = new google.maps.places.Autocomplete(origemInput, {
                            types: ['establishment', 'geocode'],
                            componentRestrictions: { country: 'pt' }
                        });

                        const destinoAutocomplete = new google.maps.places.Autocomplete(destinoInput, {
                            types: ['establishment', 'geocode'],
                            componentRestrictions: { country: 'pt' }
                        });

                        origemInput.addEventListener('input', function() {
                            document.querySelectorAll('.origem-btn').forEach(btn => btn.classList.remove('active'));
                        });

                        destinoInput.addEventListener('input', function() {
                            document.querySelectorAll('.destino-btn').forEach(btn => btn.classList.remove('active'));
                        });
                        
                        console.log('Google Maps Autocomplete inicializado com sucesso');
                    }
                    
                } catch (error) {
                    console.warn('Erro ao inicializar Google Maps Autocomplete:', error);
                }
            } else {
                if (typeof google === 'undefined') {
                    console.log('Google Maps ainda não carregou, tentando novamente em 2s...');
                    setTimeout(initializeAutocomplete, 2000);
                }
            }
        }

        // =====================================================
        // FUNÇÕES UTILITÁRIAS E EVENT LISTENERS
        // =====================================================
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        const debouncedClientFilter = debounce(updateClientFilter, 500);

        // =====================================================
        // INICIALIZAÇÃO PRINCIPAL DO SISTEMA
        // =====================================================
        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('Inicializando Sistema de Transfers Empire Marques Hotel v8.0...');
                
                // Carregar dados salvos primeiro
                loadData();
                loadSavedFilters();
                
                // Definir data de hoje como padrão
                document.getElementById('data').valueAsDate = new Date();
                
                // Inicializar componentes
                initializeAutocomplete();
                setTimeout(initializePhoneInput, 1000);
                
                // Campo de busca com debounce
                const searchClient = document.getElementById('searchClient');
                if (searchClient) {
                    searchClient.addEventListener('input', debouncedClientFilter);
                }
                
                // Event listeners para teclado
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && e.target.type === 'button') {
                        e.preventDefault();
                    }
                });

                document.addEventListener('keydown', function(e) {
                    if (e.ctrlKey && e.key === 'Enter') {
                        const submitBtn = document.getElementById('submitBtn');
                        if (!submitBtn.disabled) {
                            submitBtn.click();
                        }
                    }
                    
                    if (e.key === 'Escape') {
                        clearForm();
                    }
                });

                // Salvar dados antes de sair
                window.addEventListener('beforeunload', function(e) {
                    saveData();
                });
                
                // Sincronização automática caso não tenha dados
                setTimeout(async () => {
                    if (services.length === 0) {
                        console.log('Nenhum dado local encontrado, tentando carregar do Google Sheets...');
                        await loadTransfersFromSheets();
                    } else {
                        console.log('Dados locais carregados, renderizando tabela...');
                        renderTable();
                        updateSummary();
                    }
                }, 2000);

                console.log('Sistema inicializado completamente');
                
            } catch (error) {
                console.error('Erro na inicialização:', error);
                showStatus('Erro na inicialização do sistema', 'error');
            }
        });

        // =====================================================
        // FUNÇÕES DE DEBUG E DESENVOLVIMENTO
        // =====================================================
        function debugInfo() {
            console.log('=== DEBUG INFO SISTEMA v8.0 ===');
            console.log('Services:', services.length);
            console.log('Connected:', isConnected);
            console.log('Editing ID:', editingId);
            console.log('Phone Input:', phoneInput);
            console.log('Saved URL:', localStorage.getItem('webappUrl'));
            console.log('WEBAPP URL:', WEBAPP_URL);
            console.log('Email de Teste:', TEST_EMAIL);
            console.log('Service Type:', currentServiceType);
            console.log('Admin Mode:', isAdminMode);
            console.log('Active Filters:', activeFilters);
            console.log('Filtered Data:', filteredData.length);
            console.log('Sync In Progress:', syncInProgress);
            console.log('Last Sync Time:', lastSyncTime);
            console.log('Server Data:', serverData.length);
            console.log('Next Available ID:', nextAvailableId);
            console.log('=====================================');
        }

        function resetSystem() {
            if (confirm('ATENÇÃO: Esta ação irá resetar COMPLETAMENTE o sistema!\n\nTodos os dados locais serão perdidos. Continuar?')) {
                localStorage.clear();
                services = [];
                activeFilters = {
                    dateStart: null,
                    dateEnd: null,
                    status: '',
                    cliente: '',
                    quickPeriod: '',
                    tipoServico: ''
                };
                filteredData = [];
                serverData = [];
                lastSyncTime = null;
                nextAvailableId = 1;
                
                renderTable();
                updateSummary();
                clearForm();
                
                console.log('Sistema resetado completamente');
                showStatus('Sistema resetado com sucesso!', 'success');
            }
        }

        // Exposição das funções de debug para o console
        window.debugInfo = debugInfo;
        window.resetSystem = resetSystem;
        window.syncWithServer = syncWithServer;
        window.testConnection = testConnection;
        window.loadTransfersFromSheets = loadTransfersFromSheets;
        window.testBasicConnectivity = testBasicConnectivity;

        // Log final de inicialização
        console.log('Sistema de Transfers Empire Marques Hotel & HUB Transfer v8.0');
        console.log('Email configurado para testes:', TEST_EMAIL);
        console.log('URL do WebApp:', WEBAPP_URL);
        console.log('Senha admin: admin2025');
        console.log('Funcionalidades disponíveis no console:');
        console.log('   - debugInfo() - Informações de debug');
        console.log('   - resetSystem() - Reset completo do sistema');
        console.log('   - syncWithServer() - Sincronização manual');
        console.log('   - testConnection() - Teste de conexão');
        console.log('   - loadTransfersFromSheets() - Carregar transfers do Google Sheets');
                
        // Garantir que as funções estão no escopo global
        window.toggleConfig = toggleConfig;
        window.loadTransfersFromSheets = loadTransfersFromSheets;
        window.testBasicConnectivity = testBasicConnectivity;
        window.clearAllData = clearAllData;
        window.clearTestData = clearTestData;
        window.toggleClearData = toggleClearData;

// Função para debug dos horários - TEMPORÁRIA
function debugHorarios() {
    console.log('=== DEBUG HORÁRIOS ===');
    services.forEach((service, index) => {
        console.log(`#${service.id} - ${service.nomeCliente}: "${service.horaPickup}"`);
    });
    console.log('====================');
}

// Expor função para teste
window.debugHorarios = debugHorarios;
        
    </script>
</body>
</html>
