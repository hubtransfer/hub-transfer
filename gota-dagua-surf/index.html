<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Parceria - Gota d'√Ågua & HUB Transfer</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè®</text></svg>">
    
    <!-- Google Maps API com callback e tratamento de erros -->
    <script>
        function initMap() {
            console.log('‚úÖ Google Maps carregado com sucesso!');
            if (window.GoogleMapsService) {
                window.GoogleMapsService.initialize();
            }
        }
        
        window.gm_authFailure = function() {
            console.error('‚ùå Erro de autentica√ß√£o do Google Maps');
            if (window.GoogleMapsService) {
                window.GoogleMapsService.initializeFallback();
            }
        };
    </script>
    
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBe4UwnVYRP5KAUOtHg3diD6kPTif3VN30&libraries=places&callback=initMap">
    </script>
    
    <!-- International Phone Input -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/intlTelInput.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/css/intlTelInput.css">
    
    <style>
        /* ===================================
           GOTA D'√ÅGUA - SISTEMA DE TRANSFERS
           CSS Moderno e Responsivo
           =================================== */
        
        /* Reset e Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Cores Principais */
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            
            /* Cores Neutras */
            --white: #ffffff;
            --light-gray: #f8f9fa;
            --gray: #6c757d;
            --dark-gray: #495057;
            
            /* Gradientes */
            --gradient-primary: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            --gradient-header: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            --gradient-success: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            
            /* Sombras */
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.15);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.2);
            
            /* Transi√ß√µes */
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
            
            /* Border Radius */
            --border-radius-sm: 6px;
            --border-radius-md: 12px;
            --border-radius-lg: 20px;
            
            /* Espa√ßamentos */
            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;
        }

        /* Tipografia */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--gradient-primary);
            min-height: 100vh;
            padding: var(--spacing-md);
            color: var(--dark-gray);
            line-height: 1.6;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            color: var(--white);
        }

        .loading-content {
            text-align: center;
            animation: fadeInUp 0.6s ease-out;
        }

        .hotel-logo {
            font-size: 4rem;
            margin-bottom: var(--spacing-md);
            animation: pulse 2s infinite;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid var(--white);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: var(--spacing-md) auto;
        }

        /* Container Principal */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            animation: slideInUp 0.6s ease-out;
        }

        /* Header */
        .header {
            background: var(--gradient-header);
            color: var(--white);
            padding: var(--spacing-xl);
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: var(--spacing-sm);
            font-weight: 700;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: var(--spacing-md);
        }

        .company-logos {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--spacing-xl);
            margin-top: var(--spacing-md);
        }

        .company-logo {
            background: rgba(255,255,255,0.1);
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--border-radius-md);
            font-size: 1.2rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
            transition: var(--transition-normal);
        }

        .company-logo:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        /* Se√ß√µes de Configura√ß√£o */
        .config-section,
        .clear-data-section {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            padding: var(--spacing-lg);
            border: 3px solid var(--warning-color);
            border-radius: var(--border-radius-md);
            margin: var(--spacing-md);
            display: none;
            box-shadow: var(--shadow-md);
        }

        .config-section.show,
        .clear-data-section.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        .clear-data-section {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            border-color: var(--danger-color);
        }

        .config-title,
        .clear-data-title {
            color: #d35400;
            font-weight: bold;
            margin-bottom: var(--spacing-md);
            font-size: 1.4rem;
            text-align: center;
        }

        .clear-data-title {
            color: #c62828;
        }

        .config-form,
        .clear-data-actions {
            display: flex;
            gap: var(--spacing-md);
            align-items: end;
            flex-wrap: wrap;
            justify-content: center;
        }

        .config-input {
            flex: 1;
            min-width: 300px;
        }

        .config-input label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-weight: 600;
            color: #d35400;
        }

        .clear-data-warning {
            background: #ffebee;
            border: 2px solid var(--danger-color);
            padding: var(--spacing-md);
            border-radius: var(--border-radius-sm);
            margin-bottom: var(--spacing-md);
            color: #c62828;
            font-weight: 600;
            text-align: center;
        }

        /* Status Messages */
        .status-message {
            padding: var(--spacing-md);
            border-radius: var(--border-radius-sm);
            margin: var(--spacing-md);
            font-weight: 600;
            text-align: center;
            display: none;
            animation: slideInDown 0.3s ease-out;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        /* Formul√°rio de Transfer */
        .transfer-form-section {
            background: var(--light-gray);
            padding: var(--spacing-xl);
            border-bottom: 3px solid var(--secondary-color);
        }

        .transfer-form-section h2 {
            color: var(--primary-color);
            margin-bottom: var(--spacing-md);
            text-align: center;
            font-size: 1.8rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: var(--spacing-xs);
            font-size: 1rem;
        }

        /* Inputs Base */
        input, select, textarea {
            padding: 14px 16px;
            border: 2px solid #e9ecef;
            border-radius: var(--border-radius-md);
            font-size: 1rem;
            transition: var(--transition-normal);
            background: var(--white);
            font-family: inherit;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        input:invalid {
            border-color: var(--danger-color);
        }

        /* Bot√µes */
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: var(--border-radius-md);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-normal);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            font-family: inherit;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-primary {
            background: var(--gradient-header);
            color: var(--white);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: var(--gradient-success);
            color: var(--white);
        }

        .btn-success:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(39, 174, 96, 0.3);
        }

        .btn-export {
            background: linear-gradient(135deg, var(--accent-color) 0%, #c0392b 100%);
            color: var(--white);
        }

        .btn-export:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(231, 76, 60, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color) 0%, #e67e22 100%);
            color: var(--white);
        }

        .btn-warning:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(243, 156, 18, 0.3);
        }

        .btn-clear {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            color: var(--white);
        }

        .btn-clear:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(149, 165, 166, 0.3);
        }

        .btn-config {
            background: linear-gradient(135deg, var(--warning-color) 0%, #e67e22 100%);
            color: var(--white);
            font-size: 0.9rem;
            padding: 12px 20px;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color) 0%, #c0392b 100%);
            color: var(--white);
        }

        .btn-danger:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(231, 76, 60, 0.3);
        }

        .btn.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            margin: -8px 0 0 -8px;
            border: 2px solid transparent;
            border-top-color: var(--white);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .btn.loading {
            color: transparent;
        }

        /* Bot√µes de Sele√ß√£o */
        .service-buttons,
        .people-buttons,
        .baggage-buttons,
        .date-buttons,
        .time-buttons,
        .location-buttons,
        .price-buttons,
        .payment-buttons,
        .payment-to-buttons,
        .obs-buttons {
            display: flex;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-sm);
            flex-wrap: wrap;
        }

        .btn-service,
        .btn-people,
        .btn-baggage,
        .btn-date,
        .btn-time,
        .btn-location,
        .btn-price,
        .btn-payment,
        .btn-payment-to,
        .btn-obs {
            padding: 10px 14px;
            border: 2px solid #e9ecef;
            border-radius: var(--border-radius-sm);
            background: var(--white);
            color: var(--dark-gray);
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition-normal);
            font-weight: 600;
            font-family: inherit;
        }

        .btn-service:hover,
        .btn-people:hover,
        .btn-baggage:hover,
        .btn-date:hover,
        .btn-time:hover,
        .btn-location:hover,
        .btn-price:hover,
        .btn-payment:hover,
        .btn-payment-to:hover,
        .btn-obs:hover {
            border-color: var(--secondary-color);
            background: #e7f3ff;
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .btn-service.active,
        .btn-people.active,
        .btn-baggage.active,
        .btn-date.active,
        .btn-time.active,
        .btn-location.active,
        .btn-price.active,
        .btn-payment.active,
        .btn-payment-to.active,
        .btn-obs.active {
            background: var(--secondary-color);
            color: var(--white);
            border-color: #2980b9;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
        }

        /* Bot√µes Espec√≠ficos */
        .btn-people {
            min-width: 50px;
            font-size: 1.1rem;
            border-color: #9b59b6;
            color: #9b59b6;
        }

        .btn-people:hover,
        .btn-people.active {
            background: #9b59b6;
            color: var(--white);
            border-color: #8e44ad;
        }

        .btn-baggage {
            min-width: 50px;
            font-size: 1.1rem;
            border-color: #e67e22;
            color: #e67e22;
        }

        .btn-baggage:hover,
        .btn-baggage.active {
            background: #e67e22;
            color: var(--white);
            border-color: #d35400;
        }

        .btn-location {
            min-width: 160px;
            text-align: center;
        }

        .origem-btn {
            border-left: 4px solid var(--accent-color);
        }

        .destino-btn {
            border-left: 4px solid var(--success-color);
        }

        .btn-payment {
            min-width: 130px;
            font-size: 1rem;
        }

        .btn-payment-to {
            min-width: 140px;
            font-size: 1rem;
        }

        .btn-price {
            font-weight: 700;
            color: var(--success-color);
            border-color: var(--success-color);
        }

        .btn-price:hover,
        .btn-price.active {
            background: var(--success-color);
            color: var(--white);
        }

        .btn-obs {
            font-size: 0.85rem;
            background: var(--light-gray);
        }

        /* Phone Input */
        .phone-container {
            position: relative;
        }

        .iti {
            width: 100%;
        }

        .iti__country-list {
            z-index: 9999;
        }

        .iti__selected-flag {
            padding: 14px 12px;
        }

        .iti__flag-container {
            padding: 0;
        }

        #contacto {
            padding-left: 60px;
        }

        /* Price Calculation Box */
        .price-calculation-box {
            background: linear-gradient(135deg, #e7f3ff 0%, #cce5ff 100%);
            border: 2px solid var(--secondary-color);
            border-radius: var(--border-radius-md);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
            display: none;
        }

        .price-calculation-box.show {
            display: block;
            animation: slideInDown 0.3s ease-out;
        }

        .calculation-header {
            color: var(--primary-color);
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: var(--spacing-md);
            text-align: center;
        }

        .calculation-details {
            background: var(--white);
            padding: var(--spacing-md);
            border-radius: var(--border-radius-sm);
            margin-bottom: var(--spacing-md);
        }

        .calculation-row {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-xs) 0;
            border-bottom: 1px solid #e9ecef;
        }

        .calculation-row:last-child {
            border-bottom: none;
        }

        .calculation-label {
            color: var(--gray);
            font-weight: 600;
        }

        .calculation-value {
            color: var(--primary-color);
            font-weight: 700;
        }

        .calculation-total {
            background: var(--success-color);
            color: var(--white);
            padding: var(--spacing-md);
            border-radius: var(--border-radius-sm);
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .admin-fields {
            display: none;
            background: #fff3cd;
            padding: var(--spacing-md);
            border-radius: var(--border-radius-sm);
            margin-top: var(--spacing-sm);
        }

        .admin-fields.show {
            display: block;
        }

        /* Form Actions */
        .form-actions {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            margin-top: var(--spacing-lg);
            flex-wrap: wrap;
        }

        /* Summary Section */
        .summary-section {
            padding: var(--spacing-xl);
            background: var(--light-gray);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
        }

        .summary-card {
            background: var(--white);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius-md);
            text-align: center;
            box-shadow: var(--shadow-md);
            border-left: 5px solid var(--secondary-color);
            transition: var(--transition-normal);
        }

        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .summary-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: var(--spacing-xs);
        }

        .summary-label {
            color: var(--gray);
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Financial Summary */
        .financial-summary {
            background: var(--gradient-header);
            color: var(--white);
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            margin-bottom: var(--spacing-xl);
        }

        .financial-summary h3 {
            text-align: center;
            margin-bottom: var(--spacing-lg);
            font-size: 1.8rem;
        }

        .financial-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
        }

        .financial-item {
            text-align: center;
            background: rgba(255,255,255,0.1);
            padding: var(--spacing-md);
            border-radius: var(--border-radius-md);
            backdrop-filter: blur(10px);
        }

        .financial-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-xs);
        }

        .financial-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        /* Services Section */
        .services-section {
            padding: var(--spacing-xl);
        }

        .services-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        .services-title {
            color: var(--primary-color);
            font-size: 2rem;
            font-weight: 700;
        }

        .filters {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 140px;
        }

        .filter-group label {
            font-size: 0.9rem;
            margin-bottom: var(--spacing-xs);
            font-weight: 600;
        }

        .filter-group input,
        .filter-group select {
            padding: var(--spacing-xs) var(--spacing-sm);
            font-size: 0.9rem;
        }

        /* Services Table */
        .services-table-container {
            background: var(--white);
            border-radius: var(--border-radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .services-table {
            width: 100%;
            border-collapse: collapse;
        }

        .services-table th {
            background: var(--gradient-header);
            color: var(--white);
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .services-table td {
            padding: 16px 15px;
            border-bottom: 1px solid #ecf0f1;
            font-size: 0.95rem;
        }

        .services-table tr:hover {
            background: var(--light-gray);
        }

        .services-table tr:last-child td {
            border-bottom: none;
        }

        /* Status Badges */
        .status {
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .status-solicitado {
            background: #fff3cd;
            color: #856404;
        }

        .status-confirmado {
            background: #d4edda;
            color: #155724;
        }

        .status-finalizado {
            background: #cce5ff;
            color: #004085;
        }

        .status-cancelado {
            background: #f8d7da;
            color: #721c24;
        }

        /* Payment Method Badges */
        .payment-method {
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
        }

        .payment-cash {
            background: #d4edda;
            color: #155724;
        }

        .payment-card {
            background: #cce5ff;
            color: #004085;
        }

        .payment-transfer {
            background: #fff3cd;
            color: #856404;
        }

        .pago-para {
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
        }

        .pago-recepcao {
            background: #e7f3ff;
            color: #004085;
        }

        .pago-motorista {
            background: #d4edda;
            color: #155724;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 6px 10px;
            font-size: 0.75rem;
            border-radius: 6px;
            min-width: 30px;
            text-align: center;
            transition: var(--transition-normal);
            border: none;
            cursor: pointer;
            font-family: inherit;
        }

        .btn-small:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

.btn-small:disabled {
           opacity: 0.7;
           cursor: not-allowed;
           transform: none;
       }

       /* Highlights */
       .client-info {
           font-weight: 600;
           color: var(--primary-color);
       }

       .value-highlight {
           font-weight: 700;
           color: var(--success-color);
           font-size: 1.1rem;
       }

       /* Empty State */
       .empty-state {
           text-align: center;
           padding: 60px 20px;
           color: var(--gray);
       }

       .empty-state h3 {
           font-size: 1.5rem;
           margin-bottom: var(--spacing-sm);
       }

       /* Admin Toggle */
       .admin-toggle {
           position: fixed;
           bottom: 20px;
           right: 20px;
           background: var(--gray);
           color: var(--white);
           padding: var(--spacing-sm) var(--spacing-md);
           border-radius: 50px;
           cursor: pointer;
           z-index: 1000;
           font-size: 0.9rem;
           font-weight: 600;
           transition: var(--transition-normal);
           box-shadow: var(--shadow-md);
       }

       .admin-toggle:hover {
           background: var(--dark-gray);
           transform: translateY(-2px);
       }

       /* Google Maps Autocomplete */
       .pac-container {
           z-index: 9999;
       }

       /* Animations */
       @keyframes fadeInUp {
           from {
               opacity: 0;
               transform: translateY(30px);
           }
           to {
               opacity: 1;
               transform: translateY(0);
           }
       }

       @keyframes slideInUp {
           from {
               opacity: 0;
               transform: translateY(50px);
           }
           to {
               opacity: 1;
               transform: translateY(0);
           }
       }

       @keyframes slideInDown {
           from {
               opacity: 0;
               transform: translateY(-20px);
           }
           to {
               opacity: 1;
               transform: translateY(0);
           }
       }

       @keyframes slideDown {
           from {
               opacity: 0;
               transform: translateY(-10px);
           }
           to {
               opacity: 1;
               transform: translateY(0);
           }
       }

       @keyframes spin {
           0% { transform: rotate(0deg); }
           100% { transform: rotate(360deg); }
       }

       @keyframes pulse {
           0% { transform: scale(1); }
           50% { transform: scale(1.05); }
           100% { transform: scale(1); }
       }

       /* Responsive Design */
       @media (max-width: 768px) {
           body {
               padding: var(--spacing-sm);
           }
           
           .header h1 {
               font-size: 2rem;
           }
           
           .header p {
               font-size: 1rem;
           }
           
           .company-logos {
               flex-direction: column;
               gap: var(--spacing-md);
           }
           
           .form-grid {
               grid-template-columns: 1fr;
           }
           
           .summary-grid {
               grid-template-columns: repeat(2, 1fr);
           }
           
           .financial-grid {
               grid-template-columns: 1fr;
           }
           
           .filters {
               flex-direction: column;
           }
           
           .services-header {
               flex-direction: column;
               align-items: stretch;
           }
           
           .config-form,
           .clear-data-actions {
               flex-direction: column;
           }
           
           .config-input {
               min-width: 100%;
           }
           
           .form-actions {
               flex-direction: column;
           }
           
           .admin-toggle {
               bottom: 10px;
               right: 10px;
               font-size: 0.8rem;
               padding: var(--spacing-xs) var(--spacing-sm);
           }
           
           /* Table responsiva */
           .services-table-container {
               overflow-x: auto;
           }
           
           .services-table {
               min-width: 1000px;
           }
       }

       @media (max-width: 480px) {
           .header {
               padding: var(--spacing-md);
           }
           
           .header h1 {
               font-size: 1.8rem;
           }
           
           .transfer-form-section,
           .summary-section,
           .services-section {
               padding: var(--spacing-md);
           }
           
           .summary-grid {
               grid-template-columns: 1fr;
           }
           
           .btn {
               padding: 12px 20px;
               font-size: 0.9rem;
           }
           
           .btn-small {
               padding: 4px 8px;
               font-size: 0.7rem;
           }
       }

       /* Print Styles */
       @media print {
           .admin-toggle,
           .config-section,
           .clear-data-section,
           .form-actions,
           .action-buttons,
           .filters {
               display: none !important;
           }
           
           .container {
               box-shadow: none;
               margin: 0;
               padding: 0;
           }
           
           .header {
               background: var(--white) !important;
               color: var(--primary-color) !important;
           }
           
           .services-table th {
               background: var(--light-gray) !important;
               color: var(--primary-color) !important;
           }
       }
   </style>
</head>

<body>
   <!-- Loading Screen -->
   <div id="loadingScreen" class="loading-screen">
       <div class="loading-content">
           <div class="hotel-logo">üè®</div>
           <h2>Gota d'√Ågua</h2>
           <div class="loading-spinner"></div>
           <p>Carregando sistema...</p>
       </div>
   </div>

   <!-- Main Container -->
   <div id="mainContainer" class="container" style="display: none;">
       
       <!-- Header -->
       <header class="header">
           <h1>ü§ù Sistema de Parceria</h1>
           <p>Gest√£o de Transfers - Colabora√ß√£o Empresarial</p>
           <div class="company-logos">
               <div class="company-logo">üè® Gota d'√Ågua</div>
               <div class="company-logo">üöê HUB Transfer</div>
           </div>
       </header>

       <!-- Status Messages -->
       <div id="statusContainer"></div>

       <!-- Configuration Section -->
       <section id="configSection" class="config-section">
           <div class="config-title">üîó Configura√ß√£o do Google Sheets</div>
           <div class="config-form">
               <div class="config-input">
                   <label for="webappUrl">URL do Google Apps Script:</label>
                   <input type="url" 
                          id="webappUrl" 
                          value="https://script.google.com/macros/s/AKfycbxVnWXIVPXMs3e5qRzF8GDynOVg7OPodoi07QgJ40KHxDKVD_p0at1kNiNjm9WSX5o6Yg/exec" 
                          placeholder="https://script.google.com/macros/s/...">
               </div>
               <button type="button" class="btn btn-success" id="testConnectionBtn">
                   üîó Testar Conex√£o
               </button>
               <button type="button" class="btn btn-export" id="closeConfigBtn">
                   üîí Fechar
               </button>
           </div>
       </section>

       <!-- Clear Data Section -->
       <section id="clearDataSection" class="clear-data-section">
           <div class="clear-data-title">üóëÔ∏è Limpeza de Dados</div>
           <div class="clear-data-warning">
               ‚ö†Ô∏è ATEN√á√ÉO: Esta opera√ß√£o ir√° remover PERMANENTEMENTE todos os registros de transfers do sistema!
               <br>Esta a√ß√£o n√£o pode ser desfeita.
           </div>
           <div class="clear-data-actions">
               <button type="button" class="btn btn-danger" id="clearAllDataBtn">
                   üóëÔ∏è Limpar Todos os Dados
               </button>
               <button type="button" class="btn btn-warning" id="clearTestDataBtn">
                   üßπ Limpar Apenas Testes
               </button>
               <button type="button" class="btn btn-clear" id="closeClearDataBtn">
                   üîí Fechar
               </button>
           </div>
       </section>

       <!-- Transfer Form Section -->
       <section class="transfer-form-section">
           <h2>‚ûï Solicitar Novo Transfer</h2>
           
           <form id="transferForm" class="transfer-form">
               <div class="form-grid">
                   
                   <!-- Nome do Cliente -->
                   <div class="form-group">
                       <label for="nomeCliente">Nome do Cliente *</label>
                       <input type="text" id="nomeCliente" required placeholder="Ex: Jo√£o Silva">
                   </div>
                   
                   <!-- Tipo de Servi√ßo -->
                   <div class="form-group">
                       <label>Tipo de Servi√ßo</label>
                       <div id="serviceSelector" class="service-buttons">
                           <button type="button" class="btn-service" data-service="transfer">
                               üöï Transfer
                           </button>
                           <button type="button" class="btn-service" data-service="tour">
                               üöê Tour Regular
                           </button>
                           <button type="button" class="btn-service" data-service="private">
                               üöó Private Tour
                           </button>
                       </div>
                   </div>
                   
                   <!-- Tour Selector -->
                   <div class="form-group" id="tourSelectorGroup" style="display: none;">
                       <label for="tourSelecionado">Selecione o Tour</label>
                       <select id="tourSelecionado">
                           <option value="">Escolha o tour...</option>
                           <optgroup label="Tours Regulares (Por Pessoa)">
                               <option value="tour-sintra-cascais" data-price="67" data-type="regular">
                                   Sintra e Cascais (8h) - ‚Ç¨67/pessoa
                               </option>
                               <option value="tour-fatima-obidos" data-price="83" data-type="regular">
                                   F√°tima e √ìbidos (8h) - ‚Ç¨83/pessoa
                               </option>
                               <option value="tour-combo-2dias" data-price="138" data-type="regular">
                                   Combo 2 Dias (16h) - ‚Ç¨138/pessoa
                               </option>
                           </optgroup>
                           <optgroup label="Private Tours (Por Grupo)">
                               <option value="private-sintra-palaces" data-price-small="347" data-price-large="492" data-type="private">
                                   Palaces of Sintra - ‚Ç¨347 (1-3) / ‚Ç¨492 (4-8)
                               </option>
                               <option value="private-evora" data-price-small="347" data-price-large="492" data-type="private">
                                   √âvora City - ‚Ç¨347 (1-3) / ‚Ç¨492 (4-8)
                               </option>
                               <option value="private-templars" data-price-small="347" data-price-large="492" data-type="private">
                                   Templars - ‚Ç¨347 (1-3) / ‚Ç¨492 (4-8)
                               </option>
                               <option value="private-arrabida" data-price-small="347" data-price-large="492" data-type="private">
                                   Arr√°bida - ‚Ç¨347 (1-3) / ‚Ç¨492 (4-8)
                               </option>
                           </optgroup>
                       </select>
                   </div>
                   
                   <!-- N√∫mero de Pessoas -->
                   <div class="form-group">
                       <label>N√∫mero de Pessoas *</label>
                       <div id="peopleSelector" class="people-buttons">
                           <button type="button" class="btn-people" data-people="1">1</button>
                           <button type="button" class="btn-people" data-people="2">2</button>
                           <button type="button" class="btn-people" data-people="3">3</button>
                           <button type="button" class="btn-people" data-people="4">4</button>
                           <button type="button" class="btn-people" data-people="5">5</button>
                           <button type="button" class="btn-people" data-people="6">6</button>
                           <button type="button" class="btn-people" data-people="7">7</button>
                           <button type="button" class="btn-people" data-people="8">8+</button>
                       </div>
                       <input type="number" id="numeroPessoas" min="1" max="20" required style="display: none;">
                   </div>
                   
                   <!-- N√∫mero de Bagagens -->
                   <div class="form-group">
                       <label>N√∫mero de Bagagens</label>
                       <div id="baggageSelector" class="baggage-buttons">
                           <button type="button" class="btn-baggage" data-baggage="0">0</button>
                           <button type="button" class="btn-baggage" data-baggage="1">1</button>
                           <button type="button" class="btn-baggage" data-baggage="2">2</button>
                           <button type="button" class="btn-baggage" data-baggage="3">3</button>
                           <button type="button" class="btn-baggage" data-baggage="4">4</button>
                           <button type="button" class="btn-baggage" data-baggage="5">5</button>
                           <button type="button" class="btn-baggage" data-baggage="6">6+</button>
                       </div>
                       <input type="number" id="numeroBagagens" min="0" max="20" value="0" style="display: none;">
                   </div>
                   
                   <!-- Data -->
                   <div class="form-group">
                       <label for="data">Data do Transfer *</label>
                       <div id="dateSelector" class="date-buttons">
                           <button type="button" class="btn-date" data-date="today">Hoje</button>
                           <button type="button" class="btn-date" data-date="tomorrow">Amanh√£</button>
                       </div>
                       <input type="date" id="data" required>
                   </div>
                   
                   <!-- Hora -->
                   <div class="form-group">
                       <label for="horaPickup">Hora de Pick-up *</label>
                       <div id="timeSelector" class="time-buttons">
                           <button type="button" class="btn-time" data-time="06:00">06:00</button>
                           <button type="button" class="btn-time" data-time="07:00">07:00</button>
                           <button type="button" class="btn-time" data-time="08:00">08:00</button>
                           <button type="button" class="btn-time" data-time="09:00">09:00</button>
                           <button type="button" class="btn-time" data-time="10:00">10:00</button>
                           <button type="button" class="btn-time" data-time="11:00">11:00</button>
                       </div>
                       <div class="time-buttons" style="margin-top: 10px;">
                           <button type="button" class="btn-time" data-time="12:00">12:00</button>
                           <button type="button" class="btn-time" data-time="13:00">13:00</button>
                           <button type="button" class="btn-time" data-time="14:00">14:00</button>
                           <button type="button" class="btn-time" data-time="15:00">15:00</button>
                           <button type="button" class="btn-time" data-time="16:00">16:00</button>
                           <button type="button" class="btn-time" data-time="17:00">17:00</button>
                       </div>
                       <div class="time-buttons" style="margin-top: 10px;">
                           <button type="button" class="btn-time" data-time="18:00">18:00</button>
                           <button type="button" class="btn-time" data-time="19:00">19:00</button>
                           <button type="button" class="btn-time" data-time="20:00">20:00</button>
                           <button type="button" class="btn-time" data-time="21:00">21:00</button>
                           <button type="button" class="btn-time" data-time="22:00">22:00</button>
                           <button type="button" class="btn-time" data-time="23:00">23:00</button>
                       </div>
                       <input type="time" id="horaPickup" required>
                   </div>
                   
                   <!-- Contacto -->
                   <div class="form-group">
                       <label for="contacto">Contacto do Cliente *</label>
                       <div class="phone-container">
                           <input type="tel" id="contacto" required placeholder="Digite o n√∫mero...">
                       </div>
                   </div>
                   
                   <!-- N√∫mero do Voo -->
                   <div class="form-group">
                       <label for="numeroVoo">N√∫mero do Voo</label>
                       <input type="text" id="numeroVoo" placeholder="Ex: TP1234">
                   </div>
                   
                   <!-- Origem -->
                   <div class="form-group">
                       <label for="origem">Local de Origem *</label>
                       <div id="originSelector" class="location-buttons">
                           <button type="button" class="btn-location origem-btn" data-location="Aeroporto de Lisboa">
                               ‚úàÔ∏è Aeroporto de Lisboa
                           </button>
                           <button type="button" class="btn-location origem-btn" data-location="Gota d'√Ågua">
                               üè® Gota d'√Ågua
                           </button>
                       </div>
                       <input type="text" id="origem" required placeholder="Digite ou escolha o endere√ßo...">
                   </div>
                   
                   <!-- Destino -->
                   <div class="form-group">
                       <label for="destino">Local de Destino *</label>
                       <div id="destinationSelector" class="location-buttons">
                           <button type="button" class="btn-location destino-btn" data-location="Gota d'√Ågua">
                               üè® Gota d'√Ågua
                           </button>
                           <button type="button" class="btn-location destino-btn" data-location="Aeroporto de Lisboa">
                               ‚úàÔ∏è Aeroporto de Lisboa
                           </button>
                       </div>
                       <input type="text" id="destino" required placeholder="Digite ou escolha o endere√ßo...">
                   </div>
                   
                   <!-- Valor -->
                   <div class="form-group">
                       <label for="valorTotal">Valor do Servi√ßo (‚Ç¨) *</label>
                       <div id="priceSelector" class="price-buttons">
                           <button type="button" class="btn-price" data-price="25">‚Ç¨25</button>
                           <button type="button" class="btn-price" data-price="35">‚Ç¨35</button>
                           <button type="button" class="btn-price" data-price="45">‚Ç¨45</button>
                           <button type="button" class="btn-price" data-price="60">‚Ç¨60</button>
                           <button type="button" class="btn-price" data-price="75">‚Ç¨75</button>
                           <button type="button" class="btn-price" data-price="100">‚Ç¨100</button>
                       </div>
                       <input type="number" id="valorTotal" step="0.01" required placeholder="Ou digite valor...">
                   </div>
                   
                   <!-- Forma de Pagamento -->
                   <div class="form-group">
                       <label>Forma de Pagamento *</label>
                       <div id="paymentSelector" class="payment-buttons">
                           <button type="button" class="btn-payment" data-payment="Dinheiro">
                               üíµ Dinheiro
                           </button>
                           <button type="button" class="btn-payment" data-payment="Cart√£o">
                               üí≥ Cart√£o
                           </button>
                           <button type="button" class="btn-payment" data-payment="Transfer√™ncia">
                               üè¶ Transfer√™ncia
                           </button>
                       </div>
                       <select id="modoPagamento" required style="display: none;">
                           <option value="">Selecionar...</option>
                           <option value="Dinheiro">Dinheiro</option>
                           <option value="Cart√£o">Cart√£o</option>
                           <option value="Transfer√™ncia">Transfer√™ncia Banc√°ria</option>
                       </select>
                   </div>
                   
                   <!-- Pago Para -->
                   <div class="form-group">
                       <label>Pago Para *</label>
                       <div id="paymentToSelector" class="payment-to-buttons">
                           <button type="button" class="btn-payment-to" data-payment-to="Recep√ß√£o">
                               üè® Recep√ß√£o
                           </button>
                           <button type="button" class="btn-payment-to" data-payment-to="Motorista">
                               üöê Motorista
                           </button>
                       </div>
                       <select id="pagoParaQuem" required style="display: none;">
                           <option value="">Selecionar...</option>
                           <option value="Recep√ß√£o">Recep√ß√£o</option>
                           <option value="Motorista">Motorista</option>
                       </select>
                   </div>
                   
                   <!-- Observa√ß√µes -->
                   <div class="form-group">
                       <label for="observacoes">Observa√ß√µes</label>
                       <div id="observationSelector" class="obs-buttons">
                           <button type="button" class="btn-obs" data-obs="Bagagem extra">Bagagem Extra</button>
                           <button type="button" class="btn-obs" data-obs="Transfer urgente">Urgente</button>
                           <button type="button" class="btn-obs" data-obs="Cliente VIP">VIP</button>
                           <button type="button" class="btn-obs" data-obs="Com crian√ßa">Com Crian√ßa</button>
                       </div>
                       <textarea id="observacoes" rows="3" placeholder="Informa√ß√µes adicionais..."></textarea>
                   </div>
                   
               </div>

               <!-- Price Calculation Box -->
               <div id="priceCalculationBox" class="price-calculation-box">
                   <div class="calculation-header">üí∞ C√°lculo do Valor Total</div>
                   <div class="calculation-details">
                       <div class="calculation-row">
                           <span class="calculation-label">Tipo de Servi√ßo:</span>
                           <span class="calculation-value" id="calcTipoServico">-</span>
                       </div>
                       <div class="calculation-row">
                           <span class="calculation-label">Pre√ßo Unit√°rio:</span>
                           <span class="calculation-value" id="calcPrecoUnitario">‚Ç¨0</span>
                       </div>
                       <div class="calculation-row">
                           <span class="calculation-label">Quantidade de Pessoas:</span>
                           <span class="calculation-value" id="calcPessoas">0</span>
                       </div>
                   </div>
                   <div class="calculation-total">
                       VALOR TOTAL: ‚Ç¨<span id="calcTotal">0</span>
                   </div>
                   
                   <!-- Campos Admin (ocultos por padr√£o) -->
                   <div class="admin-fields" id="adminFields">
                       <div class="calculation-row">
                           <span class="calculation-label">Valor Gota d'√Ågua (30%):</span>
                           <span class="calculation-value" id="calcHotel">‚Ç¨0</span>
                       </div>
                       <div class="calculation-row">
                           <span class="calculation-label">Valor HUB Transfer:</span>
                           <span class="calculation-value" id="calcHUB">‚Ç¨0</span>
                       </div>
                       <div class="calculation-row">
                           <span class="calculation-label">Comiss√£o Recep√ß√£o:</span>
                           <span class="calculation-value" id="calcRecepcao">‚Ç¨0</span>
                       </div>
                   </div>
               </div>

               <!-- Form Actions -->
               <div class="form-actions">
                   <button type="submit" class="btn btn-primary" id="submitBtn">‚úÖ Solicitar Transfer</button>
                   <button type="button" class="btn btn-clear" id="clearFormBtn">üîÑ Limpar</button>
                   <button type="button" class="btn btn-export" id="exportBtn">üìä Exportar CSV</button>
                   <button type="button" class="btn btn-success" id="syncBtn" style="display: none;">üì§ Sincronizar Tudo</button>
                   <button type="button" class="btn btn-config" id="configBtn">‚öôÔ∏è Configurar</button>
                   <button type="button" class="btn btn-danger" id="clearDataBtn">üóëÔ∏è Limpar Dados</button>
               </div>
           </form>
       </section>

       <!-- Summary Section -->
       <section class="summary-section">
           <div class="summary-grid">
               <div class="summary-card">
                   <div class="summary-number" id="totalServices">0</div>
                   <div class="summary-label">Total de Servi√ßos</div>
               </div>
               <div class="summary-card">
                   <div class="summary-number" id="pendingServices">0</div>
                   <div class="summary-label">Solicitados</div>
               </div>
               <div class="summary-card">
                   <div class="summary-number" id="confirmedServices">0</div>
                   <div class="summary-label">Confirmados</div>
               </div>
               <div class="summary-card">
                   <div class="summary-number" id="completedServices">0</div>
                   <div class="summary-label">Finalizados</div>
               </div>
           </div>

           <div class="financial-summary">
               <h3>üí∞ Resumo Financeiro</h3>
               <div class="financial-grid">
                   <div class="financial-item">
                       <div class="financial-value" id="totalRevenue">‚Ç¨0.00</div>
                       <div class="financial-label">Receita Total</div>
                   </div>
                   <div class="financial-item">
                       <div class="financial-value" id="pendingRevenue">‚Ç¨0.00</div>
                       <div class="financial-label">Valor Pendente</div>
                   </div>
                   <div class="financial-item">
                       <div class="financial-value" id="confirmedRevenue">‚Ç¨0.00</div>
                       <div class="financial-label">Valor Confirmado</div>
                   </div>
                   <div class="financial-item">
                       <div class="financial-value" id="completedRevenue">‚Ç¨0.00</div>
                       <div class="financial-label">Valor Finalizado</div>
                   </div>
               </div>
           </div>
       </section>

       <!-- Services Table Section -->
       <section class="services-section">
           <div class="services-header">
               <h2 class="services-title">üìã Servi√ßos de Transfer</h2>
               <div class="filters">
                   <div class="filter-group">
                       <label for="filterStatus">Status:</label>
                       <select id="filterStatus">
                           <option value="">Todos</option>
                           <option value="Solicitado">Solicitado</option>
                           <option value="Confirmado">Confirmado</option>
                           <option value="Finalizado">Finalizado</option>
                           <option value="Cancelado">Cancelado</option>
                       </select>
                   </div>
                   <div class="filter-group">
                       <label for="filterData">Data:</label>
                       <input type="date" id="filterData">
                   </div>
                   <div class="filter-group">
                       <label for="searchClient">Cliente:</label>
                       <input type="text" id="searchClient" placeholder="Buscar...">
                   </div>
               </div>
           </div>

           <div class="services-table-container">
               <table id="servicesTable" class="services-table">
                   <thead>
                       <tr>
                           <th>ID</th>
                           <th>Cliente</th>
                           <th>Tipo</th>
                           <th>Pessoas</th>
                           <th>Bagagens</th>
                           <th>Data</th>
                           <th>Hora Pick-up</th>
                           <th>Contacto</th>
                           <th>Voo</th>
                           <th>Rota</th>
                           <th>Valor Total</th>
                           <th class="admin-column" style="display: none;">Valor Hotel</th>
                           <th class="admin-column" style="display: none;">Valor HUB</th>
                           <th class="admin-column" style="display: none;">Comiss√£o Recep√ß√£o</th>
                           <th>Pagamento</th>
                           <th>Pago Para</th>
                           <th>Status</th>
                           <th>A√ß√µes</th>
                       </tr>
                   </thead>
                   <tbody id="servicesTableBody">
                       <tr>
                           <td colspan="18" class="empty-state">
                               <h3>Nenhum servi√ßo cadastrado</h3>
                               <p>Adicione o primeiro transfer usando o formul√°rio acima</p>
                           </td>
                       </tr>
                   </tbody>
               </table>
           </div>
       </section>

</div>

   <!-- Admin Toggle -->
   <div id="adminToggle" class="admin-toggle">üîê Admin</div>

   <script>
       // =====================================================
       // GOTA D'√ÅGUA - SISTEMA DE TRANSFERS
       // JavaScript Completo e Modular
       // =====================================================

       // Configura√ß√£o Global
       const CONFIG = {
           WEBAPP_URL: 'https://script.google.com/macros/s/AKfycbxVnWXIVPXMs3e5qRzF8GDynOVg7OPodoi07QgJ40KHxDKVD_p0at1kNiNjm9WSX5o6Yg/exec',
           SPREADSHEET_ID: '1Zo0er2QaKszT3sYV8F0MZ50r3Pgj5gi50stqNrAnizY',
           ADMIN_PASSWORD: 'admin2025',
           TEST_EMAIL: 'juniorgutierezbega@gmail.com',
           
           TOURS: {
               'tour-sintra-cascais': { name: 'Sintra e Cascais (8h)', price: 67, type: 'regular' },
               'tour-fatima-obidos': { name: 'F√°tima e √ìbidos (8h)', price: 83, type: 'regular' },
               'tour-combo-2dias': { name: 'Combo 2 Dias (16h)', price: 138, type: 'regular' },
               'private-sintra-palaces': { name: 'Private Palaces of Sintra', priceSmall: 347, priceLarge: 492, type: 'private' },
               'private-evora': { name: 'Private √âvora City', priceSmall: 347, priceLarge: 492, type: 'private' },
               'private-templars': { name: 'Private Templars', priceSmall: 347, priceLarge: 492, type: 'private' },
               'private-arrabida': { name: 'Private Arr√°bida', priceSmall: 347, priceLarge: 492, type: 'private' }
           },

           STORAGE_KEYS: {
               SERVICES: 'gotaDaguaTransferData',
               CONFIG: 'gotaDaguaConfig',
               WEBAPP_URL: 'gotaDaguaWebappUrl'
           }
       };

       // Estado Global da Aplica√ß√£o
       class AppState {
           constructor() {
               this.services = [];
               this.editingId = null;
               this.phoneInput = null;
               this.isConnected = false;
               this.isAdminMode = false;
               this.currentServiceType = 'transfer';
               this.precoUnitarioAtual = 0;
               this.autocompleteOrigin = null;
               this.autocompleteDestination = null;
           }

           // M√©todos de gerenciamento de estado
           addService(service) {
               const newId = this.services.length > 0 ? Math.max(...this.services.map(s => s.id)) + 1 : 1;
               const newService = {
                   id: newId,
                   ...service,
                   created: new Date().toISOString()
               };
               this.services.push(newService);
               this.saveData();
               return newService;
           }

           updateService(id, updates) {
               const index = this.services.findIndex(s => s.id === id);
               if (index !== -1) {
                   this.services[index] = { ...this.services[index], ...updates };
                   this.saveData();
                   return this.services[index];
               }
               return null;
           }

           deleteService(id) {
               this.services = this.services.filter(s => s.id !== id);
               this.saveData();
           }

           getService(id) {
               return this.services.find(s => s.id === id);
           }

           clearAllServices() {
               this.services = [];
               this.saveData();
           }

           saveData() {
               try {
                   localStorage.setItem(CONFIG.STORAGE_KEYS.SERVICES, JSON.stringify(this.services));
                   console.log('‚úÖ Dados salvos no localStorage');
               } catch (error) {
                   console.error('‚ùå Erro ao salvar dados:', error);
                   showStatus('Erro ao salvar dados localmente', 'error');
               }
           }

           loadData() {
               try {
                   const savedData = localStorage.getItem(CONFIG.STORAGE_KEYS.SERVICES);
                   if (savedData) {
                       this.services = JSON.parse(savedData);
                       console.log(`üìÇ ${this.services.length} transfers carregados`);
                   }

                   const savedUrl = localStorage.getItem(CONFIG.STORAGE_KEYS.WEBAPP_URL);
                   if (savedUrl) {
                       document.getElementById('webappUrl').value = savedUrl;
                       this.isConnected = true;
                       document.getElementById('syncBtn').style.display = 'inline-block';
                   } else {
                       document.getElementById('webappUrl').value = CONFIG.WEBAPP_URL;
                       localStorage.setItem(CONFIG.STORAGE_KEYS.WEBAPP_URL, CONFIG.WEBAPP_URL);
                       this.isConnected = true;
                       document.getElementById('syncBtn').style.display = 'inline-block';
                   }
               } catch (error) {
                   console.error('‚ùå Erro ao carregar dados:', error);
                   this.services = [];
               }
           }
       }

       // Inst√¢ncia global do estado
       const app = new AppState();

       // =====================================================
       // SERVI√áOS DE INTEGRA√á√ÉO
       // =====================================================

       class GoogleSheetsService {
           static async testConnection() {
               const url = document.getElementById('webappUrl').value.trim() || CONFIG.WEBAPP_URL;
               
               if (!url) {
                   showStatus('Por favor, insira a URL do Google Apps Script!', 'error');
                   return false;
               }
               
               setButtonLoading('testConnectionBtn', true);
               
               try {
                   // Primeiro teste com GET
                   const response = await fetch(url + '?action=test', {
                       method: 'GET',
                       mode: 'cors'
                   });
                   
                   if (response.ok) {
                       const result = await response.json();
                       app.isConnected = true;
                       showStatus('‚úÖ Conex√£o funcionando!', 'success');
                       this.saveWebappUrl();
                       document.getElementById('syncBtn').style.display = 'inline-block';
                       return true;
                   } else {
                       throw new Error('Resposta n√£o OK');
                   }
                   
               } catch (error) {
                   // Fallback: testar com POST no-cors
                   try {
                       await fetch(url, {
                           method: 'POST',
                           headers: {
                               'Content-Type': 'text/plain',
                           },
                           body: JSON.stringify({ action: 'test' }),
                           mode: 'no-cors'
                       });
                       
                       app.isConnected = true;
                       showStatus('‚úÖ Conex√£o estabelecida (modo limitado)', 'success');
                       this.saveWebappUrl();
                       document.getElementById('syncBtn').style.display = 'inline-block';
                       return true;
                       
                   } catch (fallbackError) {
                       showStatus('‚ùå Erro ao conectar. Verifique a URL e o deploy', 'error');
                       app.isConnected = false;
                       return false;
                   }
               } finally {
                   setButtonLoading('testConnectionBtn', false);
               }
           }

           static async sendToSheets(serviceData) {
               const url = document.getElementById('webappUrl').value.trim() || 
                          localStorage.getItem(CONFIG.STORAGE_KEYS.WEBAPP_URL) || 
                          CONFIG.WEBAPP_URL;
               
               if (!url) {
                   console.log('‚ùå URL n√£o configurada');
                   return false;
               }
               
               try {
                   console.log('üì§ Enviando dados para Sheets:', serviceData);
                   
                   const dataWithEmail = {
                       ...serviceData,
                       emailDestino: CONFIG.TEST_EMAIL
                   };
                   
                   const response = await fetch(url, {
                       method: 'POST',
                       headers: {
                           'Content-Type': 'text/plain',
                       },
                       body: JSON.stringify(dataWithEmail),
                       mode: 'no-cors'
                   });
                   
                   console.log('‚úÖ Requisi√ß√£o enviada para:', CONFIG.TEST_EMAIL);
                   
                   // Verificar status
                   try {
                       const checkResponse = await fetch(url + '?action=test', {
                           method: 'GET',
                           mode: 'cors'
                       });
                       
                       if (checkResponse.ok) {
                           const result = await checkResponse.json();
                           console.log('üì® Resposta do Sheets:', result);
                           return true;
                       }
                   } catch (e) {
                       // Ignorar erro de verifica√ß√£o
                   }
                   
                   return true;
                   
               } catch (error) {
                   console.error('‚ùå Erro ao enviar para Google Sheets:', error);
                   showStatus('‚ùå Erro de conex√£o com Google Sheets', 'error');
                   return false;
               }
           }

           static async syncAllToSheets() {
               const url = document.getElementById('webappUrl').value.trim() || 
                          localStorage.getItem(CONFIG.STORAGE_KEYS.WEBAPP_URL) || 
                          CONFIG.WEBAPP_URL;
               
               if (!url) {
                   showStatus('Configure a URL do Google Apps Script primeiro!', 'error');
                   return;
               }
               
               if (app.services.length === 0) {
                   showStatus('N√£o h√° dados para sincronizar!', 'warning');
                   return;
               }
               
               setButtonLoading('syncBtn', true);
               let successCount = 0;
               
               try {
                   for (const service of app.services) {
                       const success = await this.sendToSheets(service);
                       if (success) successCount++;
                       
                       await new Promise(resolve => setTimeout(resolve, 200));
                   }
                   
                   showStatus(`Sincroniza√ß√£o conclu√≠da! ${successCount}/${app.services.length} registros enviados.`, 'success');
               } catch (error) {
                   showStatus('Erro durante sincroniza√ß√£o: ' + error.message, 'error');
               } finally {
                   setButtonLoading('syncBtn', false);
               }
           }

           static async clearAllData() {
               const confirmText = prompt('‚ö†Ô∏è ATEN√á√ÉO: Esta a√ß√£o ir√° apagar TODOS os dados!\n\nDigite "CONFIRMAR" para continuar:');
               
               if (confirmText !== 'CONFIRMAR') {
                   showStatus('Opera√ß√£o cancelada pelo usu√°rio.', 'warning');
                   return;
               }

               setButtonLoading('clearAllDataBtn', true);
               
               try {
                   const url = document.getElementById('webappUrl').value.trim() || 
                              localStorage.getItem(CONFIG.STORAGE_KEYS.WEBAPP_URL) || 
                              CONFIG.WEBAPP_URL;
                   
                   if (url) {
                       const response = await fetch(url, {
                           method: 'POST',
                           headers: {
                               'Content-Type': 'application/json',
                           },
                           body: JSON.stringify({
                               action: 'clearAllData',
                               timestamp: new Date().toISOString()
                           }),
                           mode: 'cors'
                       });
                       
                       const result = await response.json();
                       if (result.status === 'success') {
                           showStatus('‚úÖ Dados limpos no Google Sheets com sucesso!', 'success');
                       } else {
                           showStatus('‚ö†Ô∏è Erro ao limpar dados no Google Sheets: ' + result.message, 'warning');
                       }
                   } else {
                       showStatus('‚ö†Ô∏è URL n√£o configurada - apenas dados locais ser√£o limpos', 'warning');
                   }
                   
                   app.clearAllServices();
                   renderTable();
                   updateSummary();
                   
                   showStatus('üóëÔ∏è Todos os dados foram limpos com sucesso!', 'success');
                   
                   setTimeout(() => {
                       toggleSection('clearDataSection');
                   }, 2000);
                   
               } catch (error) {
                   console.error('Erro ao limpar dados:', error);
                   
                   app.clearAllServices();
                   renderTable();
                   updateSummary();
                   
                   showStatus('üóëÔ∏è Dados locais limpos. Erro ao conectar com Google Sheets.', 'warning');
               } finally {
                   setButtonLoading('clearAllDataBtn', false);
               }
           }

           static async clearTestData() {
               const confirmText = prompt('Limpar apenas registros de teste?\n\nDigite "TESTE" para confirmar:');
               
               if (confirmText !== 'TESTE') {
                   showStatus('Opera√ß√£o cancelada pelo usu√°rio.', 'warning');
                   return;
               }

               setButtonLoading('clearTestDataBtn', true);
               
               try {
                   const url = document.getElementById('webappUrl').value.trim() || 
                              localStorage.getItem(CONFIG.STORAGE_KEYS.WEBAPP_URL) || 
                              CONFIG.WEBAPP_URL;
                   
                   if (url) {
                       const response = await fetch(url, {
                           method: 'POST',
                           headers: {
                               'Content-Type': 'application/json',
                           },
                           body: JSON.stringify({
                               action: 'clearTestData',
                               timestamp: new Date().toISOString()
                           }),
                           mode: 'cors'
                       });
                       
                       const result = await response.json();
                       if (result.status === 'success') {
                           showStatus('‚úÖ Dados de teste limpos no Google Sheets!', 'success');
                       } else {
                           showStatus('‚ö†Ô∏è Erro ao limpar dados de teste no Google Sheets: ' + result.message, 'warning');
                       }
                   }
                   
                   const originalLength = app.services.length;
                   app.services = app.services.filter(service => 
                       !service.nomeCliente.toUpperCase().includes('TESTE') &&
                       !service.nomeCliente.toUpperCase().includes('TEST')
                   );
                   
                   const removedCount = originalLength - app.services.length;
                   
                   if (removedCount > 0) {
                       app.saveData();
                       renderTable();
                       updateSummary();
                       showStatus(`üßπ ${removedCount} registros de teste removidos!`, 'success');
                   } else {
                       showStatus('‚ÑπÔ∏è Nenhum registro de teste encontrado.', 'warning');
                   }
                   
                   setTimeout(() => {
                       toggleSection('clearDataSection');
                   }, 2000);
                   
               } catch (error) {
                   console.error('Erro ao limpar dados de teste:', error);
                   showStatus('‚ùå Erro ao limpar dados de teste: ' + error.message, 'error');
               } finally {
                   setButtonLoading('clearTestDataBtn', false);
               }
           }

           static saveWebappUrl() {
               const url = document.getElementById('webappUrl').value.trim() || CONFIG.WEBAPP_URL;
               if (url) {
                   localStorage.setItem(CONFIG.STORAGE_KEYS.WEBAPP_URL, url);
                   document.getElementById('syncBtn').style.display = 'inline-block';
                   app.isConnected = true;
               }
           }
       }

       class GoogleMapsService {
           static initialize() {
               if (typeof google !== 'undefined' && google.maps && google.maps.places) {
                   try {
                       const origemInput = document.getElementById('origem');
                       app.autocompleteOrigin = new google.maps.places.Autocomplete(origemInput, {
                           types: ['establishment', 'geocode'],
                           componentRestrictions: { country: 'pt' }
                       });

                       const destinoInput = document.getElementById('destino');
                       app.autocompleteDestination = new google.maps.places.Autocomplete(destinoInput, {
                           types: ['establishment', 'geocode'],
                           componentRestrictions: { country: 'pt' }
                       });

                       origemInput.addEventListener('input', function() {
                           document.querySelectorAll('.origem-btn').forEach(btn => btn.classList.remove('active'));
                       });

                       destinoInput.addEventListener('input', function() {
                           document.querySelectorAll('.destino-btn').forEach(btn => btn.classList.remove('active'));
                       });
                       
                       console.log('üìç Google Maps Autocomplete inicializado');
                       
                   } catch (error) {
                       console.error('Erro ao inicializar Google Maps:', error);
                       this.initializeFallback();
                   }
               } else {
                   setTimeout(() => this.initialize(), 2000);
               }
           }

           static initializeFallback() {
               console.log('üîÑ Inicializando sistema de sugest√µes local');
               
               const commonLocations = [
                   'Aeroporto de Lisboa',
                   'Gota d\'√Ågua',
                   'Lisboa Centro',
                   'Cascais',
                   'Sintra',
                   '√ìbidos',
                   'F√°tima',
                   'Terminal de Cruzeiros',
                   'Esta√ß√£o do Oriente'
               ];

               this.setupLocalAutocomplete('origem', commonLocations);
               this.setupLocalAutocomplete('destino', commonLocations);
           }

           static setupLocalAutocomplete(inputId, suggestions) {
               const input = document.getElementById(inputId);
               const datalist = document.createElement('datalist');
               datalist.id = inputId + '-suggestions';
               
               suggestions.forEach(location => {
                   const option = document.createElement('option');
                   option.value = location;
                   datalist.appendChild(option);
               });
               
               input.setAttribute('list', datalist.id);
               input.parentNode.appendChild(datalist);
           }
       }

       class PhoneInputService {
           static initialize() {
               const phoneInputElement = document.getElementById('contacto');
               
               if (window.intlTelInput) {
                   app.phoneInput = window.intlTelInput(phoneInputElement, {
                       initialCountry: "pt",
                       preferredCountries: ["pt", "es", "fr", "de", "br", "us", "gb"],
                       separateDialCode: true,
                       autoHideDialCode: false,
                       nationalMode: false,
                       formatOnDisplay: true,
                       utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/utils.js"
                   });

                   phoneInputElement.addEventListener('input', function() {
                       const number = phoneInputElement.value;
                       if (number.startsWith('+')) {
                           const countryCode = PhoneInputService.detectCountryFromNumber(number);
                           if (countryCode && app.phoneInput) {
                               app.phoneInput.setCountry(countryCode);
                           }
                       }
                   });

                   phoneInputElement.addEventListener('blur', function() {
                       if (app.phoneInput && app.phoneInput.isValidNumber()) {
                           phoneInputElement.value = app.phoneInput.getNumber();
                       }
                   });

                   console.log('üìû Phone Input inicializado');
               } else {
                   setTimeout(() => this.initialize(), 1000);
               }
           }

           static detectCountryFromNumber(number) {
               const countryCodesMap = {
                   '+351': 'pt', '+34': 'es', '+33': 'fr', '+49': 'de', '+55': 'br',
                   '+1': 'us', '+44': 'gb', '+39': 'it', '+31': 'nl', '+32': 'be',
                   '+41': 'ch', '+43': 'at', '+45': 'dk', '+46': 'se', '+47': 'no'
               };

               for (let i = 4; i >= 2; i--) {
                   const code = number.substring(0, i);
                   if (countryCodesMap[code]) {
                       return countryCodesMap[code];
                   }
               }
               return null;
           }

           static getFormattedNumber() {
               if (app.phoneInput && app.phoneInput.isValidNumber()) {
                   return app.phoneInput.getNumber();
               }
               return document.getElementById('contacto').value;
           }
       }

       // =====================================================
       // COMPONENTES DE INTERFACE
       // =====================================================

       class ServiceSelector {
           static initialize() {
               document.querySelectorAll('.btn-service').forEach(btn => {
                   btn.addEventListener('click', (e) => {
                       e.preventDefault();
                       const serviceType = btn.dataset.service;
                       this.setServiceType(serviceType);
                   });
               });

               document.getElementById('tourSelecionado').addEventListener('change', () => {
                   this.updateTourPrice();
               });
           }

           static setServiceType(type) {
               app.currentServiceType = type;
               
               // Atualizar bot√µes
               document.querySelectorAll('.btn-service').forEach(btn => btn.classList.remove('active'));
               document.querySelector(`[data-service="${type}"]`).classList.add('active');
               
               // Mostrar/ocultar seletor de tours
               const tourSelector = document.getElementById('tourSelectorGroup');
               if (type === 'tour' || type === 'private') {
                   tourSelector.style.display = 'block';
               } else {
                   tourSelector.style.display = 'none';
                   document.getElementById('tourSelecionado').value = '';
               }
               
               // Atualizar c√°lculo
               PriceCalculator.updateCalculation();
           }

           static updateTourPrice() {
               const tourSelect = document.getElementById('tourSelecionado');
               const selectedOption = tourSelect.options[tourSelect.selectedIndex];
               
               if (!selectedOption || !selectedOption.value) {
                   app.precoUnitarioAtual = 0;
                   PriceCalculator.updateCalculation();
                   return;
               }
               
               const tourData = CONFIG.TOURS[selectedOption.value];
               const pessoas = parseInt(document.getElementById('numeroPessoas').value) || 1;
               
               if (tourData.type === 'regular') {
                   app.precoUnitarioAtual = tourData.price;
                   const valorTotal = app.precoUnitarioAtual * pessoas;
                   document.getElementById('valorTotal').value = valorTotal.toFixed(2);
               } else if (tourData.type === 'private') {
                   app.precoUnitarioAtual = pessoas <= 3 ? tourData.priceSmall : tourData.priceLarge;
                   document.getElementById('valorTotal').value = app.precoUnitarioAtual.toFixed(2);
               }
               
               PriceCalculator.updateCalculation();
           }
       }

       class PriceCalculator {
           static initialize() {
               document.getElementById('valorTotal').addEventListener('input', () => {
                   this.updateCalculation();
               });
           }

           static updateCalculation() {
               const pessoas = parseInt(document.getElementById('numeroPessoas').value) || 0;
               let valorTotal = 0;
               let valorHotel = 0;
               let valorHUB = 0;
               let comissaoRecepcao = 0;
               
               const calcBox = document.getElementById('priceCalculationBox');
               
               if (app.currentServiceType === 'tour' || app.currentServiceType === 'private') {
                   calcBox.classList.add('show');
                   
                   document.getElementById('calcTipoServico').textContent = 
                       app.currentServiceType === 'tour' ? 'Tour Regular' : 'Private Tour';
                   document.getElementById('calcPrecoUnitario').textContent = `‚Ç¨${app.precoUnitarioAtual}`;
                   document.getElementById('calcPessoas').textContent = pessoas;
                   
                   if (app.currentServiceType === 'tour') {
                       valorTotal = app.precoUnitarioAtual * pessoas;
                       valorHotel = valorTotal * 0.30;
                       comissaoRecepcao = 5.00;
                   } else if (app.currentServiceType === 'private') {
                       valorTotal = app.precoUnitarioAtual;
                       valorHotel = valorTotal * 0.30;
                       comissaoRecepcao = 5.00;
                   }
               } else {
                   calcBox.classList.remove('show');
                   valorTotal = parseFloat(document.getElementById('valorTotal').value) || 0;
                   valorHotel = valorTotal * 0.30;
                   comissaoRecepcao = 2.00;
               }
               
               valorHUB = valorTotal - valorHotel - comissaoRecepcao;
               
               document.getElementById('calcTotal').textContent = valorTotal.toFixed(2);
               document.getElementById('calcHotel').textContent = `‚Ç¨${valorHotel.toFixed(2)}`;
               document.getElementById('calcHUB').textContent = `‚Ç¨${valorHUB.toFixed(2)}`;
               document.getElementById('calcRecepcao').textContent = `‚Ç¨${comissaoRecepcao.toFixed(2)}`;
               
               if (app.currentServiceType !== 'transfer') {
                   document.getElementById('valorTotal').value = valorTotal.toFixed(2);
               }
           }
       }

       class FormControls {
           static initialize() {
               this.setupPeopleButtons();
               this.setupBaggageButtons();
               this.setupDateButtons();
               this.setupTimeButtons();
               this.setupLocationButtons();
               this.setupPriceButtons();
               this.setupPaymentButtons();
               this.setupPaymentToButtons();
               this.setupObservationButtons();
           }

           static setupPeopleButtons() {
               document.querySelectorAll('.btn-people').forEach(btn => {
                   btn.addEventListener('click', (e) => {
                       e.preventDefault();
                       const people = parseInt(btn.dataset.people);
                       this.setPeople(people);
                   });
               });
           }

           static setPeople(number) {
               document.getElementById('numeroPessoas').value = number;
               document.querySelectorAll('.btn-people').forEach(btn => btn.classList.remove('active'));
               document.querySelector(`[data-people="${number}"]`).classList.add('active');
               PriceCalculator.updateCalculation();
               ServiceSelector.updateTourPrice();
           }

           static setupBaggageButtons() {
               document.querySelectorAll('.btn-baggage').forEach(btn => {
                   btn.addEventListener('click', (e) => {
                       e.preventDefault();
                       const baggage = parseInt(btn.dataset.baggage);
                       this.setBaggage(baggage);
                   });
               });
           }

           static setBaggage(number) {
               document.getElementById('numeroBagagens').value = number;
               document.querySelectorAll('.btn-baggage').forEach(btn => btn.classList.remove('active'));
               document.querySelector(`[data-baggage="${number}"]`).classList.add('active');
           }

           static setupDateButtons() {
               document.querySelectorAll('.btn-date').forEach(btn => {
                   btn.addEventListener('click', (e) => {
                       e.preventDefault();
                       const dateType = btn.dataset.date;
                       this.setDate(dateType);
                   });
               });
           }

           static setDate(option) {
               const dateInput = document.getElementById('data');
               const today = new Date();
               
               document.querySelectorAll('.btn-date').forEach(btn => btn.classList.remove('active'));
               
               if (option === 'today') {
                   dateInput.valueAsDate = today;
                   document.querySelector('[data-date="today"]').classList.add('active');
               } else if (option === 'tomorrow') {
                   const tomorrow = new Date(today);
                   tomorrow.setDate(tomorrow.getDate() + 1);
                   dateInput.valueAsDate = tomorrow;
                   document.querySelector('[data-date="tomorrow"]').classList.add('active');
               }
           }

           static setupTimeButtons() {
               document.querySelectorAll('.btn-time').forEach(btn => {
                   btn.addEventListener('click', (e) => {
                       e.preventDefault();
                       const time = btn.dataset.time;
                       this.setTime(time);
                   });
               });
           }

           static setTime(time) {
               document.getElementById('horaPickup').value = time;
               document.querySelectorAll('.btn-time').forEach(btn => btn.classList.remove('active'));
               document.querySelector(`[data-time="${time}"]`).classList.add('active');
           }

           static setupLocationButtons() {
               document.querySelectorAll('.btn-location').forEach(btn => {
                   btn.addEventListener('click', (e) => {
                       e.preventDefault();
                       const location = btn.dataset.location;
                       const isOrigin = btn.classList.contains('origem-btn');
                       this.setLocation(location, isOrigin);
                   });
               });
           }

           static setLocation(location, isOrigin) {
               if (isOrigin) {
                   document.getElementById('origem').value = location;
                   document.querySelectorAll('.origem-btn').forEach(btn => btn.classList.remove('active'));
                   document.querySelector(`.origem-btn[data-location="${location}"]`).classList.add('active');
               } else {
                   document.getElementById('destino').value = location;
                   document.querySelectorAll('.destino-btn').forEach(btn => btn.classList.remove('active'));
                   document.querySelector(`.destino-btn[data-location="${location}"]`).classList.add('active');
               }
           }

           static setupPriceButtons() {
               document.querySelectorAll('.btn-price').forEach(btn => {
                   btn.addEventListener('click', (e) => {
                       e.preventDefault();
                       const price = parseFloat(btn.dataset.price);
                       this.setPrice(price);
                   });
               });
           }

           static setPrice(price) {
               document.getElementById('valorTotal').value = price;
               document.querySelectorAll('.btn-price').forEach(btn => btn.classList.remove('active'));
               document.querySelector(`[data-price="${price}"]`).classList.add('active');
               PriceCalculator.updateCalculation();
           }

static setupPaymentButtons() {
               document.querySelectorAll('.btn-payment').forEach(btn => {
                   btn.addEventListener('click', (e) => {
                       e.preventDefault();
                       const payment = btn.dataset.payment;
                       this.setPayment(payment);
                   });
               });
           }

           static setPayment(method) {
               document.getElementById('modoPagamento').value = method;
               document.querySelectorAll('.btn-payment').forEach(btn => btn.classList.remove('active'));
               document.querySelector(`[data-payment="${method}"]`).classList.add('active');
           }

           static setupPaymentToButtons() {
               document.querySelectorAll('.btn-payment-to').forEach(btn => {
                   btn.addEventListener('click', (e) => {
                       e.preventDefault();
                       const paymentTo = btn.dataset.paymentTo;
                       this.setPaymentTo(paymentTo);
                   });
               });
           }

           static setPaymentTo(recipient) {
               document.getElementById('pagoParaQuem').value = recipient;
               document.querySelectorAll('.btn-payment-to').forEach(btn => btn.classList.remove('active'));
               document.querySelector(`[data-payment-to="${recipient}"]`).classList.add('active');
           }

           static setupObservationButtons() {
               document.querySelectorAll('.btn-obs').forEach(btn => {
                   btn.addEventListener('click', (e) => {
                       e.preventDefault();
                       const obs = btn.dataset.obs;
                       this.addObservation(obs);
                   });
               });
           }

           static addObservation(text) {
               const obsInput = document.getElementById('observacoes');
               const currentText = obsInput.value;
               
               if (currentText === '') {
                   obsInput.value = text;
               } else {
                   obsInput.value = currentText + '; ' + text;
               }
               
               // Visual feedback
               event.target.classList.add('active');
               setTimeout(() => {
                   event.target.classList.remove('active');
               }, 1000);
           }
       }

       class TransferTable {
           static initialize() {
               this.setupFilters();
           }

           static setupFilters() {
               document.getElementById('filterStatus').addEventListener('change', () => {
                   this.filterTable();
               });

               document.getElementById('filterData').addEventListener('change', () => {
                   this.filterTable();
               });

               document.getElementById('searchClient').addEventListener('keyup', () => {
                   this.filterTable();
               });
           }

           static filterTable() {
               const statusFilter = document.getElementById('filterStatus').value;
               const dataFilter = document.getElementById('filterData').value;
               const clientFilter = document.getElementById('searchClient').value.toLowerCase();

               const tbody = document.getElementById('servicesTableBody');
               const rows = tbody.getElementsByTagName('tr');

               let visibleCount = 0;

               for (let row of rows) {
                   if (row.cells.length < 14) continue;
                   
                   let showRow = true;

                   if (statusFilter && !row.textContent.includes(statusFilter)) {
                       showRow = false;
                   }

                   if (dataFilter) {
                       const rowDate = row.cells[5].textContent;
                       const filterDate = formatDate(dataFilter);
                       if (!rowDate.includes(filterDate)) {
                           showRow = false;
                       }
                   }

                   if (clientFilter && !row.cells[1].textContent.toLowerCase().includes(clientFilter)) {
                       showRow = false;
                   }

                   row.style.display = showRow ? '' : 'none';
                   if (showRow) visibleCount++;
               }

               this.updateFilterResults(visibleCount);
           }

           static updateFilterResults(count) {
               let existingCounter = document.getElementById('filterCounter');
               if (!existingCounter) {
                   existingCounter = document.createElement('div');
                   existingCounter.id = 'filterCounter';
                   existingCounter.style.cssText = 'text-align: center; padding: 10px; color: #7f8c8d; font-style: italic;';
                   document.querySelector('.services-table-container').insertBefore(existingCounter, document.querySelector('.services-table'));
               }
               
               if (count === app.services.length) {
                   existingCounter.textContent = '';
               } else {
                   existingCounter.textContent = `Mostrando ${count} de ${app.services.length} transfers`;
               }
           }

           static render() {
               renderTable();
           }
       }

       // =====================================================
       // FUN√á√ïES DE INTERFACE E UTILIT√ÅRIOS
       // =====================================================

       function showStatus(message, type = 'success') {
           // Remove mensagens existentes
           const existingMessages = document.querySelectorAll('.status-message');
           existingMessages.forEach(msg => msg.remove());

           const statusDiv = document.createElement('div');
           statusDiv.className = `status-message status-${type}`;
           statusDiv.textContent = message;
           statusDiv.style.display = 'block';
           
           const container = document.getElementById('statusContainer');
           container.appendChild(statusDiv);
           
           setTimeout(() => {
               statusDiv.remove();
           }, 5000);
       }

       function setButtonLoading(buttonId, loading = true) {
           const button = document.getElementById(buttonId);
           if (!button) return;
           
           if (loading) {
               button.disabled = true;
               button.classList.add('loading');
               button.setAttribute('data-original-text', button.textContent);
               button.textContent = '';
           } else {
               button.disabled = false;
               button.classList.remove('loading');
               const originalText = button.getAttribute('data-original-text');
               if (originalText) {
                   button.textContent = originalText;
                   button.removeAttribute('data-original-text');
               }
           }
       }

       function toggleSection(sectionId) {
           const section = document.getElementById(sectionId);
           section.classList.toggle('show');
       }

       function toggleAdminMode() {
           const senha = prompt('Digite a senha de administrador:');
           if (senha === CONFIG.ADMIN_PASSWORD) {
               app.isAdminMode = !app.isAdminMode;
               
               document.getElementById('adminFields').classList.toggle('show');
               
               document.querySelectorAll('.admin-column').forEach(col => {
                   col.style.display = app.isAdminMode ? 'table-cell' : 'none';
               });
               
               showStatus(app.isAdminMode ? 'Modo Admin Ativado' : 'Modo Admin Desativado', 'success');
           } else if (senha !== null) {
               showStatus('Senha incorreta!', 'error');
           }
       }

       function formatDate(dateString) {
           const date = new Date(dateString);
           return date.toLocaleDateString('pt-PT', {
               day: '2-digit',
               month: '2-digit',
               year: 'numeric'
           });
       }

       function renderTable() {
           const tbody = document.getElementById('servicesTableBody');
           tbody.innerHTML = '';

           if (app.services.length === 0) {
               tbody.innerHTML = `
                   <tr>
                       <td colspan="18" class="empty-state">
                           <h3>Nenhum servi√ßo cadastrado</h3>
                           <p>Adicione o primeiro transfer usando o formul√°rio acima</p>
                       </td>
                   </tr>
               `;
               return;
           }

           const sortedServices = app.services.sort((a, b) => {
               const dateA = new Date(a.data + ' ' + a.horaPickup);
               const dateB = new Date(b.data + ' ' + b.horaPickup);
               return dateB - dateA;
           });

           sortedServices.forEach(service => {
               const row = document.createElement('tr');
               const paymentClass = service.modoPagamento.toLowerCase().includes('dinheiro') ? 'payment-cash' : 
                               service.modoPagamento.toLowerCase().includes('cart√£o') ? 'payment-card' : 'payment-transfer';
               
               const tipoServico = service.tipoServico || 'Transfer';
               const tipoLabel = tipoServico === 'tour' ? 'üöê Tour' : 
                                tipoServico === 'private' ? 'üöó Private' : 
                                'üöï Transfer';
               
               row.innerHTML = `
                   <td><strong>#${service.id}</strong></td>
                   <td>
                       <div class="client-info">${service.nomeCliente}</div>
                       <div style="font-size: 0.8rem; color: #7f8c8d;">${service.contacto}</div>
                   </td>
                   <td>${tipoLabel}</td>
                   <td>
                       <span style="background: #9b59b6; color: white; padding: 4px 8px; border-radius: 12px; font-weight: 600;">
                           üë• ${service.numeroPessoas}
                       </span>
                   </td>
                   <td>
                       <span style="background: #e67e22; color: white; padding: 4px 8px; border-radius: 12px; font-weight: 600;">
                           üß≥ ${service.numeroBagagens}
                       </span>
                   </td>
                   <td><strong>${formatDate(service.data)}</strong></td>
                   <td>
                       <div style="font-weight: 600; color: #2c3e50; font-size: 1.1rem;">
                           ${service.horaPickup}
                       </div>
                   </td>
                   <td>${service.contacto}</td>
                   <td>${service.numeroVoo || '-'}</td>
                   <td>
                       <div style="font-size: 0.9rem;">
                           <div><strong>De:</strong> ${service.origem}</div>
                           <div><strong>Para:</strong> ${service.destino}</div>
                       </div>
                   </td>
                   <td><span class="value-highlight">‚Ç¨${service.valorTotal.toFixed(2)}</span></td>
                   <td class="admin-column" style="display: ${app.isAdminMode ? 'table-cell' : 'none'};">
                       ‚Ç¨${(service.valorHotel || 0).toFixed(2)}
                   </td>
                   <td class="admin-column" style="display: ${app.isAdminMode ? 'table-cell' : 'none'};">
                       ‚Ç¨${(service.valorHUB || 0).toFixed(2)}
                   </td>
                   <td class="admin-column" style="display: ${app.isAdminMode ? 'table-cell' : 'none'};">
                       ‚Ç¨${(service.comissaoRecepcao || 0).toFixed(2)}
                   </td>
                   <td><span class="payment-method ${paymentClass}">${service.modoPagamento}</span></td>
                   <td>
                       <span class="pago-para ${service.pagoParaQuem === 'Recep√ß√£o' ? 'pago-recepcao' : 'pago-motorista'}">
                           ${service.pagoParaQuem}
                       </span>
                   </td>
                   <td><span class="status status-${service.status.toLowerCase()}">${service.status}</span></td>
                   <td>
                       <div class="action-buttons">
                           <button class="btn btn-small btn-primary" onclick="editService(${service.id})" title="Editar">‚úèÔ∏è</button>
                           <button class="btn btn-small btn-success" onclick="changeStatus(${service.id})" title="Alterar Status">üîÑ</button>
                           <button class="btn btn-small btn-export" onclick="deleteService(${service.id})" title="Excluir">üóëÔ∏è</button>
                       </div>
                   </td>
               `;
               tbody.appendChild(row);
           });
       }

       function updateSummary() {
           const total = app.services.length;
           const pending = app.services.filter(s => s.status === 'Solicitado').length;
           const confirmed = app.services.filter(s => s.status === 'Confirmado').length;
           const completed = app.services.filter(s => s.status === 'Finalizado').length;

           const totalRevenue = app.services.reduce((sum, s) => sum + (s.valorTotal || 0), 0);
           const pendingRevenue = app.services.filter(s => s.status === 'Solicitado').reduce((sum, s) => sum + (s.valorTotal || 0), 0);
           const confirmedRevenue = app.services.filter(s => s.status === 'Confirmado').reduce((sum, s) => sum + (s.valorTotal || 0), 0);
           const completedRevenue = app.services.filter(s => s.status === 'Finalizado').reduce((sum, s) => sum + (s.valorTotal || 0), 0);

           document.getElementById('totalServices').textContent = total;
           document.getElementById('pendingServices').textContent = pending;
           document.getElementById('confirmedServices').textContent = confirmed;
           document.getElementById('completedServices').textContent = completed;

           document.getElementById('totalRevenue').textContent = `‚Ç¨${totalRevenue.toFixed(2)}`;
           document.getElementById('pendingRevenue').textContent = `‚Ç¨${pendingRevenue.toFixed(2)}`;
           document.getElementById('confirmedRevenue').textContent = `‚Ç¨${confirmedRevenue.toFixed(2)}`;
           document.getElementById('completedRevenue').textContent = `‚Ç¨${completedRevenue.toFixed(2)}`;
       }

       // =====================================================
       // MANIPULA√á√ÉO DE SERVI√áOS
       // =====================================================

       function editService(id) {
           const service = app.getService(id);
           if (!service) {
               showStatus('Servi√ßo n√£o encontrado', 'error');
               return;
           }

           try {
               // Preencher campos b√°sicos
               document.getElementById('nomeCliente').value = service.nomeCliente;
               document.getElementById('numeroPessoas').value = service.numeroPessoas;
               document.getElementById('numeroBagagens').value = service.numeroBagagens;
               document.getElementById('data').value = service.data;
               document.getElementById('numeroVoo').value = service.numeroVoo || '';
               document.getElementById('origem').value = service.origem;
               document.getElementById('destino').value = service.destino;
               document.getElementById('horaPickup').value = service.horaPickup;
               document.getElementById('valorTotal').value = service.valorTotal;
               document.getElementById('modoPagamento').value = service.modoPagamento;
               document.getElementById('pagoParaQuem').value = service.pagoParaQuem;
               document.getElementById('observacoes').value = service.observacoes || '';
               
               // Restaurar tipo de servi√ßo
               if (service.tipoServico) {
                   ServiceSelector.setServiceType(service.tipoServico);
                   
                   if (service.tourSelecionado) {
                       document.getElementById('tourSelectorGroup').style.display = 'block';
                       document.getElementById('tourSelecionado').value = service.tourSelecionado;
                   }
               }
               
               // Restaurar telefone
               if (app.phoneInput) {
                   app.phoneInput.setNumber(service.contacto);
               } else {
                   document.getElementById('contacto').value = service.contacto;
               }
               
               // Atualizar bot√µes ativos
               updateActiveButtons(service);
               PriceCalculator.updateCalculation();
               
               app.editingId = id;
               document.getElementById('submitBtn').textContent = '‚úèÔ∏è Atualizar Transfer';
               
               document.querySelector('.transfer-form-section').scrollIntoView({ 
                   behavior: 'smooth',
                   block: 'start'
               });
               
               showStatus('Editando transfer #' + id, 'success');
               
           } catch (error) {
               console.error('Erro ao editar servi√ßo:', error);
               showStatus('Erro ao carregar dados para edi√ß√£o', 'error');
           }
       }

       function updateActiveButtons(service) {
           // Pessoas
           document.querySelectorAll('.btn-people').forEach(btn => {
               if (btn.dataset.people == service.numeroPessoas) {
                   btn.classList.add('active');
               }
           });
           
           // Bagagens
           document.querySelectorAll('.btn-baggage').forEach(btn => {
               if (btn.dataset.baggage == service.numeroBagagens) {
                   btn.classList.add('active');
               }
           });
           
           // Pre√ßo
           document.querySelectorAll('.btn-price').forEach(btn => {
               if (btn.dataset.price == service.valorTotal) {
                   btn.classList.add('active');
               }
           });
           
           // Pagamento
           document.querySelectorAll('.btn-payment').forEach(btn => {
               if (btn.dataset.payment === service.modoPagamento) {
                   btn.classList.add('active');
               }
           });
           
           // Pago para
           document.querySelectorAll('.btn-payment-to').forEach(btn => {
               if (btn.dataset.paymentTo === service.pagoParaQuem) {
                   btn.classList.add('active');
               }
           });
       }

       async function changeStatus(id) {
           const service = app.getService(id);
           if (!service) {
               showStatus('Servi√ßo n√£o encontrado', 'error');
               return;
           }

           const statuses = ['Solicitado', 'Confirmado', 'Finalizado', 'Cancelado'];
           const currentIndex = statuses.indexOf(service.status);
           const nextIndex = (currentIndex + 1) % statuses.length;
           
           const updatedService = app.updateService(id, { status: statuses[nextIndex] });
           
           try {
               renderTable();
               updateSummary();
               
               if (app.isConnected) {
                   await GoogleSheetsService.sendToSheets(updatedService);
                   showStatus(`Status alterado para: ${updatedService.status}`, 'success');
               } else {
                   showStatus(`Status alterado para: ${updatedService.status} (apenas local)`, 'warning');
               }
               
           } catch (error) {
               console.error('Erro ao alterar status:', error);
               showStatus('Erro ao alterar status', 'error');
           }
       }

       function deleteService(id) {
           if (!confirm('Tem certeza que deseja deletar este servi√ßo?')) {
               return;
           }

           try {
               app.deleteService(id);
               renderTable();
               updateSummary();
               showStatus('Transfer deletado com sucesso', 'success');
               
           } catch (error) {
               console.error('Erro ao deletar servi√ßo:', error);
               showStatus('Erro ao deletar transfer', 'error');
           }
       }

       function clearForm() {
           try {
               document.getElementById('transferForm').reset();
               
               // Limpar campos espec√≠ficos
               document.getElementById('numeroPessoas').value = '';
               document.getElementById('numeroBagagens').value = '0';
               document.getElementById('modoPagamento').value = '';
               document.getElementById('pagoParaQuem').value = '';
               document.getElementById('observacoes').value = '';
               document.getElementById('tourSelecionado').value = '';
               
               // Reset do estado
               app.currentServiceType = 'transfer';
               app.precoUnitarioAtual = 0;
               
               // Limpar bot√µes ativos
               document.querySelectorAll('.btn-people, .btn-baggage, .btn-date, .btn-time, .origem-btn, .destino-btn, .btn-price, .btn-payment, .btn-payment-to, .btn-obs, .btn-service').forEach(btn => {
                   btn.classList.remove('active');
               });
               
               // Ocultar seletores
               document.getElementById('tourSelectorGroup').style.display = 'none';
               document.getElementById('priceCalculationBox').classList.remove('show');
               
               // Reset de edi√ß√£o
               app.editingId = null;
               document.getElementById('submitBtn').textContent = '‚úÖ Solicitar Transfer';
               
               // Limpar telefone
               if (app.phoneInput) {
                   app.phoneInput.setNumber('');
               }
               
               // Data padr√£o
               document.getElementById('data').valueAsDate = new Date();
               
               console.log('‚úÖ Formul√°rio limpo com sucesso');
               
           } catch (error) {
               console.error('‚ùå Erro ao limpar formul√°rio:', error);
               showStatus('Erro ao limpar formul√°rio', 'error');
           }
       }

       // =====================================================
       // VALIDA√á√ÉO E SUBMISS√ÉO DO FORMUL√ÅRIO
       // =====================================================

       function validateForm() {
           const requiredFields = [
               'nomeCliente', 'numeroPessoas', 'data', 'contacto', 
               'origem', 'destino', 'horaPickup', 'valorTotal', 
               'modoPagamento', 'pagoParaQuem'
           ];

           for (let field of requiredFields) {
               const element = document.getElementById(field);
               if (!element.value || element.value.trim() === '') {
                   element.focus();
                   showStatus(`Campo obrigat√≥rio n√£o preenchido: ${getFieldLabel(field)}`, 'error');
                   return false;
               }
           }

           const valor = parseFloat(document.getElementById('valorTotal').value);
           if (isNaN(valor) || valor <= 0) {
               document.getElementById('valorTotal').focus();
               showStatus('Valor deve ser um n√∫mero positivo', 'error');
               return false;
           }

           const pessoas = parseInt(document.getElementById('numeroPessoas').value);
           if (isNaN(pessoas) || pessoas < 1) {
               showStatus('N√∫mero de pessoas deve ser pelo menos 1', 'error');
               return false;
           }

           return true;
       }

       function getFieldLabel(fieldId) {
           const labels = {
               'nomeCliente': 'Nome do Cliente',
               'numeroPessoas': 'N√∫mero de Pessoas',
               'data': 'Data do Transfer',
               'contacto': 'Contacto do Cliente',
               'origem': 'Local de Origem',
               'destino': 'Local de Destino',
               'horaPickup': 'Hora de Pick-up',
               'valorTotal': 'Valor do Servi√ßo',
               'modoPagamento': 'Forma de Pagamento',
               'pagoParaQuem': 'Pago Para'
           };
           return labels[fieldId] || fieldId;
       }

       // =====================================================
       // EXPORTA√á√ÉO DE DADOS
       // =====================================================

       function exportToCSV() {
           if (app.services.length === 0) {
               showStatus('N√£o h√° dados para exportar!', 'warning');
               return;
           }

           try {
               const headers = [
                   'ID', 'Cliente', 'Tipo Servi√ßo', 'Tour Selecionado', 'Pessoas', 'Bagagens', 'Data', 'Contacto', 
                   'Voo', 'Origem', 'Destino', 'Hora Pick-up', 'Valor Total', 
                   'Valor Hotel', 'Valor HUB', 'Comiss√£o Recep√ß√£o',
                   'Pagamento', 'Pago Para', 'Status', 'Observa√ß√µes', 'Data Cria√ß√£o'
               ];
               
               let csvContent = headers.join(',') + '\n';
               
               app.services.forEach(service => {
                   const row = [
                       service.id,
                       `"${service.nomeCliente}"`,
                       `"${service.tipoServico || 'Transfer'}"`,
                       `"${service.tourSelecionado || ''}"`,
                       service.numeroPessoas,
                       service.numeroBagagens,
                       service.data,
                       `"${service.contacto}"`,
                       `"${service.numeroVoo || ''}"`,
                       `"${service.origem}"`,
                       `"${service.destino}"`,
                       service.horaPickup,
                       service.valorTotal,
                       service.valorHotel || 0,
                       service.valorHUB || 0,
                       service.comissaoRecepcao || 0,
                       `"${service.modoPagamento}"`,
                       `"${service.pagoParaQuem}"`,
                       service.status,
                       `"${service.observacoes || ''}"`,
                       `"${service.created || ''}"`
                   ];
                   csvContent += row.join(',') + '\n';
               });

               const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
               const link = document.createElement('a');
               const url = URL.createObjectURL(blob);
               link.setAttribute('href', url);
               link.setAttribute('download', `transfers_gota_dagua_${new Date().toISOString().split('T')[0]}.csv`);
               link.style.visibility = 'hidden';
               document.body.appendChild(link);
               link.click();
               document.body.removeChild(link);
               
               showStatus(`${app.services.length} transfers exportados com sucesso!`, 'success');
               
           } catch (error) {
               console.error('Erro ao exportar CSV:', error);
               showStatus('Erro ao exportar dados', 'error');
           }
       }

       // =====================================================
       // EVENT LISTENERS E INICIALIZA√á√ÉO
       // =====================================================

       document.addEventListener('DOMContentLoaded', function() {
           try {
               console.log('üöÄ Inicializando Sistema Gota d\'√Ågua v2.0...');
               
               // Ocultar loading screen ap√≥s inicializa√ß√£o
               setTimeout(() => {
                   document.getElementById('loadingScreen').style.display = 'none';
                   document.getElementById('mainContainer').style.display = 'block';
               }, 1500);
               
               // Carregar dados salvos
               app.loadData();
               
               // Inicializar componentes
               ServiceSelector.initialize();
               PriceCalculator.initialize();
               FormControls.initialize();
               TransferTable.initialize();
               
               // Definir data de hoje como padr√£o
               document.getElementById('data').valueAsDate = new Date();
               
               // Inicializar servi√ßos externos
               setTimeout(() => {
                   GoogleMapsService.initialize();
                   PhoneInputService.initialize();
               }, 1000);
               
               // Renderizar interface
               renderTable();
               updateSummary();
               
               // Event Listeners dos bot√µes principais
               document.getElementById('testConnectionBtn').addEventListener('click', () => {
                   GoogleSheetsService.testConnection();
               });

               document.getElementById('closeConfigBtn').addEventListener('click', () => {
                   toggleSection('configSection');
               });

               document.getElementById('clearAllDataBtn').addEventListener('click', () => {
                   GoogleSheetsService.clearAllData();
               });

               document.getElementById('clearTestDataBtn').addEventListener('click', () => {
                   GoogleSheetsService.clearTestData();
               });

               document.getElementById('closeClearDataBtn').addEventListener('click', () => {
                   toggleSection('clearDataSection');
               });

               document.getElementById('clearFormBtn').addEventListener('click', clearForm);

               document.getElementById('exportBtn').addEventListener('click', exportToCSV);

               document.getElementById('syncBtn').addEventListener('click', () => {
                   GoogleSheetsService.syncAllToSheets();
               });

               document.getElementById('configBtn').addEventListener('click', () => {
                   toggleSection('configSection');
               });

               document.getElementById('clearDataBtn').addEventListener('click', () => {
                   toggleSection('clearDataSection');
               });

               document.getElementById('adminToggle').addEventListener('click', toggleAdminMode);

               // Submiss√£o do formul√°rio
               document.getElementById('transferForm').addEventListener('submit', async function(e) {
                   e.preventDefault();

                   if (!validateForm()) {
                       return;
                   }

                   setButtonLoading('submitBtn', true);

                   try {
                       // Calcular valores com base no tipo de servi√ßo
                       const pessoas = parseInt(document.getElementById('numeroPessoas').value);
                       let valorTotal = parseFloat(document.getElementById('valorTotal').value);
                       let valorHotel, valorHUB, comissaoRecepcao;
                       
                       if (app.currentServiceType === 'tour' || app.currentServiceType === 'private') {
                           valorHotel = valorTotal * 0.30;
                           comissaoRecepcao = 5.00;
                       } else {
                           valorHotel = valorTotal * 0.30;
                           comissaoRecepcao = 2.00;
                       }
                       
                       valorHUB = valorTotal - valorHotel - comissaoRecepcao;

                       const formData = {
                           nomeCliente: document.getElementById('nomeCliente').value.trim(),
                           tipoServico: app.currentServiceType,
                           tourSelecionado: document.getElementById('tourSelecionado').value,
                           numeroPessoas: pessoas,
                           numeroBagagens: parseInt(document.getElementById('numeroBagagens').value),
                           data: document.getElementById('data').value,
                           contacto: PhoneInputService.getFormattedNumber(),
                           numeroVoo: document.getElementById('numeroVoo').value.trim(),
                           origem: document.getElementById('origem').value.trim(),
                           destino: document.getElementById('destino').value.trim(),
                           horaPickup: document.getElementById('horaPickup').value,
                           valorTotal: valorTotal,
                           valorHotel: valorHotel,
                           valorHUB: valorHUB,
                           comissaoRecepcao: comissaoRecepcao,
                           modoPagamento: document.getElementById('modoPagamento').value,
                           pagoParaQuem: document.getElementById('pagoParaQuem').value,
                           observacoes: document.getElementById('observacoes').value.trim(),
                           status: 'Solicitado'
                       };

                       if (app.editingId) {
                           // Atualizar servi√ßo existente
                           const updatedService = app.updateService(app.editingId, formData);
                           
                           if (app.isConnected) {
                               await GoogleSheetsService.sendToSheets(updatedService);
                           }
                           
                           showStatus('Transfer atualizado com sucesso!', 'success');
                           app.editingId = null;
                       } else {
                           // Criar novo servi√ßo
                           const newService = app.addService(formData);
                           
if (app.isConnected) {
                               const sheetSuccess = await GoogleSheetsService.sendToSheets(newService);
                               if (sheetSuccess) {
                                   console.log('‚úÖ Transfer enviado para Google Sheets com sucesso!');
                                   showStatus('Transfer adicionado com sucesso!', 'success');
                               } else {
                                   showStatus('‚ö†Ô∏è Transfer adicionado localmente. Erro ao enviar para Sheets.', 'warning');
                               }
                           } else {
                               showStatus('Transfer adicionado localmente. Configure o Google Sheets para sincronizar.', 'warning');
                           }
                       }

                       renderTable();
                       updateSummary();
                       clearForm();
                       
                       document.querySelector('.services-section').scrollIntoView({ 
                           behavior: 'smooth',
                           block: 'start'
                       });
                       
                   } catch (error) {
                       console.error('Erro ao processar transfer:', error);
                       showStatus('Erro ao processar transfer: ' + error.message, 'error');
                   } finally {
                       setButtonLoading('submitBtn', false);
                   }
               });

               // Atalhos de teclado
               document.addEventListener('keydown', function(e) {
                   if (e.key === 'Enter' && e.target.type === 'button') {
                       e.preventDefault();
                   }
                   
                   if (e.ctrlKey && e.key === 'Enter') {
                       const submitBtn = document.getElementById('submitBtn');
                       if (!submitBtn.disabled) {
                           submitBtn.click();
                       }
                   }
                   
                   if (e.key === 'Escape') {
                       clearForm();
                   }
               });

               // Auto-salvar quando sair da p√°gina
               window.addEventListener('beforeunload', function(e) {
                   app.saveData();
               });

               // Testar conex√£o autom√°tica se configurada
               setTimeout(() => {
                   if (app.isConnected) {
                       console.log('üîó Testando conex√£o autom√°tica...');
                       GoogleSheetsService.testConnection();
                   }
               }, 2000);
               
               console.log('‚úÖ Sistema inicializado com sucesso');
               console.log('üìã Funcionalidades principais:');
               console.log('   - Sistema de tours e private tours');
               console.log('   - C√°lculo din√¢mico de pre√ßos');
               console.log('   - Integra√ß√£o com Google Sheets');
               console.log('   - Modo admin com controle de acesso');
               console.log('   - Interface responsiva e moderna');
               console.log('   - Autocomplete com Google Maps');
               console.log('   - Valida√ß√£o internacional de telefones');
               
           } catch (error) {
               console.error('‚ùå Erro na inicializa√ß√£o:', error);
               showStatus('Erro ao inicializar sistema', 'error');
               
               // Mostrar interface mesmo com erro
               document.getElementById('loadingScreen').style.display = 'none';
               document.getElementById('mainContainer').style.display = 'block';
           }
       });

       // =====================================================
       // FUN√á√ïES GLOBAIS EXPOSTAS (para compatibilidade)
       // =====================================================

       // Expor fun√ß√µes para uso nos event handlers inline
       window.editService = editService;
       window.changeStatus = changeStatus;
       window.deleteService = deleteService;
       window.toggleAdminMode = toggleAdminMode;

       // Fun√ß√£o de debug para desenvolvimento
       window.debugInfo = function() {
           console.log('=== DEBUG INFO SISTEMA GOTA D\'√ÅGUA ===');
           console.log('Services:', app.services.length);
           console.log('Connected:', app.isConnected);
           console.log('Editing ID:', app.editingId);
           console.log('Phone Input:', app.phoneInput);
           console.log('Service Type:', app.currentServiceType);
           console.log('Admin Mode:', app.isAdminMode);
           console.log('Pre√ßo Unit√°rio Atual:', app.precoUnitarioAtual);
           console.log('WEBAPP URL:', CONFIG.WEBAPP_URL);
           console.log('Email de Teste:', CONFIG.TEST_EMAIL);
           console.log('Tours Configurados:', Object.keys(CONFIG.TOURS).length);
           console.log('Autocomplete Origin:', app.autocompleteOrigin);
           console.log('Autocomplete Destination:', app.autocompleteDestination);
           console.log('===================================');
       };

       // Log de inicializa√ß√£o
       console.log('üè® Sistema de Transfers Gota d\'√Ågua & HUB Transfer v2.0');
       console.log('üìß Email configurado:', CONFIG.TEST_EMAIL);
       console.log('üîó URL do WebApp:', CONFIG.WEBAPP_URL);
       console.log('üí° Digite debugInfo() no console para informa√ß√µes de debug');
       console.log('üîê Senha admin:', CONFIG.ADMIN_PASSWORD);
       console.log('üéØ Sistema totalmente reconstru√≠do com arquitetura moderna');

   </script>
</body>
</html>
