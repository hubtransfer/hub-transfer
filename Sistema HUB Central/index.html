<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ Sistema HUB Central - HUB Transfer</title>
    
    <!-- Google Maps API -->
    <script>
        function initMap() {
            console.log('âœ… Google Maps carregado com sucesso!');
            if (typeof initializeAutocomplete === 'function') {
                initializeAutocomplete();
            }
        }
        
        window.gm_authFailure = function() {
            console.error('âŒ Erro de autenticaÃ§Ã£o do Google Maps');
            console.log('Usando sistema de sugestÃµes local');
        };
    </script>
    
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBe4UwnVYRP5KAUOtHg3diD6kPTif3VN30&libraries=places&callback=initMap">
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/intlTelInput.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/css/intlTelInput.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --hub-primary: #2c3e50;
            --hub-secondary: #3498db;
            --hub-accent: #FFD700;
            --hub-black: #000000;
            --hub-success: #27ae60;
            --hub-warning: #f39c12;
            --hub-danger: #e74c3c;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--hub-black) 0%, var(--hub-primary) 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--hub-black) 0%, var(--hub-primary) 100%);
            color: white;
            padding: 40px 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            font-weight: 700;
            color: var(--hub-accent);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .header p {
            font-size: 1.4rem;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .company-logos {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .company-logo {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid var(--hub-accent);
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--hub-accent);
        }

        .roberta-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid var(--hub-accent);
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            background: var(--hub-accent);
            color: var(--hub-black);
        }

        .main-content {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .form-section {
            padding: 40px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        }

        .form-title {
            color: var(--hub-primary);
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 30px;
            text-align: center;
            border-bottom: 3px solid var(--hub-accent);
            padding-bottom: 15px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 700;
            color: var(--hub-primary);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--hub-accent);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
        }

        /* BotÃµes de Hotel/Operadora */
        .hotel-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }

        .btn-hotel {
            padding: 15px 20px;
            border: 2px solid var(--hub-accent);
            border-radius: 12px;
            background: white;
            color: var(--hub-primary);
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-hotel:hover {
            background: var(--hub-accent);
            color: var(--hub-black);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.4);
        }

        .btn-hotel.active {
            background: var(--hub-primary);
            color: var(--hub-accent);
            border-color: var(--hub-primary);
            box-shadow: 0 6px 15px rgba(44, 62, 80, 0.4);
        }

        /* BotÃµes rÃ¡pidos */
        .quick-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .btn-quick {
            padding: 10px 16px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            background: white;
            color: var(--hub-primary);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-quick:hover {
            background: var(--hub-accent);
            color: var(--hub-black);
            border-color: var(--hub-accent);
        }

        .btn-quick.selected {
            background: var(--hub-accent);
            color: var(--hub-black);
            border-color: var(--hub-accent);
        }

        /* BotÃµes de aÃ§Ã£o principais */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .btn {
            padding: 18px 25px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: var(--hub-accent);
            color: var(--hub-black);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.5);
        }

        .btn-primary:active {
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #5d8aa8;
            color: white;
        }

        .btn-secondary:hover {
            background: #4a6a8a;
            transform: translateY(-3px);
        }

        .btn-success {
            background: var(--hub-success);
            color: white;
        }

        .btn-success:hover {
            background: #229954;
            transform: translateY(-3px);
        }

        .btn-danger {
            background: var(--hub-danger);
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-3px);
        }

        .btn-warning {
            background: var(--hub-warning);
            color: white;
        }

        .btn-warning:hover {
            background: #d68910;
            transform: translateY(-3px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn:disabled:hover {
            transform: none;
        }

        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid rgba(0, 0, 0, 0.2);
            border-radius: 50%;
            border-top-color: var(--hub-black);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast notifications */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: white;
            padding: 16px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            border-left: 4px solid var(--hub-success);
        }

        .toast.error {
            border-left: 4px solid var(--hub-danger);
        }

        .toast.info {
            border-left: 4px solid var(--hub-secondary);
        }

        .toast.warning {
            border-left: 4px solid var(--hub-warning);
        }

        /* Transfers container */
        .transfers-section {
            padding: 40px;
            background: white;
        }

        .transfers-title {
            color: var(--hub-primary);
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .transfers-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .transfer-card {
            background: white;
            border-left: 5px solid var(--hub-accent);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .transfer-card:hover {
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
            transform: translateY(-3px);
        }

        .transfer-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .transfer-card-title {
            font-weight: 700;
            color: var(--hub-primary);
            font-size: 1.1rem;
        }

        .transfer-status {
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-confirmado {
            background: #d4edda;
            color: #155724;
        }

        .status-novo {
            background: #cce5ff;
            color: #004085;
        }

        .status-cancelado {
            background: #f8d7da;
            color: #721c24;
        }

        .transfer-info {
            font-size: 0.95rem;
            color: #666;
            margin-bottom: 8px;
        }

        /* Config section */
        .config-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 12px;
            margin-top: 30px;
            max-width: 800px;
            display: none;
        }

        .config-section.show {
            display: block;
        }

        .config-title {
            color: var(--hub-primary);
            font-weight: 700;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .config-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin-bottom: 12px;
        }

        .config-button {
            padding: 12px 20px;
            background: var(--hub-secondary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .config-button:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .hotel-buttons {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                grid-template-columns: 1fr;
            }

            .transfers-container {
                grid-template-columns: 1fr;
            }

            .toast-container {
                left: 20px;
                right: 20px;
                bottom: 20px;
            }

            .toast {
                min-width: auto;
            }
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            z-index: 999;
        }

        .connection-status.online {
            background: var(--hub-success);
            color: white;
        }

        .connection-status.offline {
            background: var(--hub-danger);
            color: white;
        }
    </style>
</head>
<body>
    <!-- Connection Status -->
    <div id="connectionStatus" class="connection-status online">
        ğŸŸ¢ Conectado
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="roberta-avatar">ğŸ¤–</div>
            <h1>ğŸ¯ HUB Transfer</h1>
            <p>Sistema Centralizado de Gerenciamento de Transfers</p>
            <div class="company-logos">
                <span class="company-logo">ğŸ¨ Empire Hotels</span>
                <span class="company-logo">ğŸš— World Driver</span>
                <span class="company-logo">âœˆï¸ Hub Transfer</span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Form Section -->
            <div class="form-section">
                <h2 class="form-title">ğŸ“‹ Solicitar Transfer</h2>
                <form id="transferForm">
                    <!-- Hotel/Operadora Selection -->
                    <div class="form-group">
                        <label>ğŸ¨ Hotel/Operadora *</label>
                        <div class="hotel-buttons">
                            <button type="button" class="btn-hotel active" data-hotel="Empire Marques Hotel" onclick="selecionarHotel(this)">
                                âœˆï¸ Empire Marques
                            </button>
                            <button type="button" class="btn-hotel" data-hotel="Hotel Lioz" onclick="selecionarHotel(this)">
                                ğŸ–ï¸ Hotel Lioz
                            </button>
                            <button type="button" class="btn-hotel" data-hotel="Empire Lisbon Hotel" onclick="selecionarHotel(this)">
                                ğŸ° Empire Lisbon
                            </button>
                            <button type="button" class="btn-hotel" data-hotel="Gota dÂ´Ã¡gua" onclick="selecionarHotel(this)">
                                ğŸ’§ Gota dÂ´Ã¡gua
                            </button>
                            <button type="button" class="btn-hotel" data-hotel="Teste Sistema Validado" onclick="selecionarHotel(this)">
                                ğŸ§ª Teste
                            </button>
                            <button type="button" class="btn-hotel" onclick="limparHotelOperadora()">
                                â• Outro
                            </button>
                        </div>
                        <input type="text" id="hotelOperadora" placeholder="Ou digite o nome da operadora" value="Empire Marques Hotel">
                    </div>

                    <!-- Form Grid -->
                    <div class="form-grid">
                        <!-- Cliente Name -->
                        <div class="form-group">
                            <label>ğŸ‘¤ Nome do Cliente *</label>
                            <input type="text" id="nomeCliente" placeholder="Ex: JoÃ£o Silva" required>
                        </div>

                        <!-- Contact Phone -->
                        <div class="form-group">
                            <label>ğŸ“± Contacto *</label>
                            <input type="tel" id="contacto" placeholder="+351XXXXXXXXX" required>
                        </div>

                        <!-- Service Type -->
                        <div class="form-group">
                            <label>ğŸš— Tipo de ServiÃ§o *</label>
                            <select id="tipoServico" required>
                                <option value="Transfer">Transfer</option>
                                <option value="Tour Regular">Tour Regular</option>
                                <option value="Private Tour">Private Tour</option>
                            </select>
                        </div>

                        <!-- Date -->
                        <div class="form-group">
                            <label>ğŸ“… Data *</label>
                            <input type="date" id="data" required>
                        </div>

                        <!-- Time -->
                        <div class="form-group">
                            <label>â° Hora Pick-up *</label>
                            <input type="time" id="horaPikup" required>
                        </div>

                        <!-- Number of People -->
                        <div class="form-group">
                            <label>ğŸ‘¥ NÃºmero de Pessoas *</label>
                            <input type="number" id="numeroPessoas" min="1" value="1" required>
                        </div>

                        <!-- Luggage -->
                        <div class="form-group">
                            <label>ğŸ§³ NÃºmero de Bagagens</label>
                            <input type="number" id="numeroBagagens" min="0" value="0">
                        </div>

                        <!-- Flight Number -->
                        <div class="form-group">
                            <label>âœˆï¸ NÃºmero do Voo</label>
                            <input type="text" id="numeroVoo" placeholder="Ex: TP123">
                        </div>

                        <!-- Origin -->
                        <div class="form-group">
                            <label>ğŸ“ Origem *</label>
                            <input type="text" id="origem" placeholder="Ex: Aeroporto de Lisboa" required>
                        </div>

                        <!-- Destination -->
                        <div class="form-group">
                            <label>ğŸ“ Destino *</label>
                            <input type="text" id="destino" placeholder="Ex: Centro de Lisboa" required>
                        </div>

                        <!-- Price -->
                        <div class="form-group">
                            <label>ğŸ’° Valor do ServiÃ§o (â‚¬) *</label>
                            <div class="quick-buttons">
                                <button type="button" class="btn-quick" onclick="setarValor(25)">â‚¬25</button>
                                <button type="button" class="btn-quick" onclick="setarValor(35)">â‚¬35</button>
                                <button type="button" class="btn-quick" onclick="setarValor(45)">â‚¬45</button>
                                <button type="button" class="btn-quick" onclick="setarValor(60)">â‚¬60</button>
                                <button type="button" class="btn-quick" onclick="setarValor(75)">â‚¬75</button>
                                <button type="button" class="btn-quick" onclick="setarValor(100)">â‚¬100</button>
                            </div>
                            <input type="number" id="valorServico" min="0" step="0.01" placeholder="Valor em euros" required>
                        </div>

                        <!-- Payment Method -->
                        <div class="form-group">
                            <label>ğŸ’³ Forma de Pagamento</label>
                            <select id="formaPagamento">
                                <option value="Dinheiro">Dinheiro</option>
                                <option value="CartÃ£o">CartÃ£o</option>
                                <option value="TransferÃªncia">TransferÃªncia</option>
                                <option value="WhatsApp Pay">WhatsApp Pay</option>
                            </select>
                        </div>
                    </div>

                    <!-- Observations -->
                    <div class="form-group">
                        <label>ğŸ“ ObservaÃ§Ãµes</label>
                        <div class="quick-buttons">
                            <button type="button" class="btn-quick" onclick="adicionarObservacao('Bagagem Extra')">Bagagem Extra</button>
                            <button type="button" class="btn-quick" onclick="adicionarObservacao('VIP')">VIP</button>
                            <button type="button" class="btn-quick" onclick="adicionarObservacao('Urgente')">Urgente</button>
                            <button type="button" class="btn-quick" onclick="adicionarObservacao('Com CrianÃ§a')">Com CrianÃ§a</button>
                        </div>
                        <textarea id="observacoes" placeholder="InformaÃ§Ãµes extras sobre o transfer" rows="3"></textarea>
                    </div>

                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <button type="submit" class="btn btn-primary" id="btnSolicitar">
                            âœ… Solicitar Transfer
                        </button>
                        <button type="reset" class="btn btn-secondary" onclick="limparFormulario(); return false;">
                            ğŸ—‘ï¸ Limpar FormulÃ¡rio
                        </button>
                        <button type="button" class="btn btn-warning" onclick="testarConexao()">
                            ğŸ”— Testar ConexÃ£o
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="toggleConfig()">
                            âš™ï¸ Configurar
                        </button>
                    </div>
                </form>

                <!-- Configuration Section -->
                <div id="configSection" class="config-section">
                    <h3 class="config-title">âš™ï¸ ConfiguraÃ§Ã£o do Sistema</h3>
                    <label>URL do Backend (Google Apps Script):</label>
                    <input type="text" id="backendUrl" class="config-input" placeholder="https://script.google.com/macros/s/.../exec">
                    <button class="config-button" onclick="atualizarBackendUrl()">Atualizar URL</button>
                    <button class="config-button" onclick="limparTodosOsDados()" style="background: var(--hub-danger);">Limpar Dados</button>
                </div>
            </div>

            <!-- Transfers Display Section -->
            <div class="transfers-section">
                <h3 class="transfers-title">ğŸ“¦ Transfers Registrados</h3>
                <div class="action-buttons" style="margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="carregarTransfers()">
                        ğŸ“¥ Carregar Transfers
                    </button>
                    <button class="btn btn-secondary" onclick="exportarTransfers()">
                        ğŸ“¤ Exportar Dados
                    </button>
                </div>
                <div id="transfersContainer" class="transfers-container">
                    <div class="transfer-card">
                        <div style="text-align: center; padding: 40px; color: #999;">
                            <h3>Nenhum transfer carregado</h3>
                            <p>Clique em "Carregar Transfers" para visualizar os dados</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CONFIGURAÃ‡ÃƒO PRINCIPAL
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        const HUB_CONFIG = {
            WEBAPP_URL: 'https://script.google.com/macros/s/AKfycbwi3D0Kaa41t7dzh4SHS7qcMs-2-N4nmrZa5RABcxzcbKthshOmPaz2XoUGUfW_uZOFsw/exec',
            SPREADSHEET_ID: '1pXAYotTOvev50-NPQMks905DELshIA4yWjcBa8Pz9WU',
            SHEET_NAME: 'HUB_Central',
            VERSION: '1.0',
            TIMEOUT: 30000
        };

        // State
        let transfers = [];
        let isSubmitting = false;
        let phoneInput = null;

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // UTILITY FUNCTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function showNotification(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = message;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function updateConnectionStatus(online) {
            const status = document.getElementById('connectionStatus');
            if (online) {
                status.textContent = 'ğŸŸ¢ Conectado';
                status.classList.add('online');
                status.classList.remove('offline');
            } else {
                status.textContent = 'ğŸ”´ Desconectado';
                status.classList.add('offline');
                status.classList.remove('online');
            }
        }

        function validarFormulario() {
            const campos = ['nomeCliente', 'contacto', 'tipoServico', 'data', 'horaPikup', 
                           'numeroPessoas', 'origem', 'destino', 'valorServico'];
            
            for (let campo of campos) {
                const elemento = document.getElementById(campo);
                if (!elemento.value || elemento.value.trim() === '') {
                    showNotification(`âŒ Campo obrigatÃ³rio: ${elemento.previousElementSibling?.textContent || campo}`, 'error');
                    return false;
                }
            }

            // Validar telefone
            const telefone = document.getElementById('contacto').value;
            if (!telefone.startsWith('+') || telefone.length < 10) {
                showNotification('âŒ Telefone deve estar no formato internacional (+XXX...)', 'error');
                return false;
            }

            // Validar valor
            const valor = parseFloat(document.getElementById('valorServico').value);
            if (valor <= 0) {
                showNotification('âŒ Valor deve ser maior que zero', 'error');
                return false;
            }

            return true;
        }

        function coletarDadosFormulario() {
            return {
                nomeCliente: document.getElementById('nomeCliente').value.trim(),
                tipoServico: document.getElementById('tipoServico').value,
                contacto: document.getElementById('contacto').value.trim(),
                numeroVoo: document.getElementById('numeroVoo').value.trim(),
                origem: document.getElementById('origem').value.trim(),
                destino: document.getElementById('destino').value.trim(),
                data: document.getElementById('data').value,
                horaPikup: document.getElementById('horaPikup').value,
                numeroPessoas: parseInt(document.getElementById('numeroPessoas').value),
                numeroBagagens: parseInt(document.getElementById('numeroBagagens').value),
                valorServico: parseFloat(document.getElementById('valorServico').value),
                formaPagamento: document.getElementById('formaPagamento').value,
                observacoes: document.getElementById('observacoes').value.trim(),
                hotelOperadora: document.getElementById('hotelOperadora').value.trim(),
                timestamp: new Date().toISOString()
            };
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // FORM HANDLERS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function selecionarHotel(btn) {
            document.querySelectorAll('.btn-hotel').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            const hotel = btn.getAttribute('data-hotel');
            if (hotel) {
                document.getElementById('hotelOperadora').value = hotel;
            }
        }

        function setarValor(valor) {
            document.getElementById('valorServico').value = valor;
            
            // Highlight button
            document.querySelectorAll('.quick-buttons .btn-quick').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.textContent.includes(valor)) {
                    btn.classList.add('selected');
                }
            });
        }

        function adicionarObservacao(texto) {
            const obs = document.getElementById('observacoes');
            if (obs.value) {
                obs.value += ', ' + texto;
            } else {
                obs.value = texto;
            }
        }

        function limparFormulario() {
            document.getElementById('transferForm').reset();
            document.getElementById('hotelOperadora').value = 'Empire Marques Hotel';
            document.getElementById('numeroPessoas').value = 1;
            document.querySelectorAll('.btn-quick').forEach(btn => btn.classList.remove('selected'));
            document.querySelectorAll('.btn-hotel').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.btn-hotel').classList.add('active');
            showNotification('âœ¨ FormulÃ¡rio limpo', 'success');
        }

        function limparHotelOperadora() {
            document.getElementById('hotelOperadora').value = '';
            document.getElementById('hotelOperadora').focus();
            document.querySelectorAll('.btn-hotel').forEach(btn => btn.classList.remove('active'));
            showNotification('âœï¸ Digite o nome da operadora', 'success');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // BACKEND COMMUNICATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        async function enviarTransferBackend(dados) {
            if (isSubmitting) {
                showNotification('â³ Aguarde - RequisiÃ§Ã£o anterior em andamento', 'warning');
                return false;
            }

            isSubmitting = true;
            const btnSubmit = document.getElementById('btnSolicitar');
            btnSubmit.disabled = true;
            btnSubmit.innerHTML = '<div class="spinner"></div> Enviando...';

            try {
                console.log('ğŸ“¤ Enviando para backend:', HUB_CONFIG.WEBAPP_URL);
                
                const resposta = await fetch(HUB_CONFIG.WEBAPP_URL, {
                    method: 'POST',
                    mode: 'cors',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dados)
                });

                if (!resposta.ok) {
                    throw new Error(`HTTP ${resposta.status}: ${resposta.statusText}`);
                }

                const resultado = await resposta.json();
                console.log('ğŸ“¥ Resposta do backend:', resultado);
                
                if (resultado.success || resultado.sucesso) {
                    showNotification('âœ… Transfer registrado com sucesso!', 'success');
                    salvarTransferLocal(dados);
                    setTimeout(limparFormulario, 500);
                    setTimeout(carregarTransfers, 1000);
                    updateConnectionStatus(true);
                    return true;
                } else {
                    throw new Error(resultado.error || resultado.erro || 'Erro desconhecido');
                }
            } catch (erro) {
                console.error('âŒ Erro ao enviar transfer:', erro);
                showNotification(`âŒ Erro: ${erro.message}`, 'error');
                updateConnectionStatus(false);
                salvarTransferLocal(dados);
                return false;
            } finally {
                isSubmitting = false;
                btnSubmit.disabled = false;
                btnSubmit.innerHTML = 'âœ… Solicitar Transfer';
            }
        }

        async function testarConexao() {
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner"></div> Testando...';

            try {
                console.log('ğŸ”— Testando conexÃ£o com:', HUB_CONFIG.WEBAPP_URL);
                
                const resposta = await fetch(HUB_CONFIG.WEBAPP_URL, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ teste: true })
                });

                if (resposta.ok) {
                    showNotification('âœ… ConexÃ£o com backend estÃ¡ funcionando!', 'success');
                    updateConnectionStatus(true);
                } else {
                    throw new Error(`HTTP ${resposta.status}`);
                }
            } catch (erro) {
                console.error('âŒ Erro de conexÃ£o:', erro);
                showNotification(`âŒ Erro na conexÃ£o: ${erro.message}`, 'error');
                updateConnectionStatus(false);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'ğŸ”— Testar ConexÃ£o';
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // LOCAL STORAGE & DATA MANAGEMENT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function salvarTransferLocal(transfer) {
            try {
                let transfersLocal = JSON.parse(localStorage.getItem('hub_transfers') || '[]');
                transfer.id = Date.now();
                transfer.salvoLocal = new Date().toISOString();
                transfersLocal.unshift(transfer);
                transfersLocal = transfersLocal.slice(0, 100);
                
                localStorage.setItem('hub_transfers', JSON.stringify(transfersLocal));
                console.log('âœ… Transfer salvo localmente:', transfer.id);
            } catch (erro) {
                console.error('âŒ Erro ao salvar localmente:', erro);
            }
        }

        function carregarTransfers() {
            const container = document.getElementById('transfersContainer');
            
            try {
                const transfersLocal = JSON.parse(localStorage.getItem('hub_transfers') || '[]');
                
                if (transfersLocal.length === 0) {
                    container.innerHTML = `
                        <div class="transfer-card">
                            <div style="text-align: center; padding: 40px; color: #999;">
                                <h3>Nenhum transfer carregado</h3>
                                <p>Clique em "Solicitar Transfer" para criar um novo</p>
                            </div>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = transfersLocal.map(transfer => `
                    <div class="transfer-card">
                        <div class="transfer-card-header">
                            <div class="transfer-card-title">${transfer.nomeCliente}</div>
                            <div class="transfer-status ${transfer.salvoLocal ? 'status-novo' : 'status-confirmado'}">
                                ${transfer.salvoLocal ? 'Local' : 'Confirmado'}
                            </div>
                        </div>
                        <div class="transfer-info">
                            <strong>ğŸ“± Contato:</strong> ${transfer.contacto}
                        </div>
                        <div class="transfer-info">
                            <strong>ğŸ“ Rota:</strong> ${transfer.origem} â†’ ${transfer.destino}
                        </div>
                        <div class="transfer-info">
                            <strong>ğŸ“… Data:</strong> ${new Date(transfer.data).toLocaleDateString('pt-PT')} Ã s ${transfer.horaPikup}
                        </div>
                        <div class="transfer-info">
                            <strong>ğŸ‘¥ Pessoas:</strong> ${transfer.numeroPessoas} | <strong>ğŸ’° Valor:</strong> â‚¬${transfer.valorServico.toFixed(2)}
                        </div>
                        <div class="transfer-info">
                            <strong>ğŸ¨ Operadora:</strong> ${transfer.hotelOperadora}
                        </div>
                        <div class="transfer-info" style="font-size: 0.85rem; color: #999;">
                            <strong>â±ï¸ Registrado:</strong> ${new Date(transfer.timestamp).toLocaleString('pt-PT')}
                        </div>
                    </div>
                `).join('');

                showNotification(`âœ… ${transfersLocal.length} transfers carregados`, 'success');
            } catch (erro) {
                console.error('âŒ Erro ao carregar transfers:', erro);
                showNotification('âŒ Erro ao carregar transfers', 'error');
            }
        }

        function exportarTransfers() {
            try {
                const transfersLocal = JSON.parse(localStorage.getItem('hub_transfers') || '[]');
                
                if (transfersLocal.length === 0) {
                    showNotification('âŒ Nenhum transfer para exportar', 'warning');
                    return;
                }

                let csv = 'Cliente,Contato,Tipo,Data,Hora,Origem,Destino,Pessoas,Valor â‚¬,Operadora,Status\n';
                
                transfersLocal.forEach(t => {
                    csv += `"${t.nomeCliente}","${t.contacto}","${t.tipoServico}","${t.data}","${t.horaPikup}","${t.origem}","${t.destino}",${t.numeroPessoas},${t.valorServico},"${t.hotelOperadora}","${t.salvoLocal ? 'Local' : 'Confirmado'}"\n`;
                });

                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `transfers_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();

                showNotification('ğŸ“¥ Transfers exportados com sucesso!', 'success');
            } catch (erro) {
                console.error('âŒ Erro ao exportar:', erro);
                showNotification('âŒ Erro ao exportar', 'error');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PHONE INPUT INITIALIZATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function initializePhoneInput() {
            const inputElement = document.getElementById('contacto');
            try {
                phoneInput = intlTelInput(inputElement, {
                    initialCountry: 'pt',
                    preferredCountries: ['pt', 'es', 'fr', 'it', 'gb'],
                    separateDialCode: true,
                    utilsScript: 'https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/utils.min.js'
                });

                inputElement.addEventListener('change', function() {
                    if (phoneInput && phoneInput.isValidNumber()) {
                        this.value = phoneInput.getNumber();
                    }
                });
            } catch (erro) {
                console.warn('âš ï¸ Erro ao inicializar phone input:', erro);
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CONFIGURATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function atualizarBackendUrl() {
            const novaUrl = document.getElementById('backendUrl').value.trim();
            
            if (!novaUrl) {
                showNotification('âŒ Digite uma URL vÃ¡lida', 'error');
                return;
            }
            
            if (!novaUrl.startsWith('https://script.google.com/macros/')) {
                showNotification('âŒ URL deve ser do Google Apps Script', 'error');
                return;
            }
            
            HUB_CONFIG.WEBAPP_URL = novaUrl;
            localStorage.setItem('hub_backend_url', novaUrl);
            
            showNotification('âœ… URL do backend atualizada!', 'success');
            console.log('ğŸ”— Nova URL:', novaUrl);
        }

        function toggleConfig() {
            const configSection = document.getElementById('configSection');
            configSection.classList.toggle('show');
            
            if (configSection.classList.contains('show')) {
                showNotification('âš™ï¸ Painel de configuraÃ§Ã£o aberto', 'success');
            }
        }

        function limparTodosOsDados() {
            if (confirm('âš ï¸ ATENÃ‡ÃƒO: Isso vai limpar todos os transfers carregados. Continuar?')) {
                localStorage.clear();
                transfers = [];
                document.getElementById('transfersContainer').innerHTML = `
                    <div class="transfer-card">
                        <div style="text-align: center; padding: 40px; color: #999;">
                            <h3>Nenhum transfer carregado</h3>
                            <p>Clique em "Solicitar Transfer" para criar um novo</p>
                        </div>
                    </div>
                `;
                showNotification('ğŸ—‘ï¸ Todos os dados foram limpos!', 'success');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // FORM SUBMISSION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        document.getElementById('transferForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            if (!validarFormulario()) {
                return;
            }

            const dados = coletarDadosFormulario();
            console.log('ğŸ“¤ Dados do formulÃ¡rio:', dados);

            const sucesso = await enviarTransferBackend(dados);
            
            if (sucesso) {
                console.log('âœ… Transfer enviado com sucesso');
            } else {
                console.log('âš ï¸ Transfer salvo localmente (sem conexÃ£o)');
            }
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // KEYBOARD SHORTCUTS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                document.getElementById('transferForm').dispatchEvent(new Event('submit'));
            }
            
            if (e.key === 'Escape') {
                e.preventDefault();
                limparFormulario();
            }
            
            if (e.key === 'F5') {
                e.preventDefault();
                carregarTransfers();
            }
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INITIALIZATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Iniciando Sistema HUB Central...');

            const urlSalva = localStorage.getItem('hub_backend_url');
            if (urlSalva) {
                HUB_CONFIG.WEBAPP_URL = urlSalva;
            }
            if (document.getElementById('backendUrl')) {
                document.getElementById('backendUrl').value = HUB_CONFIG.WEBAPP_URL;
            }

            initializePhoneInput();
            setTimeout(carregarTransfers, 500);
            setTimeout(monitorarConexao, 2000);

            console.log('âœ… Sistema HUB Central carregado e pronto!');
            console.log('ğŸ“ URL Backend:', HUB_CONFIG.WEBAPP_URL);
            showNotification('ğŸ¯ Bem-vindo ao Sistema HUB Central!', 'success');
        });

        function monitorarConexao() {
            setInterval(() => {
                fetch(HUB_CONFIG.WEBAPP_URL, { 
                    method: 'POST', 
                    body: JSON.stringify({ teste: true }),
                    headers: { 'Content-Type': 'application/json' }
                })
                    .then(() => updateConnectionStatus(true))
                    .catch(() => updateConnectionStatus(false));
            }, 10000);
        }

        // Debug functions
        window.debugHUB = function() {
            console.log('=== HUB DEBUG ===');
            console.log('Config:', HUB_CONFIG);
            console.log('Transfers:', JSON.parse(localStorage.getItem('hub_transfers') || '[]'));
            console.log('=================');
        };

        window.mostrarEstatisticas = function() {
            const transfers = JSON.parse(localStorage.getItem('hub_transfers') || '[]');
            console.log('=== ESTATÃSTICAS ===');
            console.log('Total de transfers:', transfers.length);
            console.log('Ãšltimos 5:', transfers.slice(0, 5));
            console.log('====================');
        };

    </script>
</body>
</html>
