<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Transfers - Hotel LIOZ & HUB Transfer</title>
    
    <!-- Google Maps API -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBe4UwnVYRP5KAUOtHg3diD6kPTif3VN30&libraries=places"></script>
    
    <!-- International Phone Input -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/intlTelInput.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/css/intlTelInput.css">

    <style>
        /* ============================================ */
        /* RESET E CONFIGURA√á√ïES B√ÅSICAS */
        /* ============================================ */
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            overflow: hidden;
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ============================================ */
        /* HEADER */
        /* ============================================ */

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>');
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.3rem;
            opacity: 0.95;
            margin-bottom: 25px;
        }

        .company-logos {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .company-logo {
            background: rgba(255,255,255,0.15);
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.2rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }

        .company-logo:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-5px);
        }

        /* ============================================ */
        /* SE√á√ïES DE CONFIGURA√á√ÉO */
        /* ============================================ */

        .config-section, .debug-section, .clear-section {
            margin: 20px;
            padding: 25px;
            border-radius: 15px;
            display: none;
            animation: slideDown 0.3s ease-out;
            border: 3px solid;
        }

        .config-section {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-color: #f39c12;
        }

        .debug-section {
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            border-color: #17a2b8;
        }

        .clear-section {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border-color: #dc3545;
        }

        .config-section.show, .debug-section.show, .clear-section.show {
            display: block;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 20px;
            font-size: 1.5rem;
            text-align: center;
        }

        .config-title { color: #d35400; }
        .debug-title { color: #0c5460; }
        .clear-title { color: #721c24; }

        .config-form {
            display: flex;
            gap: 15px;
            align-items: end;
            flex-wrap: wrap;
        }

        .config-input {
            flex: 1;
            min-width: 300px;
        }

        .config-input label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 1rem;
        }

        .config-input input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #f39c12;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .config-input input:focus {
            outline: none;
            border-color: #e67e22;
            box-shadow: 0 0 0 3px rgba(230, 126, 34, 0.2);
        }

        /* ============================================ */
        /* STATUS E MENSAGENS */
        /* ============================================ */

        .status-message {
            padding: 15px 20px;
            border-radius: 12px;
            margin: 15px 0;
            font-weight: 600;
            text-align: center;
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .status-success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 2px solid #28a745;
        }

        .status-error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .status-warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
            border: 2px solid #ffc107;
        }

        /* ============================================ */
        /* FORMUL√ÅRIO PRINCIPAL */
        /* ============================================ */

        .form-section {
            padding: 40px 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .form-title {
            color: #2c3e50;
            margin-bottom: 30px;
            text-align: center;
            font-size: 2.2rem;
            font-weight: 700;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .form-group input, 
        .form-group select, 
        .form-group textarea {
            padding: 16px 18px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus, 
        .form-group select:focus, 
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.15);
            transform: translateY(-2px);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* ============================================ */
        /* BOT√ïES PRINCIPAIS */
        /* ============================================ */

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .btn:active:not(:disabled) {
            transform: translateY(-1px);
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
            color: white;
        }

        .btn.loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .btn.loading {
            color: transparent;
        }

        /* ============================================ */
        /* BOT√ïES R√ÅPIDOS */
        /* ============================================ */

        .quick-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .quick-btn {
            padding: 12px 18px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            background: white;
            color: #495057;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .quick-btn:hover {
            border-color: #3498db;
            background: #e7f3ff;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.2);
        }

        .quick-btn.active {
            background: #3498db;
            color: white;
            border-color: #2980b9;
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.4);
        }

        /* Bot√µes espec√≠ficos por categoria */
        .people-btn {
            min-width: 50px;
            border-color: #9b59b6;
            color: #9b59b6;
        }

        .people-btn:hover, .people-btn.active {
            background: #9b59b6;
            color: white;
            border-color: #8e44ad;
        }

        .baggage-btn {
            min-width: 50px;
            border-color: #e67e22;
            color: #e67e22;
        }

        .baggage-btn:hover, .baggage-btn.active {
            background: #e67e22;
            color: white;
            border-color: #d35400;
        }

        .location-btn {
            min-width: 180px;
            text-align: center;
        }

        .origin-btn {
            border-left: 4px solid #e74c3c;
        }

        .destination-btn {
            border-left: 4px solid #27ae60;
        }

        .price-btn {
            font-weight: 700;
            color: #27ae60;
            border-color: #27ae60;
            min-width: 80px;
        }

        .price-btn:hover, .price-btn.active {
            background: #27ae60;
            color: white;
        }

        /* ============================================ */
        /* TELEFONE INPUT */
        /* ============================================ */

        .phone-container {
            position: relative;
        }

        .iti {
            width: 100%;
        }

        .iti__country-list {
            z-index: 9999;
        }

        .iti__selected-flag {
            padding: 16px 14px;
            border-radius: 12px 0 0 12px;
        }

        #contacto {
            padding-left: 70px;
        }

        /* ============================================ */
        /* A√á√ïES DO FORMUL√ÅRIO */
        /* ============================================ */

        .form-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 35px;
            flex-wrap: wrap;
        }

        /* ============================================ */
        /* RESUMO E ESTAT√çSTICAS */
        /* ============================================ */

        .summary-section {
            padding: 40px 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .summary-title {
            text-align: center;
            font-size: 2.2rem;
            color: #2c3e50;
            margin-bottom: 35px;
            font-weight: 700;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .summary-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-left: 5px solid #3498db;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3498db, #2980b9);
        }

        .summary-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .summary-number {
            font-size: 3rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
            line-height: 1;
        }

        .summary-label {
            color: #7f8c8d;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        /* Cores espec√≠ficas para cada card */
        .summary-card:nth-child(1) { border-left-color: #3498db; }
        .summary-card:nth-child(2) { border-left-color: #f39c12; }
        .summary-card:nth-child(3) { border-left-color: #27ae60; }
        .summary-card:nth-child(4) { border-left-color: #9b59b6; }

        /* ============================================ */
        /* RESUMO FINANCEIRO */
        /* ============================================ */

        .financial-summary {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 35px;
            border-radius: 20px;
            margin-bottom: 35px;
            position: relative;
            overflow: hidden;
        }

        .financial-summary::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="1" fill="rgba(255,255,255,0.05)"/></svg>');
            animation: float 30s infinite linear reverse;
        }

        .financial-title {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
            font-weight: 700;
            position: relative;
            z-index: 2;
        }

        .financial-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            position: relative;
            z-index: 2;
        }

        .financial-item {
            text-align: center;
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }

        .financial-item:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-5px);
        }

        .financial-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            line-height: 1;
        }

        .financial-label {
            font-size: 1rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ============================================ */
        /* SE√á√ÉO DE TRANSFERS */
        /* ============================================ */

        .transfers-section {
            padding: 40px 30px;
        }

        .transfers-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .transfers-title {
            color: #2c3e50;
            font-size: 2.2rem;
            font-weight: 700;
        }

        .filters {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 140px;
        }

        .filter-group label {
            font-size: 0.9rem;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }

        .filter-group input,
        .filter-group select {
            padding: 10px 12px;
            font-size: 0.9rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
        }

        .filter-group input:focus,
        .filter-group select:focus {
            border-color: #3498db;
            outline: none;
        }

        /* ============================================ */
        /* TABELA DE TRANSFERS */
        /* ============================================ */

        .transfers-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 20px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            padding: 18px 15px;
            border-bottom: 1px solid #ecf0f1;
            font-size: 0.95rem;
            vertical-align: middle;
        }

        tr:hover {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #7f8c8d;
        }

        .empty-state h3 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .empty-state p {
            font-size: 1.1rem;
        }

        /* ============================================ */
        /* STATUS E BADGES */
        /* ============================================ */

        .status {
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
        }

        .status-solicitado {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
            border: 1px solid #ffc107;
        }

        .status-confirmado {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 1px solid #28a745;
        }

        .status-finalizado {
            background: linear-gradient(135deg, #cce5ff 0%, #b3d9ff 100%);
            color: #004085;
            border: 1px solid #007bff;
        }

        .status-cancelado {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border: 1px solid #dc3545;
        }

        .payment-method, .pago-para {
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            display: inline-block;
        }

        .payment-cash {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
        }

        .payment-card {
            background: linear-gradient(135deg, #cce5ff 0%, #b3d9ff 100%);
            color: #004085;
        }

        .payment-transfer {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
        }

        .pago-recepcao {
            background: linear-gradient(135deg, #e7f3ff 0%, #cce5ff 100%);
            color: #004085;
        }

        .pago-motorista {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
        }

        /* ============================================ */
        /* A√á√ïES DA TABELA */
        /* ============================================ */

        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 8px 12px;
            font-size: 0.8rem;
            border-radius: 8px;
            min-width: 35px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .btn-small:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* ============================================ */
        /* VALORES E DESTACUES */
        /* ============================================ */

        .client-info {
            font-weight: 600;
            color: #2c3e50;
        }

        .value-highlight {
            font-weight: 700;
            color: #27ae60;
            font-size: 1.2rem;
        }

        .person-badge, .baggage-badge {
            padding: 6px 12px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.85rem;
            display: inline-block;
        }

        .person-badge {
            background: #9b59b6;
            color: white;
        }

        .baggage-badge {
            background: #e67e22;
            color: white;
        }

        /* ============================================ */
        /* RESPONSIVIDADE */
        /* ============================================ */

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.2rem;
            }
            
            .header p {
                font-size: 1.1rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .financial-grid {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .transfers-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .company-logos {
                flex-direction: column;
                gap: 15px;
            }

            .config-form {
                flex-direction: column;
            }

            .config-input {
                min-width: 100%;
            }

            .form-actions {
                flex-direction: column;
                align-items: stretch;
            }

            .quick-buttons {
                justify-content: center;
            }

            .transfers-table {
                overflow-x: auto;
            }

            table {
                min-width: 800px;
            }
        }

        /* ============================================ */
        /* ANIMA√á√ïES ADICIONAIS */
        /* ============================================ */

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* ============================================ */
        /* GOOGLE MAPS AUTOCOMPLETE */
        /* ============================================ */

        .pac-container {
            z-index: 9999;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        /* ============================================ */
        /* DEBUG INFO */
        /* ============================================ */

        .debug-info {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #333;
            overflow-x: auto;
            border: 1px solid #17a2b8;
        }

        .debug-item {
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

        .debug-label {
            font-weight: bold;
            color: #0c5460;
        }

.debug-value {
           color: #495057;
           margin-left: 10px;
       }

       .debug-success {
           color: #28a745;
       }

       .debug-error {
           color: #dc3545;
       }

       .debug-warning {
           color: #ffc107;
       }

       /* ============================================ */
       /* LOADING STATES */
       /* ============================================ */

       .loading-overlay {
           position: fixed;
           top: 0;
           left: 0;
           right: 0;
           bottom: 0;
           background: rgba(0,0,0,0.5);
           display: none;
           justify-content: center;
           align-items: center;
           z-index: 10000;
       }

       .loading-spinner {
           width: 60px;
           height: 60px;
           border: 4px solid #f3f3f3;
           border-top: 4px solid #3498db;
           border-radius: 50%;
           animation: spin 1s linear infinite;
       }

       /* ============================================ */
       /* TOOLTIPS */
       /* ============================================ */

       .tooltip {
           position: relative;
           cursor: help;
       }

       .tooltip::before {
           content: attr(data-tooltip);
           position: absolute;
           bottom: 125%;
           left: 50%;
           transform: translateX(-50%);
           background: #2c3e50;
           color: white;
           padding: 8px 12px;
           border-radius: 6px;
           font-size: 0.8rem;
           white-space: nowrap;
           opacity: 0;
           visibility: hidden;
           transition: all 0.3s ease;
           z-index: 1000;
       }

       .tooltip::after {
           content: '';
           position: absolute;
           bottom: 115%;
           left: 50%;
           transform: translateX(-50%);
           border: 5px solid transparent;
           border-top-color: #2c3e50;
           opacity: 0;
           visibility: hidden;
           transition: all 0.3s ease;
       }

       .tooltip:hover::before,
       .tooltip:hover::after {
           opacity: 1;
           visibility: visible;
       }

       /* ============================================ */
       /* NOTIFICA√á√ïES */
       /* ============================================ */

       .notification {
           position: fixed;
           top: 20px;
           right: 20px;
           padding: 15px 20px;
           border-radius: 8px;
           color: white;
           font-weight: 600;
           z-index: 10001;
           transform: translateX(400px);
           transition: transform 0.3s ease;
           max-width: 400px;
       }

       .notification.show {
           transform: translateX(0);
       }

       .notification.success {
           background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
       }

       .notification.error {
           background: linear-gradient(135deg, #dc3545 0%, #e74c3c 100%);
       }

       .notification.warning {
           background: linear-gradient(135deg, #ffc107 0%, #f39c12 100%);
           color: #212529;
       }

       .notification.info {
           background: linear-gradient(135deg, #17a2b8 0%, #3498db 100%);
       }
   </style>
</head>

<body>
   <!-- Loading Overlay -->
   <div class="loading-overlay" id="loadingOverlay">
       <div class="loading-spinner"></div>
   </div>

   <div class="container">
       <!-- ============================================ -->
       <!-- HEADER -->
       <!-- ============================================ -->
       <div class="header">
           <div class="header-content">
               <h1>ü§ù Sistema de Transfers</h1>
               <p>Gest√£o Integrada - Colabora√ß√£o Hotel LIOZ & HUB Transfer</p>
               <div class="company-logos">
                   <div class="company-logo">üè® Hotel LIOZ</div>
                   <div class="company-logo">üöê HUB Transfer</div>
               </div>
           </div>
       </div>

       <!-- ============================================ -->
       <!-- SE√á√ÉO DE CONFIGURA√á√ÉO -->
       <!-- ============================================ -->
       <div class="config-section" id="configSection">
           <div class="section-title config-title">üîó Configura√ß√£o do Sistema</div>
           <div class="config-form">
               <div class="config-input">
                   <label for="webappUrl">URL do Google Apps Script Web App:</label>
                   <input type="url" id="webappUrl" placeholder="https://script.google.com/macros/s/...">
               </div>
               <button type="button" class="btn btn-success" onclick="testConnection()" id="testBtn">
                   üîó Testar Conex√£o
               </button>
               <button type="button" class="btn btn-danger" onclick="toggleConfig()">
                   üîí Fechar
               </button>
           </div>
           <div id="connectionStatus" class="status-message"></div>
       </div>

       <!-- ============================================ -->
       <!-- SE√á√ÉO DE DEBUG -->
       <!-- ============================================ -->
       <div class="debug-section" id="debugSection">
           <div class="section-title debug-title">üîç Debug do Sistema</div>
           <div class="debug-info" id="debugInfo">
               <div class="debug-item">
                   <span class="debug-label">Estado do Sistema:</span>
                   <span class="debug-value" id="debugStatus">Inicializando...</span>
               </div>
               <div class="debug-item">
                   <span class="debug-label">URL Configurada:</span>
                   <span class="debug-value" id="debugUrl">N√£o configurada</span>
               </div>
               <div class="debug-item">
                   <span class="debug-label">Status da Conex√£o:</span>
                   <span class="debug-value" id="debugConnection">N√£o testada</span>
               </div>
               <div class="debug-item">
                   <span class="debug-label">√öltimo Teste:</span>
                   <span class="debug-value" id="debugLastTest">Nunca</span>
               </div>
               <div class="debug-item">
                   <span class="debug-label">Total de Transfers:</span>
                   <span class="debug-value" id="debugTotal">0</span>
               </div>
               <div class="debug-item">
                   <span class="debug-label">√öltimo Envio:</span>
                   <span class="debug-value" id="debugLastSend">Nunca</span>
               </div>
               <div class="debug-item">
                   <span class="debug-label">Vers√£o do Sistema:</span>
                   <span class="debug-value">v3.0</span>
               </div>
           </div>
           <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
               <button type="button" class="btn btn-success" onclick="debugTest()">
                   üß™ Teste Completo
               </button>
               <button type="button" class="btn btn-info" onclick="updateDebugInfo()">
                   üîÑ Atualizar Info
               </button>
               <button type="button" class="btn btn-danger" onclick="toggleDebug()">
                   üîí Fechar
               </button>
           </div>
       </div>

       <!-- ============================================ -->
       <!-- SE√á√ÉO DE LIMPEZA -->
       <!-- ============================================ -->
       <div class="clear-section" id="clearSection">
           <div class="section-title clear-title">üóëÔ∏è Limpeza de Dados</div>
           <div style="background: #fff; border: 2px solid #dc3545; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
               <strong style="color: #dc3545;">‚ö†Ô∏è ATEN√á√ÉO:</strong> Esta opera√ß√£o ir√° remover PERMANENTEMENTE dados do Google Sheets!
               <br><strong>Esta a√ß√£o n√£o pode ser desfeita.</strong>
           </div>
           <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
               <button type="button" class="btn btn-danger" onclick="clearAllData()" id="clearAllBtn">
                   üóëÔ∏è Limpar Todos os Dados
               </button>
               <button type="button" class="btn btn-warning" onclick="clearTestData()" id="clearTestBtn">
                   üßπ Limpar Apenas Testes
               </button>
               <button type="button" class="btn btn-secondary" onclick="toggleClearData()">
                   üîí Fechar
               </button>
           </div>
       </div>

       <!-- ============================================ -->
       <!-- FORMUL√ÅRIO PRINCIPAL -->
       <!-- ============================================ -->
       <div class="form-section">
           <h2 class="form-title">‚ûï Solicitar Novo Transfer</h2>
           
           <form id="transferForm">
               <div class="form-grid">
                   <!-- Nome do Cliente -->
                   <div class="form-group">
                       <label for="nomeCliente">Nome do Cliente *</label>
                       <input type="text" id="nomeCliente" required placeholder="Ex: Jo√£o Silva">
                   </div>
                   
                   <!-- N√∫mero de Pessoas -->
                   <div class="form-group">
                       <label for="numeroPessoas">N√∫mero de Pessoas *</label>
                       <div class="quick-buttons">
                           <button type="button" class="quick-btn people-btn" onclick="setPeople(1)">1</button>
                           <button type="button" class="quick-btn people-btn" onclick="setPeople(2)">2</button>
                           <button type="button" class="quick-btn people-btn" onclick="setPeople(3)">3</button>
                           <button type="button" class="quick-btn people-btn" onclick="setPeople(4)">4</button>
                           <button type="button" class="quick-btn people-btn" onclick="setPeople(5)">5</button>
                           <button type="button" class="quick-btn people-btn" onclick="setPeople(6)">6</button>
                           <button type="button" class="quick-btn people-btn" onclick="setPeople(7)">7</button>
                           <button type="button" class="quick-btn people-btn" onclick="setPeople(8)">8+</button>
                       </div>
                       <input type="number" id="numeroPessoas" min="1" max="20" required>
                   </div>
                   
                   <!-- N√∫mero de Bagagens -->
                   <div class="form-group">
                       <label for="numeroBagagens">N√∫mero de Bagagens</label>
                       <div class="quick-buttons">
                           <button type="button" class="quick-btn baggage-btn" onclick="setBaggage(0)">0</button>
                           <button type="button" class="quick-btn baggage-btn" onclick="setBaggage(1)">1</button>
                           <button type="button" class="quick-btn baggage-btn" onclick="setBaggage(2)">2</button>
                           <button type="button" class="quick-btn baggage-btn" onclick="setBaggage(3)">3</button>
                           <button type="button" class="quick-btn baggage-btn" onclick="setBaggage(4)">4</button>
                           <button type="button" class="quick-btn baggage-btn" onclick="setBaggage(5)">5</button>
                           <button type="button" class="quick-btn baggage-btn" onclick="setBaggage(6)">6+</button>
                       </div>
                       <input type="number" id="numeroBagagens" min="0" max="50" value="0">
                   </div>
                   
                   <!-- Data do Transfer -->
                   <div class="form-group">
                       <label for="data">Data do Transfer *</label>
                       <div class="quick-buttons">
                           <button type="button" class="quick-btn" onclick="setDate('today')">üìÖ Hoje</button>
                           <button type="button" class="quick-btn" onclick="setDate('tomorrow')">üìÖ Amanh√£</button>
                       </div>
                       <input type="date" id="data" required>
                   </div>
                   
                   <!-- Hora de Pick-up -->
                   <div class="form-group">
                       <label for="horaPickup">Hora de Pick-up *</label>
                       <div class="quick-buttons">
                           <button type="button" class="quick-btn" onclick="setTime('06:00')">06:00</button>
                           <button type="button" class="quick-btn" onclick="setTime('07:00')">07:00</button>
                           <button type="button" class="quick-btn" onclick="setTime('08:00')">08:00</button>
                           <button type="button" class="quick-btn" onclick="setTime('09:00')">09:00</button>
                           <button type="button" class="quick-btn" onclick="setTime('10:00')">10:00</button>
                           <button type="button" class="quick-btn" onclick="setTime('12:00')">12:00</button>
                       </div>
                       <div class="quick-buttons" style="margin-top: 8px;">
                           <button type="button" class="quick-btn" onclick="setTime('14:00')">14:00</button>
                           <button type="button" class="quick-btn" onclick="setTime('16:00')">16:00</button>
                           <button type="button" class="quick-btn" onclick="setTime('18:00')">18:00</button>
                           <button type="button" class="quick-btn" onclick="setTime('20:00')">20:00</button>
                           <button type="button" class="quick-btn" onclick="setTime('22:00')">22:00</button>
                           <button type="button" class="quick-btn" onclick="setTime('23:30')">23:30</button>
                       </div>
                       <input type="time" id="horaPickup" required>
                   </div>
                   
                   <!-- Contacto -->
                   <div class="form-group">
                       <label for="contacto">Contacto do Cliente *</label>
                       <div class="phone-container">
                           <input type="tel" id="contacto" required placeholder="Digite o n√∫mero...">
                       </div>
                   </div>
                   
                   <!-- N√∫mero do Voo -->
                   <div class="form-group">
                       <label for="numeroVoo">N√∫mero do Voo</label>
                       <input type="text" id="numeroVoo" placeholder="Ex: TP1234, TAP123">
                   </div>
                   
                   <!-- Origem -->
                   <div class="form-group">
                       <label for="origem">Local de Origem *</label>
                       <div class="quick-buttons">
                           <button type="button" class="quick-btn location-btn origin-btn" onclick="setOrigin('Aeroporto de Lisboa')">
                               ‚úàÔ∏è Aeroporto de Lisboa
                           </button>
                           <button type="button" class="quick-btn location-btn origin-btn" onclick="setOrigin('Hotel LIOZ')">
                               üè® Hotel LIOZ
                           </button>
                       </div>
                       <input type="text" id="origem" required placeholder="Digite ou escolha o local de origem...">
                   </div>
                   
                   <!-- Destino -->
                   <div class="form-group">
                       <label for="destino">Local de Destino *</label>
                       <div class="quick-buttons">
                           <button type="button" class="quick-btn location-btn destination-btn" onclick="setDestination('Hotel LIOZ')">
                               üè® Hotel LIOZ
                           </button>
                           <button type="button" class="quick-btn location-btn destination-btn" onclick="setDestination('Aeroporto de Lisboa')">
                               ‚úàÔ∏è Aeroporto de Lisboa
                           </button>
                       </div>
                       <input type="text" id="destino" required placeholder="Digite ou escolha o local de destino...">
                   </div>
                   
                   <!-- Valor do Servi√ßo -->
                   <div class="form-group">
                       <label for="valorTotal">Valor do Servi√ßo (‚Ç¨) *</label>
                       <div class="quick-buttons">
                           <button type="button" class="quick-btn price-btn" onclick="setPrice(25)">‚Ç¨25</button>
                           <button type="button" class="quick-btn price-btn" onclick="setPrice(35)">‚Ç¨35</button>
                           <button type="button" class="quick-btn price-btn" onclick="setPrice(45)">‚Ç¨45</button>
                           <button type="button" class="quick-btn price-btn" onclick="setPrice(60)">‚Ç¨60</button>
                           <button type="button" class="quick-btn price-btn" onclick="setPrice(75)">‚Ç¨75</button>
                           <button type="button" class="quick-btn price-btn" onclick="setPrice(100)">‚Ç¨100</button>
                       </div>
                       <input type="number" id="valorTotal" step="0.01" min="0" required placeholder="Digite o valor...">
                   </div>
                   
                   <!-- Forma de Pagamento -->
                   <div class="form-group">
                       <label for="modoPagamento">Forma de Pagamento *</label>
                       <div class="quick-buttons">
                           <button type="button" class="quick-btn" onclick="setPayment('Dinheiro')">
                               üíµ Dinheiro
                           </button>
                           <button type="button" class="quick-btn" onclick="setPayment('Cart√£o')">
                               üí≥ Cart√£o
                           </button>
                           <button type="button" class="quick-btn" onclick="setPayment('Transfer√™ncia')">
                               üè¶ Transfer√™ncia
                           </button>
                       </div>
                       <select id="modoPagamento" required>
                           <option value="">Selecionar forma de pagamento...</option>
                           <option value="Dinheiro">Dinheiro</option>
                           <option value="Cart√£o">Cart√£o</option>
                           <option value="Transfer√™ncia">Transfer√™ncia Banc√°ria</option>
                       </select>
                   </div>
                   
                   <!-- Pago Para -->
                   <div class="form-group">
                       <label for="pagoParaQuem">Pago Para *</label>
                       <div class="quick-buttons">
                           <button type="button" class="quick-btn" onclick="setPaymentTo('Recep√ß√£o')">
                               üè® Recep√ß√£o
                           </button>
                           <button type="button" class="quick-btn" onclick="setPaymentTo('Motorista')">
                               üöê Motorista
                           </button>
                       </div>
                       <select id="pagoParaQuem" required>
                           <option value="">Selecionar quem recebeu...</option>
                           <option value="Recep√ß√£o">Recep√ß√£o (Hotel)</option>
                           <option value="Motorista">Motorista (HUB)</option>
                       </select>
                   </div>
                   
                   <!-- Observa√ß√µes -->
                   <div class="form-group">
                       <label for="observacoes">Observa√ß√µes</label>
                       <div class="quick-buttons">
                           <button type="button" class="quick-btn" onclick="addObservation('Bagagem extra')">üì¶ Bagagem Extra</button>
                           <button type="button" class="quick-btn" onclick="addObservation('Transfer urgente')">‚ö° Urgente</button>
                           <button type="button" class="quick-btn" onclick="addObservation('Cliente VIP')">‚≠ê VIP</button>
                           <button type="button" class="quick-btn" onclick="addObservation('Com crian√ßa')">üë∂ Com Crian√ßa</button>
                       </div>
                       <textarea id="observacoes" rows="3" placeholder="Informa√ß√µes adicionais sobre o transfer..."></textarea>
                   </div>
               </div>

               <!-- A√ß√µes do Formul√°rio -->
               <div class="form-actions">
                   <button type="submit" class="btn btn-primary" id="submitBtn">
                       ‚úÖ Solicitar Transfer
                   </button>
                   <button type="button" class="btn btn-secondary" onclick="clearForm()">
                       üîÑ Limpar Formul√°rio
                   </button>
                   <button type="button" class="btn btn-info" onclick="exportToCSV()" id="exportBtn">
                       üìä Exportar CSV
                   </button>
                   <button type="button" class="btn btn-success" onclick="syncAllData()" id="syncBtn" style="display: none;">
                       üì§ Sincronizar Dados
                   </button>
                   <button type="button" class="btn btn-warning" onclick="toggleConfig()">
                       ‚öôÔ∏è Configurar
                   </button>
                   <button type="button" class="btn btn-info" onclick="toggleDebug()">
                       üîç Debug
                   </button>
                   <button type="button" class="btn btn-danger" onclick="toggleClearData()">
                       üóëÔ∏è Limpar Dados
                   </button>
               </div>
           </form>
       </div>

       <!-- ============================================ -->
       <!-- SE√á√ÉO DE RESUMO -->
       <!-- ============================================ -->
       <div class="summary-section">
           <h2 class="summary-title">üìä Resumo do Sistema</h2>
           
           <div class="summary-grid">
               <div class="summary-card">
                   <div class="summary-number" id="totalTransfers">0</div>
                   <div class="summary-label">Total de Transfers</div>
               </div>
               <div class="summary-card">
                   <div class="summary-number" id="pendingTransfers">0</div>
                   <div class="summary-label">Solicitados</div>
               </div>
               <div class="summary-card">
                   <div class="summary-number" id="confirmedTransfers">0</div>
                   <div class="summary-label">Confirmados</div>
               </div>
               <div class="summary-card">
                   <div class="summary-number" id="completedTransfers">0</div>
                   <div class="summary-label">Finalizados</div>
               </div>
           </div>

           <!-- Resumo Financeiro -->
           <div class="financial-summary">
               <h3 class="financial-title">üí∞ Resumo Financeiro</h3>
               <div class="financial-grid">
                   <div class="financial-item">
                       <div class="financial-value" id="totalRevenue">‚Ç¨0.00</div>
                       <div class="financial-label">Receita Total</div>
                   </div>
                   <div class="financial-item">
                       <div class="financial-value" id="hotelCommission">‚Ç¨0.00</div>
                       <div class="financial-label">Comiss√£o Hotel</div>
                   </div>
                   <div class="financial-item">
                       <div class="financial-value" id="hubCommission">‚Ç¨0.00</div>
                       <div class="financial-label">Comiss√£o HUB</div>
                   </div>
                   <div class="financial-item">
                       <div class="financial-value" id="averageTicket">‚Ç¨0.00</div>
                       <div class="financial-label">Ticket M√©dio</div>
                   </div>
               </div>
           </div>
       </div>

       <!-- ============================================ -->
       <!-- SE√á√ÉO DE TRANSFERS -->
       <!-- ============================================ -->
       <div class="transfers-section">
           <div class="transfers-header">
               <h2 class="transfers-title">üìã Lista de Transfers</h2>
               <div class="filters">
                   <div class="filter-group">
                       <label for="filterStatus">Status:</label>
                       <select id="filterStatus" onchange="filterTable()">
                           <option value="">Todos</option>
                           <option value="Solicitado">Solicitado</option>
                           <option value="Confirmado">Confirmado</option>
                           <option value="Finalizado">Finalizado</option>
                           <option value="Cancelado">Cancelado</option>
                       </select>
                   </div>
                   <div class="filter-group">
                       <label for="filterData">Data:</label>
                       <input type="date" id="filterData" onchange="filterTable()">
                   </div>
                   <div class="filter-group">
                       <label for="searchClient">Cliente:</label>
                       <input type="text" id="searchClient" placeholder="Buscar..." onkeyup="filterTable()">
                   </div>
               </div>
           </div>

           <div class="transfers-table">
               <table id="transfersTable">
                   <thead>
                       <tr>
                           <th>ID</th>
                           <th>Cliente</th>
                           <th>üë•</th>
                           <th>üß≥</th>
                           <th>Data</th>
                           <th>Hora</th>
                           <th>Contacto</th>
                           <th>Voo</th>
                           <th>Rota</th>
                           <th>Valor</th>
                           <th>Pagamento</th>
                           <th>Pago Para</th>
                           <th>Status</th>
                           <th>A√ß√µes</th>
                       </tr>
                   </thead>
                   <tbody id="transfersTableBody">
                       <tr>
                           <td colspan="14" class="empty-state">
                               <h3>üìã Nenhum transfer cadastrado</h3>
                               <p>Adicione o primeiro transfer usando o formul√°rio acima</p>
                           </td>
                       </tr>
                   </tbody>
               </table>
           </div>
       </div>
   </div>

   <!-- ============================================ -->
   <!-- JAVASCRIPT -->
   <!-- ============================================ -->
   <script>
       // ============================================
       // VARI√ÅVEIS GLOBAIS
       // ============================================
       
       let transfers = [];
       let editingId = null;
       let phoneInput = null;
       let isConnected = false;
       let lastConnectionTest = null;
       let lastSendTime = null;

       const CONFIG = {
           SPREADSHEET_ID: '1jXhF6tAPhuieIoIm6F3zsaEkq7NV_tafarkxcot4IE8',
           APP_VERSION: '3.0',
           STORAGE_KEY: 'transfers_lioz_hub_v3',
           URL_KEY: 'webapp_url_v3'
       };

       // ============================================
       // INICIALIZA√á√ÉO DO SISTEMA
       // ============================================

       document.addEventListener('DOMContentLoaded', function() {
           console.log('üöÄ Iniciando Sistema de Transfers v3.0...');
           
           try {
               // Carregar dados salvos
               loadSavedData();
               
               // Definir data padr√£o
               document.getElementById('data').valueAsDate = new Date();
               
               // Inicializar componentes
               setTimeout(() => {
                   initializePhoneInput();
                   initializeGoogleMaps();
               }, 1000);
               
               // Verificar conex√£o salva
               checkSavedConnection();
               
               // Atualizar interface
               updateSummary();
               renderTable();
               updateDebugInfo();
               
               console.log('‚úÖ Sistema inicializado com sucesso');
               showNotification('Sistema carregado com sucesso!', 'success');
               
           } catch (error) {
               console.error('‚ùå Erro na inicializa√ß√£o:', error);
               showNotification('Erro ao inicializar sistema: ' + error.message, 'error');
           }
       });

       // ============================================
       // GEST√ÉO DE DADOS LOCAIS
       // ============================================

       function loadSavedData() {
           try {
               const savedData = localStorage.getItem(CONFIG.STORAGE_KEY);
               const savedUrl = localStorage.getItem(CONFIG.URL_KEY);
               
               if (savedData) {
                   transfers = JSON.parse(savedData);
                   console.log(`üìÇ ${transfers.length} transfers carregados`);
               }
               
               if (savedUrl) {
                   document.getElementById('webappUrl').value = savedUrl;
                   document.getElementById('syncBtn').style.display = 'inline-flex';
                   console.log('üîó URL salva carregada');
               }
               
           } catch (error) {
               console.error('‚ùå Erro ao carregar dados:', error);
               transfers = [];
           }
       }

       function saveData() {
           try {
               localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(transfers));
               console.log('üíæ Dados salvos localmente');
           } catch (error) {
               console.error('‚ùå Erro ao salvar dados:', error);
               showNotification('Erro ao salvar dados localmente', 'error');
           }
       }

       function saveWebappUrl() {
           const url = document.getElementById('webappUrl').value.trim();
           if (url) {
               localStorage.setItem(CONFIG.URL_KEY, url);
               document.getElementById('syncBtn').style.display = 'inline-flex';
               console.log('‚úÖ URL salva');
           }
       }

       function checkSavedConnection() {
           const savedUrl = localStorage.getItem(CONFIG.URL_KEY);
           if (savedUrl) {
               isConnected = true;
               document.getElementById('syncBtn').style.display = 'inline-flex';
           }
       }

       // ============================================
       // SISTEMA DE NOTIFICA√á√ïES
       // ============================================

       function showNotification(message, type = 'info', duration = 5000) {
           // Remover notifica√ß√£o existente
           const existing = document.querySelector('.notification');
           if (existing) {
               existing.remove();
           }
           
           // Criar nova notifica√ß√£o
           const notification = document.createElement('div');
           notification.className = `notification ${type}`;
           notification.textContent = message;
           
           document.body.appendChild(notification);
           
           // Mostrar notifica√ß√£o
           setTimeout(() => {
               notification.classList.add('show');
           }, 100);
           
           // Remover notifica√ß√£o
           setTimeout(() => {
               notification.classList.remove('show');
               setTimeout(() => {
                   if (notification.parentNode) {
notification.remove();
                  }
              }, 300);
          }, duration);
       }

       function showStatus(message, type = 'success') {
           const statusDiv = document.getElementById('connectionStatus');
           statusDiv.className = `status-message status-${type}`;
           statusDiv.textContent = message;
           statusDiv.style.display = 'block';
           
           // Auto hide ap√≥s 8 segundos
           setTimeout(() => {
               statusDiv.style.display = 'none';
           }, 8000);
       }

       // ============================================
       // LOADING E ESTADOS DE BOT√ïES
       // ============================================

       function showLoading() {
           document.getElementById('loadingOverlay').style.display = 'flex';
       }

       function hideLoading() {
           document.getElementById('loadingOverlay').style.display = 'none';
       }

       function setButtonLoading(buttonId, loading = true) {
           const button = document.getElementById(buttonId);
           if (!button) return;
           
           if (loading) {
               button.disabled = true;
               button.classList.add('loading');
               button.dataset.originalText = button.textContent;
               button.textContent = '';
           } else {
               button.disabled = false;
               button.classList.remove('loading');
               if (button.dataset.originalText) {
                   button.textContent = button.dataset.originalText;
               }
           }
       }

       // ============================================
       // CONFIGURA√á√ïES E TOGGLE SE√á√ïES
       // ============================================

       function toggleConfig() {
           const configSection = document.getElementById('configSection');
           configSection.classList.toggle('show');
           if (configSection.classList.contains('show')) {
               updateDebugInfo();
           }
       }

       function toggleDebug() {
           const debugSection = document.getElementById('debugSection');
           debugSection.classList.toggle('show');
           if (debugSection.classList.contains('show')) {
               updateDebugInfo();
           }
       }

       function toggleClearData() {
           const clearSection = document.getElementById('clearSection');
           clearSection.classList.toggle('show');
       }

       // ============================================
       // SISTEMA DE DEBUG
       // ============================================

       function updateDebugInfo() {
           const url = document.getElementById('webappUrl').value.trim() || localStorage.getItem(CONFIG.URL_KEY) || 'N√£o configurada';
           const connection = isConnected ? '‚úÖ Conectado' : '‚ùå Desconectado';
           const lastTest = lastConnectionTest ? new Date(lastConnectionTest).toLocaleString('pt-PT') : 'Nunca';
           const total = transfers.length;
           const lastSend = lastSendTime ? new Date(lastSendTime).toLocaleString('pt-PT') : 'Nunca';
           
           document.getElementById('debugStatus').textContent = isConnected ? '‚úÖ Online' : '‚ö†Ô∏è Offline';
           document.getElementById('debugUrl').textContent = url;
           document.getElementById('debugConnection').textContent = connection;
           document.getElementById('debugLastTest').textContent = lastTest;
           document.getElementById('debugTotal').textContent = total;
           document.getElementById('debugLastSend').textContent = lastSend;
           
           // Aplicar classes de cor
           document.getElementById('debugStatus').className = `debug-value ${isConnected ? 'debug-success' : 'debug-warning'}`;
           document.getElementById('debugConnection').className = `debug-value ${isConnected ? 'debug-success' : 'debug-error'}`;
       }

       async function debugTest() {
           console.log('üß™ Executando teste completo de debug...');
           showStatus('üß™ Executando teste completo...', 'warning');
           setButtonLoading('testBtn', true);
           
           const url = document.getElementById('webappUrl').value.trim() || localStorage.getItem(CONFIG.URL_KEY);
           
           if (!url) {
               showStatus('‚ùå Configure a URL primeiro!', 'error');
               setButtonLoading('testBtn', false);
               return;
           }

           try {
               // 1. Teste de conectividade
               console.log('üîç 1. Testando conectividade...');
               const testResponse = await fetch(url + '?action=test', {
                   method: 'GET',
                   mode: 'cors'
               });
               
               if (!testResponse.ok) {
                   throw new Error(`HTTP ${testResponse.status}: ${testResponse.statusText}`);
               }
               
               const testResult = await testResponse.json();
               console.log('‚úÖ Conectividade OK:', testResult);

               // 2. Teste de envio
               console.log('üîç 2. Testando envio de dados...');
               const testData = {
                   id: 99999,
                   nomeCliente: 'TESTE DEBUG v3.0',
                   numeroPessoas: 2,
                   numeroBagagens: 1,
                   data: new Date().toISOString().split('T')[0],
                   contacto: '+351999888777',
                   numeroVoo: 'DEBUG999',
                   origem: 'Teste Debug - Origem',
                   destino: 'Teste Debug - Destino',
                   horaPickup: '15:30',
                   valorTotal: 85.50,
                   modoPagamento: 'Cart√£o',
                   pagoParaQuem: 'Recep√ß√£o',
                   status: 'Solicitado',
                   observacoes: 'Teste completo do sistema v3.0'
               };

               const sendResponse = await fetch(url, {
                   method: 'POST',
                   headers: {
                       'Content-Type': 'application/json',
                   },
                   body: JSON.stringify(testData),
                   mode: 'cors'
               });

               if (!sendResponse.ok) {
                   throw new Error(`Erro no envio: HTTP ${sendResponse.status}`);
               }

               const sendResult = await sendResponse.json();
               console.log('‚úÖ Envio OK:', sendResult);

               // Atualizar estado
               isConnected = true;
               lastConnectionTest = Date.now();
               lastSendTime = Date.now();
               saveWebappUrl();
               updateDebugInfo();

               showStatus('‚úÖ Teste completo bem-sucedido! Sistema funcionando perfeitamente.', 'success');
               showNotification('üß™ Debug: Sistema totalmente funcional!', 'success');
               
           } catch (error) {
               console.error('‚ùå Erro no debug:', error);
               isConnected = false;
               updateDebugInfo();
               
               showStatus('‚ùå Falha no teste: ' + error.message, 'error');
               showNotification('‚ùå Debug: ' + error.message, 'error');
               
           } finally {
               setButtonLoading('testBtn', false);
           }
       }

       // ============================================
       // TESTE DE CONEX√ÉO
       // ============================================

       async function testConnection() {
           const url = document.getElementById('webappUrl').value.trim();
           
           if (!url) {
               showStatus('Por favor, insira a URL do Google Apps Script!', 'error');
               return;
           }

           if (!url.includes('script.google.com')) {
               showStatus('URL inv√°lida! Use uma URL do Google Apps Script.', 'error');
               return;
           }
           
           setButtonLoading('testBtn', true);
           
           try {
               console.log('üîó Testando conex√£o com:', url);
               
               // Teste GET b√°sico
               const testResponse = await fetch(url + '?action=test', {
                   method: 'GET',
                   mode: 'cors'
               });
               
               if (!testResponse.ok) {
                   throw new Error(`GET falhou: HTTP ${testResponse.status}: ${testResponse.statusText}`);
               }
               
               const testResult = await testResponse.json();
               console.log('üìÑ Resposta do teste:', testResult);
               
               if (testResult.status !== 'success') {
                   throw new Error('Resposta inv√°lida: ' + testResult.message);
               }
               
               // Teste POST com dados simples
               const dadosTeste = {
                   id: 99998,
                   nomeCliente: 'TESTE DE CONEX√ÉO v3.0',
                   numeroPessoas: 1,
                   numeroBagagens: 0,
                   data: new Date().toISOString().split('T')[0],
                   contacto: '+351999888777',
                   numeroVoo: 'TEST001',
                   origem: 'Teste - Origem',
                   destino: 'Teste - Destino',
                   horaPickup: '12:00',
                   valorTotal: 30.00,
                   modoPagamento: 'Dinheiro',
                   pagoParaQuem: 'Recep√ß√£o',
                   status: 'Solicitado',
                   observacoes: 'Teste de conex√£o v3.0'
               };
               
               const postResponse = await fetch(url, {
                   method: 'POST',
                   headers: {
                       'Content-Type': 'application/json',
                   },
                   body: JSON.stringify(dadosTeste),
                   mode: 'cors'
               });
               
               if (!postResponse.ok) {
                   throw new Error(`POST falhou: HTTP ${postResponse.status}: ${postResponse.statusText}`);
               }
               
               const postResult = await postResponse.json();
               console.log('üìÑ Resposta do POST:', postResult);
               
               if (postResult.status === 'success') {
                   isConnected = true;
                   lastConnectionTest = Date.now();
                   showStatus('‚úÖ Conex√£o perfeita! Sistema totalmente funcional.', 'success');
                   showNotification('üîó Conectado com sucesso ao Google Sheets!', 'success');
                   saveWebappUrl();
                   updateDebugInfo();
                   
                   // Auto fechar configura√ß√£o ap√≥s 3 segundos
                   setTimeout(() => {
                       toggleConfig();
                   }, 3000);
               } else {
                   throw new Error('POST retornou erro: ' + (postResult.message || 'Erro desconhecido'));
               }
               
           } catch (error) {
               console.error('‚ùå Erro no teste de conex√£o:', error);
               showStatus(`‚ùå Falha na conex√£o: ${error.message}`, 'error');
               showNotification('‚ùå Erro de conex√£o: ' + error.message, 'error');
               isConnected = false;
               updateDebugInfo();
               
           } finally {
               setButtonLoading('testBtn', false);
           }
       }

       // ============================================
       // INICIALIZA√á√ÉO DE COMPONENTES
       // ============================================

       function initializePhoneInput() {
           const phoneInputElement = document.getElementById('contacto');
           
           if (window.intlTelInput) {
               phoneInput = window.intlTelInput(phoneInputElement, {
                   initialCountry: "pt",
                   preferredCountries: ["pt", "es", "fr", "de", "br", "us", "gb"],
                   separateDialCode: true,
                   autoHideDialCode: false,
                   nationalMode: false,
                   formatOnDisplay: true,
                   utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/utils.js"
               });

               phoneInputElement.addEventListener('blur', function() {
                   if (phoneInput.isValidNumber()) {
                       phoneInputElement.value = phoneInput.getNumber();
                   }
               });
               
               console.log('‚úÖ Telefone input inicializado');
           } else {
               console.log('‚ö†Ô∏è IntlTelInput n√£o carregado');
           }
       }

       function initializeGoogleMaps() {
           if (typeof google !== 'undefined' && google.maps && google.maps.places) {
               try {
                   // Autocomplete para origem
                   const origemInput = document.getElementById('origem');
                   const origemAutocomplete = new google.maps.places.Autocomplete(origemInput, {
                       types: ['establishment', 'geocode'],
                       componentRestrictions: { country: 'pt' }
                   });

                   // Autocomplete para destino
                   const destinoInput = document.getElementById('destino');
                   const destinoAutocomplete = new google.maps.places.Autocomplete(destinoInput, {
                       types: ['establishment', 'geocode'],
                       componentRestrictions: { country: 'pt' }
                   });

                   console.log('‚úÖ Google Maps inicializado');
                   
               } catch (error) {
                   console.error('‚ùå Erro ao inicializar Google Maps:', error);
               }
           } else {
               // Tentar novamente ap√≥s 2 segundos
               setTimeout(initializeGoogleMaps, 2000);
           }
       }

       function getFormattedPhoneNumber() {
           if (phoneInput && phoneInput.isValidNumber()) {
               return phoneInput.getNumber();
           }
           return document.getElementById('contacto').value;
       }

       // ============================================
       // FUN√á√ïES DOS BOT√ïES R√ÅPIDOS
       // ============================================

       function setPeople(number) {
           document.getElementById('numeroPessoas').value = number;
           document.querySelectorAll('.people-btn').forEach(btn => btn.classList.remove('active'));
           event.target.classList.add('active');
       }

       function setBaggage(number) {
           document.getElementById('numeroBagagens').value = number;
           document.querySelectorAll('.baggage-btn').forEach(btn => btn.classList.remove('active'));
           event.target.classList.add('active');
       }

       function setDate(option) {
           const dateInput = document.getElementById('data');
           const today = new Date();
           
           document.querySelectorAll('.quick-btn').forEach(btn => {
               if (btn.textContent.includes('Hoje') || btn.textContent.includes('Amanh√£')) {
                   btn.classList.remove('active');
               }
           });
           
           if (option === 'today') {
               dateInput.valueAsDate = today;
               event.target.classList.add('active');
           } else if (option === 'tomorrow') {
               const tomorrow = new Date(today);
               tomorrow.setDate(tomorrow.getDate() + 1);
               dateInput.valueAsDate = tomorrow;
               event.target.classList.add('active');
           }
       }

       function setTime(time) {
           document.getElementById('horaPickup').value = time;
           document.querySelectorAll('.quick-btn').forEach(btn => {
               if (btn.textContent.includes(':')) {
                   btn.classList.remove('active');
               }
           });
           event.target.classList.add('active');
       }

       function setOrigin(location) {
           document.getElementById('origem').value = location;
           document.querySelectorAll('.origin-btn').forEach(btn => btn.classList.remove('active'));
           event.target.classList.add('active');
       }

       function setDestination(location) {
           document.getElementById('destino').value = location;
           document.querySelectorAll('.destination-btn').forEach(btn => btn.classList.remove('active'));
           event.target.classList.add('active');
       }

       function setPrice(price) {
           document.getElementById('valorTotal').value = price;
           document.querySelectorAll('.price-btn').forEach(btn => btn.classList.remove('active'));
           event.target.classList.add('active');
       }

       function setPayment(method) {
           document.getElementById('modoPagamento').value = method;
           document.querySelectorAll('.quick-btn').forEach(btn => {
               if (btn.textContent.includes('Dinheiro') || btn.textContent.includes('Cart√£o') || btn.textContent.includes('Transfer√™ncia')) {
                   btn.classList.remove('active');
               }
           });
           event.target.classList.add('active');
       }

       function setPaymentTo(recipient) {
           document.getElementById('pagoParaQuem').value = recipient;
           document.querySelectorAll('.quick-btn').forEach(btn => {
               if (btn.textContent.includes('Recep√ß√£o') || btn.textContent.includes('Motorista')) {
                   btn.classList.remove('active');
               }
           });
           event.target.classList.add('active');
       }

       function addObservation(text) {
           const obsInput = document.getElementById('observacoes');
           const currentText = obsInput.value;
           
           if (currentText === '') {
               obsInput.value = text;
           } else {
               obsInput.value = currentText + '; ' + text;
           }
           
           event.target.classList.add('active');
           setTimeout(() => {
               event.target.classList.remove('active');
           }, 1000);
       }

       // ============================================
       // VALIDA√á√ÉO DE FORMUL√ÅRIO
       // ============================================

       function validateForm() {
           const requiredFields = [
               'nomeCliente', 'numeroPessoas', 'data', 'contacto', 
               'origem', 'destino', 'horaPickup', 'valorTotal', 
               'modoPagamento', 'pagoParaQuem'
           ];

           for (let field of requiredFields) {
               const element = document.getElementById(field);
               if (!element.value || element.value.trim() === '') {
                   element.focus();
                   element.classList.add('shake');
                   setTimeout(() => element.classList.remove('shake'), 500);
                   showNotification(`Campo obrigat√≥rio: ${getFieldLabel(field)}`, 'error');
                   return false;
               }
           }

           // Validar valor
           const valor = parseFloat(document.getElementById('valorTotal').value);
           if (isNaN(valor) || valor <= 0) {
               document.getElementById('valorTotal').focus();
               showNotification('Valor deve ser um n√∫mero positivo', 'error');
               return false;
           }

           // Validar pessoas
           const pessoas = parseInt(document.getElementById('numeroPessoas').value);
           if (isNaN(pessoas) || pessoas < 1 || pessoas > 20) {
               showNotification('N√∫mero de pessoas deve estar entre 1 e 20', 'error');
               return false;
           }

           // Validar telefone
           const telefone = getFormattedPhoneNumber();
           if (telefone.length < 8) {
               document.getElementById('contacto').focus();
               showNotification('Digite um n√∫mero de telefone v√°lido', 'error');
               return false;
           }

           return true;
       }

       function getFieldLabel(fieldId) {
           const labels = {
               'nomeCliente': 'Nome do Cliente',
               'numeroPessoas': 'N√∫mero de Pessoas',
               'data': 'Data do Transfer',
               'contacto': 'Contacto do Cliente',
               'origem': 'Local de Origem',
               'destino': 'Local de Destino',
               'horaPickup': 'Hora de Pick-up',
               'valorTotal': 'Valor do Servi√ßo',
               'modoPagamento': 'Forma de Pagamento',
               'pagoParaQuem': 'Pago Para'
           };
           return labels[fieldId] || fieldId;
       }

       // ============================================
       // ENVIO PARA GOOGLE SHEETS
       // ============================================

       async function sendToSheets(transferData) {
           const url = document.getElementById('webappUrl').value.trim() || localStorage.getItem(CONFIG.URL_KEY);
           
           if (!url) {
               console.log('‚ùå URL n√£o configurada');
               showNotification('Configure a URL do Google Apps Script primeiro!', 'error');
               return false;
           }
           
           console.log('üì§ Enviando para Google Sheets:', transferData);
           
           try {
               // Garantir campos obrigat√≥rios
               const dadosCompletos = {
                   id: transferData.id || Date.now(),
                   nomeCliente: transferData.nomeCliente || '',
                   numeroPessoas: parseInt(transferData.numeroPessoas) || 1,
                   numeroBagagens: parseInt(transferData.numeroBagagens) || 0,
                   data: transferData.data || new Date().toISOString().split('T')[0],
                   contacto: transferData.contacto || '',
                   numeroVoo: transferData.numeroVoo || '',
                   origem: transferData.origem || '',
                   destino: transferData.destino || '',
                   horaPickup: transferData.horaPickup || '12:00',
                   valorTotal: parseFloat(transferData.valorTotal) || 0,
                   modoPagamento: transferData.modoPagamento || 'Dinheiro',
                   pagoParaQuem: transferData.pagoParaQuem || 'Recep√ß√£o',
                   status: transferData.status || 'Solicitado',
                   observacoes: transferData.observacoes || ''
               };
               
               console.log('üìã Dados preparados:', dadosCompletos);
               
               const response = await fetch(url, {
                   method: 'POST',
                   headers: {
                       'Content-Type': 'application/json',
                   },
                   body: JSON.stringify(dadosCompletos),
                   mode: 'cors'
               });
               
               console.log('üì° Status da resposta:', response.status);
               
               if (!response.ok) {
                   const errorText = await response.text();
                   throw new Error(`HTTP ${response.status}: ${errorText}`);
               }
               
               const result = await response.json();
               console.log('üìÑ Resposta do servidor:', result);
               
               if (result.status === 'success') {
                   console.log('‚úÖ Enviado com sucesso!');
                   lastSendTime = Date.now();
                   isConnected = true;
                   updateDebugInfo();
                   
                   showNotification(`‚úÖ Transfer enviado! ID: ${dadosCompletos.id}`, 'success');
                   return true;
               } else {
                   console.error('‚ùå Erro do servidor:', result.message);
                   showNotification(`‚ùå Erro: ${result.message}`, 'error');
                   return false;
               }
               
           } catch (error) {
               console.error('‚ùå Erro ao enviar:', error);
               isConnected = false;
               updateDebugInfo();
               
               let mensagemErro = 'Erro de conex√£o';
               if (error.message.includes('CORS')) {
                   mensagemErro = 'Erro CORS - Verifique se o Web App foi implantado corretamente';
               } else if (error.message.includes('404')) {
                   mensagemErro = 'URL n√£o encontrada - Verifique a URL do Web App';
               } else if (error.message.includes('403')) {
                   mensagemErro = 'Acesso negado - Verifique as permiss√µes do Web App';
               }
               
               showNotification(`‚ùå ${mensagemErro}`, 'error');
               return false;
           }
       }

       // ============================================
       // SUBMISS√ÉO DO FORMUL√ÅRIO
       // ============================================

       document.getElementById('transferForm').addEventListener('submit', async function(e) {
           e.preventDefault();

           console.log('üìù Iniciando submiss√£o do formul√°rio...');

           if (!validateForm()) {
               return;
           }

           setButtonLoading('submitBtn', true);
           
           // Preparar dados
           const formData = {
               nomeCliente: document.getElementById('nomeCliente').value.trim(),
               numeroPessoas: parseInt(document.getElementById('numeroPessoas').value),
               numeroBagagens: parseInt(document.getElementById('numeroBagagens').value) || 0,
               data: document.getElementById('data').value,
               contacto: getFormattedPhoneNumber(),
               numeroVoo: document.getElementById('numeroVoo').value.trim(),
               origem: document.getElementById('origem').value.trim(),
               destino: document.getElementById('destino').value.trim(),
               horaPickup: document.getElementById('horaPickup').value,
               valorTotal: parseFloat(document.getElementById('valorTotal').value),
               modoPagamento: document.getElementById('modoPagamento').value,
               pagoParaQuem: document.getElementById('pagoParaQuem').value,
               observacoes: document.getElementById('observacoes').value.trim(),
               status: 'Solicitado'
           };

           console.log('üìã Dados do formul√°rio:', formData);

           try {
               if (editingId) {
                   // Modo edi√ß√£o
                   const index = transfers.findIndex(t => t.id === editingId);
                   if (index !== -1) {
                       transfers[index] = { ...transfers[index], ...formData };
                       
                       const sheetSuccess = await sendToSheets(transfers[index]);
                       
                       if (sheetSuccess) {
                           showNotification('‚úÖ Transfer atualizado e sincronizado!', 'success');
                       } else {
                           showNotification('‚ö†Ô∏è Transfer atualizado localmente.', 'warning');
                       }
                   }
                   editingId = null;
               } else {
                   // Novo transfer
                   const newId = transfers.length > 0 ? Math.max(...transfers.map(t => t.id)) + 1 : 1;
                   const newTransfer = {
                       id: newId,
                       ...formData,
                       created: new Date().toISOString()
                   };
                   
                   // Adicionar aos dados locais
                   transfers.push(newTransfer);
                   
                   // Enviar para Google Sheets
                   const sheetSuccess = await sendToSheets(newTransfer);
                   
                   if (sheetSuccess) {
                       showNotification(`‚úÖ Transfer #${newId} criado e enviado!`, 'success');
                   } else {
                       showNotification(`‚ö†Ô∏è Transfer #${newId} salvo localmente.`, 'warning');
                   }
               }

               // Atualizar interface
               saveData();
               renderTable();
               updateSummary();
               clearForm();
               updateDebugInfo();
               
               // Scroll para tabela
               setTimeout(() => {
                   document.querySelector('.transfers-section').scrollIntoView({ 
                       behavior: 'smooth',
                       block: 'start'
                   });
               }, 500);
               
           } catch (error) {
               console.error('‚ùå Erro ao processar transfer:', error);
               showNotification('‚ùå Erro ao processar transfer: ' + error.message, 'error');
           } finally {
               setButtonLoading('submitBtn', false);
           }
       });

       // ============================================
       // LIMPEZA DE FORMUL√ÅRIO
       // ============================================

       function clearForm() {
           try {
               document.getElementById('transferForm').reset();
               
               // Limpar campos espec√≠ficos
               document.getElementById('numeroPessoas').value = '';
               document.getElementById('numeroBagagens').value = '0';
               document.getElementById('modoPagamento').value = '';
               document.getElementById('pagoParaQuem').value = '';
               document.getElementById('observacoes').value = '';
               
               // Limpar bot√µes ativos
               document.querySelectorAll('.quick-btn').forEach(btn => {
                   btn.classList.remove('active');
               });
               
               // Reset modo edi√ß√£o
               editingId = null;
               document.getElementById('submitBtn').textContent = '‚úÖ Solicitar Transfer';
               
               // Reset telefone
               if (phoneInput) {
                   phoneInput.setNumber('');
               }
               
               // Data padr√£o
               document.getElementById('data').valueAsDate = new Date();
               
               console.log('‚úÖ Formul√°rio limpo');
               showNotification('Formul√°rio limpo!', 'info');
               
           } catch (error) {
               console.error('‚ùå Erro ao limpar formul√°rio:', error);
           }
       }

       // ============================================
       // RENDERIZA√á√ÉO DA TABELA
       // ============================================

       function renderTable() {
           const tbody = document.getElementById('transfersTableBody');
           tbody.innerHTML = '';

           if (transfers.length === 0) {
               tbody.innerHTML = `
                   <tr>
                       <td colspan="14" class="empty-state">
                           <h3>üìã Nenhum transfer cadastrado</h3>
                           <p>Adicione o primeiro transfer usando o formul√°rio acima</p>
                       </td>
                   </tr>
               `;
               return;
           }

           console.log(`üìã Renderizando ${transfers.length} transfers`);

           // Ordenar por data mais recente primeiro
           const sortedTransfers = [...transfers].sort((a, b) => {
               const dateA = new Date(a.data + ' ' + a.horaPickup);
               const dateB = new Date(b.data + ' ' + b.horaPickup);
               return dateB - dateA;
           });

           sortedTransfers.forEach(transfer => {
               const row = document.createElement('tr');
               
               const paymentClass = getPaymentClass(transfer.modoPagamento);
               const pagoParaClass = transfer.pagoParaQuem === 'Recep√ß√£o' ? 'pago-recepcao' : 'pago-motorista';
               
               row.innerHTML = `
                   <td><strong>#${transfer.id}</strong></td>
                   <td>
                       <div class="client-info">${transfer.nomeCliente}</div>
                       <div style="font-size: 0.8rem; color: #7f8c8d;">${transfer.contacto}</div>
                   </td>
                   <td>
                       <span class="person-badge">üë• ${transfer.numeroPessoas}</span>
                   </td>
                   <td>
                       <span class="baggage-badge">üß≥ ${transfer.numeroBagagens}</span>
                   </td>
                   <td><strong>${formatDate(transfer.data)}</strong></td>
                   <td>
                       <strong style="font-size: 1.1rem; color: #2c3e50;">
                           ${transfer.horaPickup}
                       </strong>
                   </td>
                   <td>${transfer.contacto}</td>
                   <td>${transfer.numeroVoo || '-'}</td>
                   <td>
                       <div style="font-size: 0.9rem;">
                           <div><strong>De:</strong> ${truncateText(transfer.origem, 25)}</div>
                           <div><strong>Para:</strong> ${truncateText(transfer.destino, 25)}</div>
                       </div>
                   </td>
<td><span class="value-highlight">‚Ç¨${transfer.valorTotal.toFixed(2)}</span></td>
                   <td><span class="payment-method ${paymentClass}">${transfer.modoPagamento}</span></td>
                   <td><span class="pago-para ${pagoParaClass}">${transfer.pagoParaQuem}</span></td>
                   <td><span class="status status-${transfer.status.toLowerCase()}">${transfer.status}</span></td>
                   <td>
                       <div class="action-buttons">
                           <button class="btn btn-small btn-primary" onclick="editTransfer(${transfer.id})" title="Editar">‚úèÔ∏è</button>
                           <button class="btn btn-small btn-success" onclick="changeStatus(${transfer.id})" title="Alterar Status">üîÑ</button>
                           <button class="btn btn-small btn-danger" onclick="deleteTransfer(${transfer.id})" title="Excluir">üóëÔ∏è</button>
                       </div>
                   </td>
               `;
               tbody.appendChild(row);
           });
       }

       function getPaymentClass(payment) {
           switch(payment.toLowerCase()) {
               case 'dinheiro': return 'payment-cash';
               case 'cart√£o': return 'payment-card';
               case 'transfer√™ncia': return 'payment-transfer';
               default: return 'payment-cash';
           }
       }

       function truncateText(text, maxLength) {
           if (text.length <= maxLength) return text;
           return text.substring(0, maxLength) + '...';
       }

       function formatDate(dateString) {
           const date = new Date(dateString);
           return date.toLocaleDateString('pt-PT', {
               day: '2-digit',
               month: '2-digit',
               year: 'numeric'
           });
       }

       // ============================================
       // ATUALIZA√á√ÉO DO RESUMO
       // ============================================

       function updateSummary() {
           const total = transfers.length;
           const pending = transfers.filter(t => t.status === 'Solicitado').length;
           const confirmed = transfers.filter(t => t.status === 'Confirmado').length;
           const completed = transfers.filter(t => t.status === 'Finalizado').length;

           const totalRevenue = transfers.reduce((sum, t) => sum + (t.valorTotal || 0), 0);
           const hotelCommission = totalRevenue * 0.15; // 15% para hotel
           const hubCommission = totalRevenue * 0.10;   // 10% para HUB
           const averageTicket = total > 0 ? totalRevenue / total : 0;

           // Atualizar cards de resumo
           document.getElementById('totalTransfers').textContent = total;
           document.getElementById('pendingTransfers').textContent = pending;
           document.getElementById('confirmedTransfers').textContent = confirmed;
           document.getElementById('completedTransfers').textContent = completed;

           // Atualizar resumo financeiro
           document.getElementById('totalRevenue').textContent = `‚Ç¨${totalRevenue.toFixed(2)}`;
           document.getElementById('hotelCommission').textContent = `‚Ç¨${hotelCommission.toFixed(2)}`;
           document.getElementById('hubCommission').textContent = `‚Ç¨${hubCommission.toFixed(2)}`;
           document.getElementById('averageTicket').textContent = `‚Ç¨${averageTicket.toFixed(2)}`;

           console.log(`üìä Resumo atualizado: ${total} transfers, ‚Ç¨${totalRevenue.toFixed(2)} receita`);
       }

       // ============================================
       // A√á√ïES DOS TRANSFERS
       // ============================================

       function editTransfer(id) {
           const transfer = transfers.find(t => t.id === id);
           if (!transfer) {
               showNotification('Transfer n√£o encontrado', 'error');
               return;
           }

           try {
               // Preencher formul√°rio
               document.getElementById('nomeCliente').value = transfer.nomeCliente;
               document.getElementById('numeroPessoas').value = transfer.numeroPessoas;
               document.getElementById('numeroBagagens').value = transfer.numeroBagagens;
               document.getElementById('data').value = transfer.data;
               document.getElementById('numeroVoo').value = transfer.numeroVoo || '';
               document.getElementById('origem').value = transfer.origem;
               document.getElementById('destino').value = transfer.destino;
               document.getElementById('horaPickup').value = transfer.horaPickup;
               document.getElementById('valorTotal').value = transfer.valorTotal;
               document.getElementById('modoPagamento').value = transfer.modoPagamento;
               document.getElementById('pagoParaQuem').value = transfer.pagoParaQuem;
               document.getElementById('observacoes').value = transfer.observacoes || '';
               
               // Configurar telefone
               if (phoneInput) {
                   phoneInput.setNumber(transfer.contacto);
               } else {
                   document.getElementById('contacto').value = transfer.contacto;
               }
               
               // Ativar bot√µes correspondentes
               updateActiveButtons(transfer);
               
               editingId = id;
               document.getElementById('submitBtn').textContent = '‚úèÔ∏è Atualizar Transfer';
               
               // Scroll para formul√°rio
               document.querySelector('.form-section').scrollIntoView({ 
                   behavior: 'smooth',
                   block: 'start'
               });
               
               showNotification('Editando transfer #' + id, 'info');
               
           } catch (error) {
               console.error('‚ùå Erro ao editar transfer:', error);
               showNotification('Erro ao carregar dados para edi√ß√£o', 'error');
           }
       }

       function updateActiveButtons(transfer) {
           // Limpar todos os bot√µes ativos
           document.querySelectorAll('.quick-btn').forEach(btn => btn.classList.remove('active'));
           
           // Ativar bot√£o de pessoas
           document.querySelectorAll('.people-btn').forEach(btn => {
               if (btn.textContent === transfer.numeroPessoas.toString()) {
                   btn.classList.add('active');
               }
           });
           
           // Ativar bot√£o de bagagens
           document.querySelectorAll('.baggage-btn').forEach(btn => {
               if (btn.textContent === transfer.numeroBagagens.toString()) {
                   btn.classList.add('active');
               }
           });
           
           // Ativar bot√£o de pre√ßo
           document.querySelectorAll('.price-btn').forEach(btn => {
               if (btn.textContent.includes(transfer.valorTotal.toString())) {
                   btn.classList.add('active');
               }
           });
           
           // Ativar bot√µes de pagamento
           document.querySelectorAll('.quick-btn').forEach(btn => {
               if (btn.textContent.toLowerCase().includes(transfer.modoPagamento.toLowerCase())) {
                   btn.classList.add('active');
               }
               if (btn.textContent.toLowerCase().includes(transfer.pagoParaQuem.toLowerCase())) {
                   btn.classList.add('active');
               }
           });
       }

       async function changeStatus(id) {
           const transfer = transfers.find(t => t.id === id);
           if (!transfer) {
               showNotification('Transfer n√£o encontrado', 'error');
               return;
           }

           const statuses = ['Solicitado', 'Confirmado', 'Finalizado', 'Cancelado'];
           const currentIndex = statuses.indexOf(transfer.status);
           const nextIndex = (currentIndex + 1) % statuses.length;
           
           transfer.status = statuses[nextIndex];
           
           try {
               saveData();
               renderTable();
               updateSummary();
               
               // Tentar sincronizar com Sheets
               if (isConnected) {
                   await sendToSheets(transfer);
                   showNotification(`Status alterado para: ${transfer.status}`, 'success');
               } else {
                   showNotification(`Status alterado para: ${transfer.status} (apenas local)`, 'warning');
               }
               
           } catch (error) {
               console.error('‚ùå Erro ao alterar status:', error);
               showNotification('Erro ao alterar status', 'error');
           }
       }

       function deleteTransfer(id) {
           if (!confirm('Tem certeza que deseja deletar este transfer?')) {
               return;
           }

           try {
               const originalLength = transfers.length;
               transfers = transfers.filter(t => t.id !== id);
               
               if (transfers.length < originalLength) {
                   saveData();
                   renderTable();
                   updateSummary();
                   showNotification('Transfer deletado com sucesso', 'success');
               } else {
                   showNotification('Transfer n√£o encontrado', 'error');
               }
               
           } catch (error) {
               console.error('‚ùå Erro ao deletar transfer:', error);
               showNotification('Erro ao deletar transfer', 'error');
           }
       }

       // ============================================
       // FILTROS DA TABELA
       // ============================================

       function filterTable() {
           const statusFilter = document.getElementById('filterStatus').value;
           const dataFilter = document.getElementById('filterData').value;
           const clientFilter = document.getElementById('searchClient').value.toLowerCase();

           const tbody = document.getElementById('transfersTableBody');
           const rows = tbody.getElementsByTagName('tr');

           let visibleCount = 0;

           for (let row of rows) {
               if (row.cells.length < 14) continue; // Skip empty state row
               
               let showRow = true;

               // Filtro por status
               if (statusFilter && !row.textContent.includes(statusFilter)) {
                   showRow = false;
               }

               // Filtro por data
               if (dataFilter) {
                   const rowDate = row.cells[4].textContent;
                   const filterDate = formatDate(dataFilter);
                   if (!rowDate.includes(filterDate)) {
                       showRow = false;
                   }
               }

               // Filtro por cliente
               if (clientFilter && !row.cells[1].textContent.toLowerCase().includes(clientFilter)) {
                   showRow = false;
               }

               row.style.display = showRow ? '' : 'none';
               if (showRow) visibleCount++;
           }

           // Atualizar contador de resultados
           updateFilterResults(visibleCount);
       }

       function updateFilterResults(count) {
           let existingCounter = document.getElementById('filterCounter');
           if (!existingCounter) {
               existingCounter = document.createElement('div');
               existingCounter.id = 'filterCounter';
               existingCounter.style.cssText = 'text-align: center; padding: 15px; color: #7f8c8d; font-style: italic; font-size: 1rem;';
               document.querySelector('.transfers-table').insertBefore(existingCounter, document.querySelector('table'));
           }
           
           if (count === transfers.length) {
               existingCounter.textContent = '';
           } else {
               existingCounter.textContent = `üìä Mostrando ${count} de ${transfers.length} transfers`;
           }
       }

       // ============================================
       // EXPORTA√á√ÉO DE DADOS
       // ============================================

       function exportToCSV() {
           if (transfers.length === 0) {
               showNotification('N√£o h√° dados para exportar!', 'warning');
               return;
           }

           try {
               const headers = [
                   'ID', 'Cliente', 'Pessoas', 'Bagagens', 'Data', 'Contacto', 
                   'Voo', 'Origem', 'Destino', 'Hora Pick-up', 'Valor', 
                   'Pagamento', 'Pago Para', 'Status', 'Observa√ß√µes', 'Data Cria√ß√£o'
               ];
               
               let csvContent = headers.join(',') + '\n';
               
               transfers.forEach(transfer => {
                   const row = [
                       transfer.id,
                       `"${transfer.nomeCliente}"`,
                       transfer.numeroPessoas,
                       transfer.numeroBagagens,
                       transfer.data,
                       `"${transfer.contacto}"`,
                       `"${transfer.numeroVoo || ''}"`,
                       `"${transfer.origem}"`,
                       `"${transfer.destino}"`,
                       transfer.horaPickup,
                       transfer.valorTotal,
                       `"${transfer.modoPagamento}"`,
                       `"${transfer.pagoParaQuem}"`,
                       transfer.status,
                       `"${transfer.observacoes || ''}"`,
                       `"${transfer.created || ''}"`
                   ];
                   csvContent += row.join(',') + '\n';
               });

               const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
               const link = document.createElement('a');
               const url = URL.createObjectURL(blob);
               link.setAttribute('href', url);
               link.setAttribute('download', `transfers_lioz_hub_${new Date().toISOString().split('T')[0]}.csv`);
               link.style.visibility = 'hidden';
               document.body.appendChild(link);
               link.click();
               document.body.removeChild(link);
               
               showNotification(`${transfers.length} transfers exportados com sucesso!`, 'success');
               
           } catch (error) {
               console.error('‚ùå Erro ao exportar CSV:', error);
               showNotification('Erro ao exportar dados', 'error');
           }
       }

       // ============================================
       // SINCRONIZA√á√ÉO DE DADOS
       // ============================================

       async function syncAllData() {
           const url = document.getElementById('webappUrl').value.trim() || localStorage.getItem(CONFIG.URL_KEY);
           
           if (!url) {
               showNotification('Configure a URL do Google Apps Script primeiro!', 'error');
               return;
           }
           
           if (transfers.length === 0) {
               showNotification('N√£o h√° dados para sincronizar!', 'warning');
               return;
           }
           
           setButtonLoading('syncBtn', true);
           let successCount = 0;
           let errorCount = 0;
           
           try {
               console.log(`üîÑ Iniciando sincroniza√ß√£o de ${transfers.length} transfers...`);
               showNotification('üîÑ Sincronizando dados...', 'info');
               
               for (const transfer of transfers) {
                   console.log(`üì§ Enviando transfer ID: ${transfer.id}`);
                   
                   const success = await sendToSheets(transfer);
                   if (success) {
                       successCount++;
                   } else {
                       errorCount++;
                   }
                   
                   // Pausa entre requisi√ß√µes
                   await new Promise(resolve => setTimeout(resolve, 500));
               }
               
               console.log(`üìä Sincroniza√ß√£o completa: ${successCount} sucessos, ${errorCount} erros`);
               
               if (successCount > 0) {
                   showNotification(`‚úÖ Sincroniza√ß√£o conclu√≠da! ${successCount}/${transfers.length} transfers enviados.`, 'success');
               } else {
                   showNotification(`‚ùå Falha na sincroniza√ß√£o! Nenhum transfer foi enviado.`, 'error');
               }
               
           } catch (error) {
               console.error('‚ùå Erro durante sincroniza√ß√£o:', error);
               showNotification('Erro durante sincroniza√ß√£o: ' + error.message, 'error');
           } finally {
               setButtonLoading('syncBtn', false);
           }
       }

       // ============================================
       // LIMPEZA DE DADOS
       // ============================================

       async function clearAllData() {
           const confirmText = prompt('‚ö†Ô∏è ATEN√á√ÉO: Esta a√ß√£o ir√° apagar TODOS os dados!\n\nDigite "CONFIRMAR" para continuar:');
           
           if (confirmText !== 'CONFIRMAR') {
               showNotification('Opera√ß√£o cancelada pelo usu√°rio.', 'warning');
               return;
           }

           setButtonLoading('clearAllBtn', true);
           
           try {
               const url = document.getElementById('webappUrl').value.trim() || localStorage.getItem(CONFIG.URL_KEY);
               
               if (url) {
                   console.log('üóëÔ∏è Limpando dados no Google Sheets...');
                   
                   const response = await fetch(url, {
                       method: 'POST',
                       headers: {
                           'Content-Type': 'application/json',
                       },
                       body: JSON.stringify({
                           action: 'clearAllData',
                           timestamp: new Date().toISOString()
                       }),
                       mode: 'cors'
                   });
                   
                   if (response.ok) {
                       const result = await response.json();
                       if (result.status === 'success') {
                           showNotification('‚úÖ Dados limpos no Google Sheets!', 'success');
                       }
                   }
               }
               
               // Limpar dados locais
               transfers = [];
               localStorage.removeItem(CONFIG.STORAGE_KEY);
               renderTable();
               updateSummary();
               
               showNotification('üóëÔ∏è Todos os dados foram limpos!', 'success');
               
               // Fechar se√ß√£o
               setTimeout(() => {
                   toggleClearData();
               }, 2000);
               
           } catch (error) {
               console.error('‚ùå Erro ao limpar dados:', error);
               
               // Limpar localmente mesmo com erro
               transfers = [];
               localStorage.removeItem(CONFIG.STORAGE_KEY);
               renderTable();
               updateSummary();
               
               showNotification('üóëÔ∏è Dados locais limpos. Erro no servidor.', 'warning');
           } finally {
               setButtonLoading('clearAllBtn', false);
           }
       }

       async function clearTestData() {
           const confirmText = prompt('Limpar apenas registros de teste?\n\nDigite "TESTE" para confirmar:');
           
           if (confirmText !== 'TESTE') {
               showNotification('Opera√ß√£o cancelada pelo usu√°rio.', 'warning');
               return;
           }

           setButtonLoading('clearTestBtn', true);
           
           try {
               const url = document.getElementById('webappUrl').value.trim() || localStorage.getItem(CONFIG.URL_KEY);
               
               if (url) {
                   console.log('üßπ Limpando dados de teste no Google Sheets...');
                   
                   const response = await fetch(url, {
                       method: 'POST',
                       headers: {
                           'Content-Type': 'application/json',
                       },
                       body: JSON.stringify({
                           action: 'clearTestData',
                           timestamp: new Date().toISOString()
                       }),
                       mode: 'cors'
                   });
                   
                   if (response.ok) {
                       const result = await response.json();
                       if (result.status === 'success') {
                           showNotification('‚úÖ Dados de teste limpos no Google Sheets!', 'success');
                       }
                   }
               }
               
               // Limpar dados de teste locais
               const originalLength = transfers.length;
               transfers = transfers.filter(transfer => 
                   !transfer.nomeCliente.toUpperCase().includes('TESTE') &&
                   !transfer.nomeCliente.toUpperCase().includes('TEST') &&
                   !transfer.nomeCliente.toUpperCase().includes('DEBUG')
               );
               
               const removedCount = originalLength - transfers.length;
               
               if (removedCount > 0) {
                   saveData();
                   renderTable();
                   updateSummary();
                   showNotification(`üßπ ${removedCount} registros de teste removidos!`, 'success');
               } else {
                   showNotification('‚ÑπÔ∏è Nenhum registro de teste encontrado.', 'info');
               }
               
               // Fechar se√ß√£o
               setTimeout(() => {
                   toggleClearData();
               }, 2000);
               
           } catch (error) {
               console.error('‚ùå Erro ao limpar dados de teste:', error);
               showNotification('‚ùå Erro ao limpar dados de teste.', 'error');
           } finally {
               setButtonLoading('clearTestBtn', false);
           }
       }

       // ============================================
       // EVENTOS DE TECLADO
       // ============================================

       document.addEventListener('keydown', function(e) {
           // Ctrl + Enter para submeter formul√°rio
           if (e.ctrlKey && e.key === 'Enter') {
               const submitBtn = document.getElementById('submitBtn');
               if (!submitBtn.disabled) {
                   submitBtn.click();
               }
           }
           
           // Escape para limpar formul√°rio
           if (e.key === 'Escape') {
               clearForm();
           }
           
           // F5 para atualizar dados (prevenir reload)
           if (e.key === 'F5') {
               e.preventDefault();
               updateSummary();
               renderTable();
               updateDebugInfo();
               showNotification('Dados atualizados!', 'info');
           }
       });

       // ============================================
       // AUTO-SAVE
       // ============================================

       let autoSaveTimeout;
       function scheduleAutoSave() {
           clearTimeout(autoSaveTimeout);
           autoSaveTimeout = setTimeout(() => {
               saveData();
           }, 2000);
       }

       // Save antes de fechar p√°gina
       window.addEventListener('beforeunload', function(e) {
           saveData();
       });

       // ============================================
       // CONSOLE INFO E AJUDA
       // ============================================

       function showSystemInfo() {
           console.log(`
üöÄ SISTEMA DE TRANSFERS v${CONFIG.APP_VERSION}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üìä ESTAT√çSTICAS:
- Total de Transfers: ${transfers.length}
- Conectado: ${isConnected ? '‚úÖ' : '‚ùå'}
- URL Configurada: ${!!localStorage.getItem(CONFIG.URL_KEY)}
- √öltimo Teste: ${lastConnectionTest ? new Date(lastConnectionTest).toLocaleString() : 'Nunca'}

üîß FUN√á√ïES DISPON√çVEIS:
- debugInfo() - Informa√ß√µes do sistema
- clearForm() - Limpar formul√°rio
- updateSummary() - Atualizar resumo
- testConnection() - Testar conex√£o

üìã DADOS SALVOS:
- Storage Key: ${CONFIG.STORAGE_KEY}
- URL Key: ${CONFIG.URL_KEY}
- Spreadsheet ID: ${CONFIG.SPREADSHEET_ID}

üí° DICAS:
- Ctrl+Enter: Submeter formul√°rio
- Escape: Limpar formul√°rio
- F5: Atualizar dados
           `);
       }

       // Expor fun√ß√µes globalmente para debug
       window.debugInfo = showSystemInfo;
       window.clearForm = clearForm;
       window.updateSummary = updateSummary;
       window.testConnection = testConnection;

       // ============================================
       // MENSAGEM DE BOAS-VINDAS
       // ============================================

       console.log(`
üöÄ SISTEMA DE TRANSFERS v${CONFIG.APP_VERSION} CARREGADO!
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üìã CONFIGURA√á√ÉO:
1. Configure a URL do Google Apps Script
2. Execute o teste de conex√£o
3. Comece a adicionar transfers

üîß FUNCIONALIDADES:
‚úÖ Interface moderna e responsiva
‚úÖ Valida√ß√£o completa de dados
‚úÖ Sincroniza√ß√£o com Google Sheets
‚úÖ Sistema de notifica√ß√µes
‚úÖ Filtros e busca avan√ßada
‚úÖ Exporta√ß√£o para CSV
‚úÖ Debug integrado

üìû AJUDA:
- Use debugInfo() no console para informa√ß√µes
- Pressione F12 para abrir ferramentas de desenvolvimento
- Todas as a√ß√µes s√£o logadas no console

‚úÖ Sistema pronto para uso!
       `);

       // Verificar se √© primeira vez
       if (!localStorage.getItem(CONFIG.URL_KEY) && !localStorage.getItem(CONFIG.STORAGE_KEY)) {
           setTimeout(() => {
               showNotification('üëã Bem-vindo! Configure a URL do Google Sheets para come√ßar.', 'info', 8000);
           }, 3000);
       }
   </script>
</body>
</html>